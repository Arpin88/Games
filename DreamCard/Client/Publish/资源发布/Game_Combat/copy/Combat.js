var __reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);a.prototype=e.prototype,t.prototype=new a},SettlementView=function(t){function e(){var a=t.call(this,e.NAME)||this;return a.arrCardHead=new Array,a}return __extends(e,t),e.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e);var a=t.prototype.getData.call(this);if(null!=a){for(var n=GlobalDataManager.getInstance().getAccountData(),r=0,o="",i=a.users,l=0,C=i.length;C>l;l++){var s=i[l];if(null!=s){var u=s.state;if(n.getTicket()==s.tk){r=u,o=s.cards;break}}}var c=a.spoils,d=null!=c&&null!=c.commanderExp?c.commanderExp:0,p=null!=c&&null!=c.commanderXWG?c.commanderXWG:0,m=null!=c&&null!=c.scards?c.scards:null;e.setCombatResult(r),e.setlabReward(r,p,d),e.setCardResult(o),e.updateCardResult(m);var _=c.account;null!=_&&(n.setLvl(_.lvl),n.setExp(_.exp),n.setUpexp(_.upexp),n.setHp(_.hp),n.setGold(_.gold))}},e.prototype.sleep=function(){var t=this;t.cleanArray(t.arrCardHead),egret.Tween.removeTweens(t.imgLightOfVictory)},e.prototype.cleanArray=function(t){if(!(null==t||t.length<=0))for(var e=t.length-1;e>=0;e--){var a=t[e];if(null!=a){var n=a.parent;n.removeChild(a)}t.splice(e,1)}},e.prototype.recvData=function(t){},e.prototype.touchTap=function(e){var a=this;if(e.target instanceof eui.Button){var n=e.target;if(n==a.btnData){var r=t.prototype.getData.call(this);if(null==r)return;UIManager.getInstance().showUI(CombatDataView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,r)}else if(n==a.btnLeave){var r=t.prototype.getData.call(this);if(null==r)return;var o=WebSocketManager.getInstance().getServerByName(GlobalDataManager.getInstance().getGameServerName());if(null==o)return;WebSocketManager.getInstance().close(o.getSname());var i=r.navigateTo;if(i){GMDManager.closeGMD();var l=i.id,C=i.name,s=i.ori,u=i.jsVer,c=i.resVer,d=i.attRes,p=i.path;GMDManager.addGMDInfo(l,C,s,u,c,p,d);var m=new Object;m.param={},GMDManager.startGMD(l,m),a.hiden()}}}},e.prototype.setCombatResult=function(t){var e=this;1==t?(e.imgResult.source="combatImg0Sheet_json.a632x490",egret.Tween.get(e.imgLightOfVictory,{loop:!0}).to({rotation:360},1e4)):(e.imgResult.source="combatImg0Sheet_json.b632x490",e.imgLightOfVictory.visible=!1)},e.prototype.setlabReward=function(t,e,a){var n=this;n.lblSymbol0.text=e>=0?"+":"-",n.lblSymbol1.text=a>=0?"+":"-",n.lblContent0.text=Math.abs(e)+"",n.lblContent1.text=Math.abs(a)+"",n.imgType0.source=1==t?"combatText0Sheet_json.xwgb":"combatText0Sheet_json.kpjy",n.imgType1.source="combatText0Sheet_json.jsjy"},e.prototype.setCardResult=function(t){for(var e=this,a=t.split("|"),n=100,r=e.groupCardHeads.width/2-a.length*(n/2),o=0,i=a.length;i>o;o++){var l=a[o];if(null!=l&&""!=l){var C=l.split(",");if(!(C.length<8)){var s={};s.icon=C[0],s.name=C[1],s.rarity=C[2],s.element=C[3],s.generation=C[4],s.level=C[5],s.expChange=0,s.lvlChange=0,s.expPercent=Number((Number(C[8])/Number(C[9])).toFixed(2));var u=new CSHeadView;u.initData(s),this.groupCardHeads.addChild(u),u.x=100*o+r,u.y=0,u.width=u.getViewWidth(),u.height=u.getViewHeight(),this.arrCardHead.push(u)}}}},e.prototype.updateCardResult=function(t){if(null!=t&&0!=t.length){for(var e=this,a=0,n=0,r=this.arrCardHead.length;r>n;n++)if(null!=t[n]){var o=t[n],i=this.arrCardHead[n];if(null!=i){var l=i.getData();l.level=null==o.lvl?l.level:o.lvl,l.expChange=null==o.lostExp?l.expChange:-o.lostExp,l.expPercent=null==o.exp||null==o.allExp?l.expPercent:Number((Number(o.exp)/Number(o.allExp)).toFixed(2)),l.lvlChange=null==o.downLvl?l.lvlChange:o.downLvl,i.updateData(l),a+=o.lostExp}}a=-a,e.lblSymbol0.text=a>=0?"+":"-",e.lblContent0.text=Math.abs(a)+""}},e.prototype.onResize=function(e){t.prototype.onResize.call(this,e);var a=this;if(null!=a.groupSettlement){var n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,r=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=a.$stage.stageWidth,i=a.$stage.stageHeight,l=Number((o/i/(n/r)).toFixed(2));return l>1||0>l?void(a.groupSettlement.scaleX=a.groupSettlement.scaleY=1):void(a.groupSettlement.scaleX=a.groupSettlement.scaleY=l)}},e.NAME="SettlementSkin",e}(BaseView);__reflect(SettlementView.prototype,"SettlementView");var Combat;!function(t){function e(){return{}}function a(t,e){LanguageManager.getInstance().setLanguagePackage("Combat"),UIManager.getInstance().registerViewNameByGkid(0,CombatView,"战斗场景"),s=e,l(),CombatConfig.getInstance(),o(t)}function n(){null!=s&&(s(),s=null)}function r(){i(),C()}function o(t){UIManager.getInstance().showUI(CombatView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,t)}function i(){UIManager.getInstance().hideUI(CombatView),UIManager.getInstance().hideUI(SettlementView)}function l(){u||(u=new CombatDecoder);var t=BaseDecode.getInstance();t.registerDecoder(u)}function C(){var t=BaseDecode.getInstance();t&&t.removeDecoder(u)}var s;t.getResConf=e,t.init=a,t.onGameShow=n,t.dispose=r;var u}(Combat||(Combat={}));var CDfdHeadView=function(t){function e(){return t.call(this,e.NAME)||this}return __extends(e,t),e.prototype.week=function(){var e=this;e.setImgMask(),e.setDisconnect(!1);var a=t.prototype.getData.call(this);if(null!=a){var n=a.name;e.setName(n);var r=a.hp;e.origHp=r;var o=a.leftHp;e.setHp(o);var i=a.lv;e.setLv(i);var l=a.power;e.setPower(l);var C=a.ticket;e.ticket=C;var s=a.bl;e.setBreakLineState(s);var u=a.iconUrl;(null==u||""==u)&&(u="headicon_json.head_01"),e.imgIcon.source=u}},e.prototype.sleep=function(){var t=this;null!=t.iconMaskShape&&(t.iconMaskShape.parent.removeChild(t.iconMaskShape),t.iconMaskShape=null),null!=t.hpMaskShape&&(t.hpMaskShape.parent.removeChild(t.hpMaskShape),t.hpMaskShape=null),t.origHp=null},e.prototype.setImgMask=function(){var t=this,e=new egret.Shape;e.graphics.beginFill(0);var a=t.imgHp.width/2,n=t.imgHp.height/2;e.x=a,e.y=n,e.rotation=-90,e.graphics.drawCircle(0,0,n),e.graphics.endFill(),t.groupHp.addChild(e),t.hpMaskShape=e,t.imgHp.mask=e;var r=new egret.Shape;r.graphics.beginFill(0),a=t.imgIcon.width/2,n=t.imgIcon.height/2,r.x=a,r.y=n,r.graphics.drawCircle(0,0,a),r.graphics.endFill(),t.groupIcon.addChild(r),t.iconMaskShape=r,t.imgIcon.mask=r},e.prototype.setHpProgressBar=function(t){var e=this;if(null!=e.hpMaskShape){var a=e.hpMaskShape,n=360*(1-t);1==t?n=360:0==t&&(n=0),a.graphics.clear(),a.graphics.beginFill(0);var r=e.imgHp.height/2;a.graphics.moveTo(0,0),a.graphics.lineTo(r,0),a.graphics.drawArc(0,0,r,0,n*Math.PI/180,!0),a.graphics.lineTo(0,0),a.graphics.endFill()}},e.prototype.setName=function(t){var e=null==t||void 0==t?"":t;this.lblName.text=e},e.prototype.setHp=function(t){var e=this,a=null==t||void 0==t?"0":t.toString();e.lblHp.text="HP:"+a,e.curHp=t,e.setHpProgressBar(t/e.origHp)},e.prototype.setLv=function(t){var e=null==t||void 0==t?"0":t.toString();this.lblLv.text=e},e.prototype.setPower=function(t){var e=null==t||void 0==t?"0":t.toString();this.lblPower.text=e},e.prototype.onLoadImgCompleteHandler=function(t){var e=this;if(t.currentTarget.data){egret.log("加载头像成功: "+t.currentTarget.data);var a=new egret.Texture;a.bitmapData=t.currentTarget.data;var n=new egret.Bitmap(a);n.x=0,n.y=0,n.width=e.imgIcon.width,n.height=e.imgIcon.height,e.groupIcon.addChild(n),e.imgIcon.visible=!1}},e.prototype.getFetterParent=function(){var t=this;return t.groupFetter0.numChildren<=0?t.groupFetter0:t.groupFetter1.numChildren<=0?t.groupFetter1:t.groupFetter2.numChildren<=0?t.groupFetter2:t.groupFetter3},e.prototype.setViewColor=function(t,e){var a=this,n=null;e&&(n=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]);for(var r=0,o=t.numChildren;o>r;r++){var i=t.getChildAt(r);null!=i&&(i instanceof eui.Image?a.setImgColor(i,n):a.setViewColor(i,e))}},e.prototype.setImgColor=function(t,e){if(null!=t)if(null!=e){var a=new egret.ColorMatrixFilter(e);t.filters=[a]}else t.filters=[]},e.prototype.setBreakLineState=function(t){void 0===t&&(t=1);var e=this;e.setViewColor(e,0!=t),e.lblPower.textColor=0==t?16767607:16777215,e.lblName.textColor=0==t?16374136:16777215,e.setDisconnect(0!=t)},e.prototype.setDamage=function(t){var e=this,a=e.curHp+t;a=a>=e.origHp?e.origHp:a,a=0>=a?0:a,e.setHp(a)},e.prototype.setDisconnect=function(t){this.imgDisconnect.visible=t},e.prototype.getTicket=function(){return this.ticket},e.prototype.getHp=function(){return this.curHp},e.prototype.getParentByZIndex=function(t){return-1!=t?this.groupFront:this.groupBack},e.prototype.getParentByType=function(t){var e=this,a=e.groupFront;switch(t){case 0:a=e.groupBack;break;case 1:a=e.groupFront;break;case 2:a=e.getFetterParent();break;default:a=e.groupFront}return a},e.prototype.getFightExpForm=function(){var t=this;return null==t.fightExpForm&&(t.fightExpForm=new FightExpForm(t)),t.fightExpForm},e.NAME="CDfdHeadSkin",e}(IBaseView);__reflect(CDfdHeadView.prototype,"CDfdHeadView",["ExpFromImpl"]);var CombatDataView=function(t){function e(){var a=t.call(this,e.NAME)||this;return a.LeftBGSource="combatImg1Sheet_json.a220x24",a.RightBGSource="combatImg1Sheet_json.b220x24",a.arrCardHeadList=new Array,a}return __extends(e,t),e.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e);var a=t.prototype.getData.call(this);if(null!=a)for(var n=GlobalDataManager.getInstance().getAccountData(),r=a.users,o=0,i=r.length;i>o;o++){var l=r[o];if(null!=l){var C=l.cards,s=l.mcd;l.state;n.getTicket()==l.tk?e.setLeftData(C,s):e.setRightData(C,s)}}},e.prototype.sleep=function(){this.cleanArray(this.arrCardHeadList)},e.prototype.cleanArray=function(t){if(!(null==t||t.length<=0))for(var e=t.length-1;e>=0;e--){var a=t[e];if(null!=a){var n=a.parent;n.removeChild(a)}t.splice(e,1)}},e.prototype.recvData=function(t){},e.prototype.touchTap=function(t){var e=this;e.hiden()},e.prototype.setLeftData=function(t,e){for(var a=new Array,n=t.split("|"),r=0,o=n.length;o>r;r++){var i=n[r];if(null!=i&&""!=i){var l=i.split(",");if(!(l.length<8)){var C={};C.icon=l[0],C.rarity=l[2],C.element=l[3],C.generation=l[4],C.level=l[5];var s=Number(l[7]);s>e&&(e=s),a.push(s);var u=new CSSHeadView;u.initData(C),this.groupLeft.addChild(u),u.x=0,u.y=50*r,this.arrCardHeadList.push(u)}}}for(var r=0,o=a.length;o>r;r++){var c=a[r],d=new eui.Image(this.LeftBGSource);this.groupLeft.addChild(d),d.height=26,d.y=8+50*r,d.x=50;var p=0==e?0:Math.floor(250*c/e);d.width=p;var m=new eui.Label;this.groupLeft.addChild(m),m.text=c+"",m.fontFamily="SimHei",m.size=20,m.verticalAlign="middle",m.textAlign="right",m.stroke=1,m.strokeColor=0,m.x=d.x+d.width-70,d.width<=64&&(m.x=64),m.y=d.y,m.height=d.height,m.width=64}},e.prototype.setRightData=function(t,e){for(var a=new Array,n=t.split("|"),r=0,o=n.length;o>r;r++){var i=n[r];if(null!=i&&""!=i){var l=i.split(",");if(!(l.length<8)){var C={};C.icon=l[0],C.rarity=l[2],C.element=l[3],C.generation=l[4],C.level=l[5];var s=Number(l[7]);s>e&&(e=s),a.push(s);var u=new CSSHeadView;u.initData(C),this.groupRight.addChild(u),u.x=260,u.y=50*r,this.arrCardHeadList.push(u)}}}for(var r=0,o=a.length;o>r;r++){var c=a[r],d=new eui.Image(this.RightBGSource);this.groupRight.addChild(d),d.height=26,d.y=8+50*r;var p=0==e?0:Math.floor(250*c/e);d.width=p,d.x=250-p;var m=new eui.Label;this.groupRight.addChild(m),m.text=c+"",m.fontFamily="SimHei",m.size=20,m.verticalAlign="middle",m.textAlign="left",m.stroke=1,m.strokeColor=0,m.x=d.x+6,m.y=d.y,m.height=d.height,m.width=64,m.x>186&&(m.x=186)}},e.prototype.onResize=function(e){t.prototype.onResize.call(this,e);var a=this;if(null!=a.groupCombatData){var n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,r=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=a.$stage.stageWidth,i=a.$stage.stageHeight,l=Number((o/i/(n/r)).toFixed(2));return l>1||0>l?void(a.groupCombatData.scaleX=a.groupCombatData.scaleY=1):void(a.groupCombatData.scaleX=a.groupCombatData.scaleY=l)}},e.NAME="CombatDataSkin",e}(BaseView);__reflect(CombatDataView.prototype,"CombatDataView");var CombatView=function(t){function e(){var a=t.call(this,e.NAME)||this;return a.isDebug=!1,a}return __extends(e,t),e.prototype.$onAddToStage=function(e,a){t.prototype.$onAddToStage.call(this,e,a),Combat.onGameShow()},e.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e);var a=t.prototype.getData.call(this);null!=a&&null!=a.debug&&(e.isDebug=a.debug),e.initView(),e.sendRequst(CombatCmdDef.CMD_ENTER_GAME),WebSocketManager.getInstance().setReconnectHandler(Handler.create(e,e.reqForceReconnectGame))},e.prototype.initView=function(){var t=this;t.cleanHead(),t.updateOutCardCutDown(0),t.updateReadyCount(-1,0),t.updateRound(0),t.updateDirIndicator(0),t.updateOptBtnState(),t.groupDebug.visible=!1,t.isDebug&&(t.initCombatParser(),t.btnHosting.visible=!0,t.btnAtk.visible=!0,t.groupDebug.visible=!0,t.remainReqQuickSettleCount=3)},e.prototype.sleep=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&t.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t),t.combatParser.cleanData(),t.combatParser=null,null!=t.cWaitStartView&&(UIManager.getInstance().hideUI(CWaitStartView),t.cWaitStartView=null)},e.prototype.recvData=function(t,e){var a=this;switch(t){case CombatCmdDef.CMD_DISCONNECT_GAME:a.onDisconnectGame(e);break;case CombatCmdDef.CMD_RECONNECT_GAME:a.onReconnectGame(e);break;case CombatCmdDef.CMD_ENTER_GAME:a.onEnterGame(e);break;case CombatCmdDef.CMD_ENTER_COUNT_TIME:a.onSynStartGameCutDown(e);break;case CombatCmdDef.CMD_SYN_OTHER_DATA_GAME:a.onSynPlayerData(CombatConstants.PLACE_DFD,e);break;case CombatCmdDef.CMD_SYN_ME_DATA_GAME:a.onSynPlayerData(CombatConstants.PLACE_ATK,e);break;case CombatCmdDef.CMD_SNED_CARD:a.onSendCard(e);break;case CombatCmdDef.CMD_SYN_PLAY_CARD_TIME:a.onSynOutCardCutDown(e);break;case CombatCmdDef.CMD_SYN_PLAY_CARD_DATA:a.onSynOutCardsData(e);break;case CombatCmdDef.CMD_SYN_GAME_RESULT_DATA:a.onSynGameResultData(e);break;case CombatCmdDef.CMD_SYN_CHANGE_ROUND_DATA_GAME:a.onSynChangeRoundData(e);break;case CombatCmdDef.CMD_SYN_BATTLE_DATA_GAME:break;case CombatCmdDef.CMD_SYN_ATK_DATA_GAME:a.onSynBattleData(e);break;case CombatCmdDef.CMD_SURRENDER_GAME:break;case CombatCmdDef.CMD_START_BATTLE:a.onStartBattle(e);break;case CombatCmdDef.CMD_SYN_HOSTING:a.onSynHosting(e);break;case CombatCmdDef.CMD_SYN_START_FETTER:a.onSynStartFetter(e);break;case CombatCmdDef.CMD_REQ_QUICK_SETTLEMENT:a.onReqQuickSettlement(e);break;case CombatCmdDef.CMD_PRO_QUICK_SETTLEMENT:a.onProQuickSettlement(e);break;case CombatCmdDef.CMD_SYN_DISSOLUTION_GAME:a.onSynDissolution(e);break;case CombatCmdDef.CMD_DEBUG_GET_BUFF_CD:a.onSynBuffCD(e);break;case CombatCmdDef.CMD_FORCE_RECONNECT_GAME:a.onForceReconnectGame(e)}},e.prototype.sendRequst=function(t,e,a){void 0===e&&(e={}),void 0===a&&(a=!1);var n=WebSocketManager.getInstance().getServerByName(GlobalDataManager.getInstance().getGameServerName());if(null!=n){var r=new Object;r.cmd=t,r.data=e,r.ruuid=GlobalDataManager.getInstance().getRUUID(),r.room=GlobalDataManager.getInstance().getRoom(),WebSocketManager.getInstance().sendMessage(n.getSname(),t,r,a)}},e.prototype.touchTap=function(t){var e=this,a=t.target;if(a instanceof eui.Button)a==e.btnAtkDeath?e.isDebug?e.onClickAtkDBtn():e.groupAtkDeath.visible=!0:a==e.btnDfdDeath?e.isDebug?e.onClickDfdDBtn():e.groupDfdDeath.visible=!0:a==e.btnSet?UIManager.getInstance().showUI(CSetView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,{surrenderGameHandler:Handler.create(e,e.surrenderGame)}):a==e.btnHosting?e.isDebug?e.onClickHostBtn():(e.updateOptBtnState(0),e.sendRequst(CombatCmdDef.CMD_SYN_HOSTING,{auto:!0})):a==e.btnUnHosting?e.sendRequst(CombatCmdDef.CMD_SYN_HOSTING,{auto:!1}):a==e.btnEnd?(e.updateOptBtnState(0),e.sendRequst(CombatCmdDef.CMD_OUT_CARD,{codeList:[]})):a==e.btnAtk?e.isDebug?e.onClickAtkBtn():(e.updateOptBtnState(0),e.sendRequst(CombatCmdDef.CMD_OUT_CARD,{codeList:e.combatParser.getCurSelCardsCode()})):a==e.btnQuick&&UIManager.getInstance().showUI(CPopupView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,{type:0,countStr:"("+e.remainReqQuickSettleCount+"/"+CombatConstants.REQ_QUICK_SETTLEMENT_MAX_COUNT+")",callbackHandler:Handler.create(e,function(){e.remainReqQuickSettleCount--,e.updateOptBtnState(-1,-1,1),e.sendRequst(CombatCmdDef.CMD_REQ_QUICK_SETTLEMENT)})});else if(a instanceof eui.Group){var n=t.target;if(n==e.groupAtkDeath)e.groupAtkDeath.visible=!1;else if(n==e.groupDfdDeath)e.groupDfdDeath.visible=!1;else if(n.name.substr(0,8)==CombatConstants.CARD_SQUARE_GROUP_PREFIX){var r=n.name.split("_");if(2!=r.length)return;var o=r[1],i=CombatFactory.createCombatNode(CombatConstants.OPT_TYPE_SEL_CARD,{place:CombatConstants.PLACE_ATK,code:o});e.combatParser.parse(i),e.updateOptBtnState(e.combatParser.getOptBtnAtkType(CombatConstants.PLACE_ATK))}}},e.prototype.onDisconnectGame=function(t){if(null!=t){var e=this,a=t.tk,n=t.bl;e.combatParser.getDfdHeadView().getTicket()==a&&e.combatParser.getDfdHeadView().setBreakLineState(n)}},e.prototype.onReconnectGame=function(t){if(null!=t){var e=this,a=t.cardData;if(null!=a)for(var n in a){var r=a[n],o=Number(n),i=r.handCards,l=o==CombatConstants.PLACE_ATK?CombatConstants.CARD_GROUP_ATK_HAND:CombatConstants.CARD_GROUP_DFD_HAND;e.combatParser.initCards(l,i);var C=r.outCards;l=o==CombatConstants.PLACE_ATK?CombatConstants.CARD_GROUP_ATK_OUT:CombatConstants.CARD_GROUP_DFD_OUT,e.combatParser.initCards(l,C);var s=r.deathCards;l=o==CombatConstants.PLACE_ATK?CombatConstants.CARD_GROUP_ATK_DEATH:CombatConstants.CARD_GROUP_DFD_DEATH,e.combatParser.initCards(l,s);var u=r.buffDatas;if(null!=u&&u.length>0)for(var c=0,d=u.length;d>c;c++){var p=u[c];if(null!=p&&p.length>0)for(var m=0,_=p.length;_>m;m++){var g=p[m];null!=g&&e.onSynBattleData(g)}}}var f=t.effUrl;if(null!=f&&f.length>0)for(var c=0,d=f.length;d>c;c++){var T=f[c];null!=T&&""!=T&&CResManager.getInstance().addResByRCSkillKey(T)}var b=t.hostState;null!=b&&e.updateOptBtnState(0,b?1:0),e.updateOptBtnState(-1,-1,0);var h=t.curStep,v=t.synData;if(0==h);else if(1==h);else if(2==h);else if(3==h){var E=v.fromPlace,A=E==CombatConstants.PLACE_ATK;e.updateOptBtnState(A?1:0,-1,0),e.combatParser.setHandCardTouchState(A)}else if(4==h){var D=v.deathCardCodes;if(null!=D)for(var n in D){var y=D[n];if(!(null==y||y.length<=0))for(var o=Number(n),c=0,d=y.length;d>c;c++){var S=y[c];if(null!=S&&""!=S){var R=new CombatNode;R.optType=CombatConstants.OPT_TYPE_DEATH,R.senderPlace=o,R.fromTarget=S,R.removeCard=!0,e.combatParser.parse(R)}}}}}},e.prototype.onEnterGame=function(t){if(null!=t){var e=this;0==t&&e.setWaitStartView({type:0})}},e.prototype.onSynStartGameCutDown=function(t){this.setWaitStartView({type:1,cutdown:t})},e.prototype.onSynPlayerData=function(t,e){var a=this;if(null!=e){var n=e.user;a.setHead(t,n);var r=e.readyCount;if(a.updateReadyCount(t,r),t==CombatConstants.PLACE_ATK){var o=e.quickSettleCount;a.remainReqQuickSettleCount=o,a.btnQuick.visible&&a.updateOptBtnState(-1,-1,0)}}},e.prototype.onSendCard=function(t){if(null!=t){var e=this,a=t.place,n=t.readyCount;e.updateReadyCount(a,n),e.updateOptBtnState(0);var r=CombatFactory.createCombatNode(CombatConstants.OPT_TYPE_REDUCE_ROUND,{place:a}),o=CombatFactory.createCombatNode(CombatConstants.OPT_TYPE_SEND_CARD,{place:a,card:t.card}),i=CombatFactory.createCombatNode(CombatConstants.OPT_TYPE_SORT_HAND_CARD,{place:a});CombatFactory.createCombatSerial(e.combatParser,[r,o,i]);var l=t.effUrl;if(null!=l&&l.length>0)for(var C=0,s=l.length;s>C;C++){var u=l[C];null!=u&&""!=u&&CResManager.getInstance().addResByRCSkillKey(u)}}},e.prototype.onSynOutCardCutDown=function(t){var e=this;if(null!=t){var a=0;if("number"==typeof t)a=t;else{a=t.count;var n=t.place;null!=n&&e.updateOptBtnState(e.combatParser.getOptBtnAtkType(n))}null!=a&&this.updateOutCardCutDown(a)}},e.prototype.onSynOutCardsData=function(t){var e=this,a=(new Array,CombatFactory.createCombatNode(CombatConstants.OPT_TYPE_FORCE_DESEL_CARD));if(e.addCombatNodeToSerial(a),null!=t.cards)for(var n=t.cards,r=0,o=n.length;o>r;r++){var i=n[r];if(null!=i){var l=CombatFactory.createCombatNode(CombatConstants.OPT_TYPE_OUT_CARD,{place:t.place,card:i});e.addCombatNodeToSerial(l)}}egret.setTimeout(function(t){var a=CombatFactory.createCombatNode(CombatConstants.OPT_TYPE_SORT_HAND_CARD,{place:t});e.addCombatNodeToSerial(a)}.bind(e,t.place),e,200);var C=t.effUrl;if(null!=C&&C.length>0)for(var r=0,o=C.length;o>r;r++){var s=C[r];null!=s&&""!=s&&CResManager.getInstance().addResByRCSkillKey(s)}},e.prototype.onSynGameResultData=function(t){GlobalDataManager.getInstance().setGameOver(!0),UIManager.getInstance().hideUI(CPopupView),UIManager.getInstance().showUI(SettlementView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,t)},e.prototype.onSynChangeRoundData=function(t){var e=this,a=t.round;e.updateRound(a);for(var n=t.atkTk,r=CombatConstants.PLACE_ATK,o=GlobalDataManager.getInstance().getAccountData(),i=t.users,l=0,C=i.length;C>l;l++){var s=i[l];if(null!=s){var u=s.tk,c=u==o.getTicket()?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD;n==u&&(r=c);var d=s.lefthp;if(c==CombatConstants.PLACE_ATK){var p=e.combatParser.getAtkHeadView(),m=p.getHp();d!=m&&p.setDamage(d-m)}else{var _=e.combatParser.getDfdHeadView(),m=_.getHp();d!=m&&_.setDamage(d-m)}var g=s.cards;e.combatParser.synUpdateOutCards(c,g);for(var f=0,T=g.length;T>f;f++){var b=g[f];if(null!=b){var h=b.buffs;if(null!=h&&h.length>0)for(var v=0,E=h.length;E>v;v++){var A=h[v];null!=A&&e.onSynBattleData(A)}}}}}e.updateDirIndicator(r)},e.prototype.onSynBattleData=function(t){if(null!=t){var e=this,a=t[CombatConstants.FIGHT_DATA];if(null!=a){var n=a.type,r=CombatConstants.OPT_TYPE_NO_ACTION;n==CombatConstants.COMBAT_TYPE_ATK_NOR?r=CombatConstants.OPT_TYPE_ATK_NOR:n==CombatConstants.COMBAT_TYPE_ATK_SKILL?r=CombatConstants.OPT_TYPE_ATK_SKILL:n==CombatConstants.COMBAT_TYPE_REVIVE?r=CombatConstants.OPT_TYPE_REVIVE:n==CombatConstants.COMBAT_TYPE_ROUND_RECOVER?r=CombatConstants.OPT_TYPE_ROUND_RECOVER:n==CombatConstants.COMBAT_TYPE_ROUND_LOST?r=CombatConstants.OPT_TYPE_ROUND_LOST:n==CombatConstants.COMBAT_TYPE_MODIFY_ATTRIBUTE?r=CombatConstants.OPT_TYPE_MODIFY_ATTRIBUTE:n==CombatConstants.COMBAT_TYPE_PERSUADE_BACK&&(r=CombatConstants.OPT_TYPE_PERSUADE_BACK);var o=CombatFactory.createCombatNode(r,{fightData:a});e.addCombatNodeToSerial(o)}var i=t[CombatConstants.BUFF_DATA];if(i){var n=i.type,r=CombatConstants.OPT_TYPE_NO_ACTION;n==CombatConstants.COMBAT_TYPE_BUFF_ADD?r=CombatConstants.OPT_TYPE_BUFF_ADD:n==CombatConstants.COMBAT_TYPE_BUFF_REMOVE?r=CombatConstants.OPT_TYPE_BUFF_REMOVE:n==CombatConstants.COMBAT_TYPE_BUFF_UPDATE?r=CombatConstants.OPT_TYPE_BUFF_UPDATE:n==CombatConstants.COMBAT_TYPE_MODIFY_ATTRIBUTE&&(r=CombatConstants.OPT_TYPE_MODIFY_ATTRIBUTE);var l=CombatFactory.createCombatNode(r,{buffData:i});e.addCombatNodeToSerial(l)}var C=t[CombatConstants.FETTER_DATA];if(C){var n=C.type,r=CombatConstants.OPT_TYPE_NO_ACTION;n==CombatConstants.COMBAT_TYPE_FETTER_ADD?r=CombatConstants.OPT_TYPE_FETTER_ADD:n==CombatConstants.COMBAT_TYPE_FETTER_REMOVE&&(r=CombatConstants.OPT_TYPE_FETTER_REMOVE);var s=CombatFactory.createCombatNode(r,{fetterData:C});e.addCombatNodeToSerial(s)}}},e.prototype.onStartOutCard=function(t){var e=this;e.updateOptBtnState(e.combatParser.getOptBtnAtkType(t.place))},e.prototype.onStartBattle=function(t){var e=this;e.updateOptBtnState(0);var a=CombatFactory.createCombatNode(CombatConstants.OPT_TYPE_FORCE_DESEL_CARD),n=CombatFactory.createCombatNode(CombatConstants.OPT_TYPE_SET_NON_CLICKABLE);CombatFactory.createCombatSerial(e.combatParser,[a,n])},e.prototype.onSynHosting=function(t){var e=this,a=null==t?!1:t;e.updateOptBtnState(-1,a?1:0)},e.prototype.onSynStartFetter=function(t){if(null!=t){for(var e=this,a=t.fData0,n=t.fData1,r=0,o=a.tk,i=a.effUrlArr,l=a.effTimeArr,C=0,s=i.length;s>C;C++){var u=i[C];if(null!=u&&""!=u){var c=new CombatNode;c.fromTarget=o,c.optType=CombatConstants.OPT_TYPE_FETTER_ADD,c.skillKey=u,egret.setTimeout(function(t){e.addCombatNodeToSerial(t)}.bind(e,c),e,r);var d=l[C];null!=d&&(r+=d)}}for(var o=n.tk,i=n.effUrlArr,l=n.effTimeArr,C=0,s=i.length;s>C;C++){var u=i[C];if(null!=u&&""!=u){var c=new CombatNode;c.fromTarget=o,c.optType=CombatConstants.OPT_TYPE_FETTER_ADD,c.skillKey=u,egret.setTimeout(function(t){e.addCombatNodeToSerial(t)}.bind(e,c),e,r);var d=l[C];null!=d&&(r+=d)}}}},e.prototype.onReqQuickSettlement=function(t){var e=this;e.updateOptBtnState(-1,-1,1),UIManager.getInstance().showUI(CPopupView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,{type:1,callbackHandler:Handler.create(e,function(t){var a=1;t||(a=0,e.updateOptBtnState(-1,-1,0)),e.sendRequst(CombatCmdDef.CMD_PRO_QUICK_SETTLEMENT,{state:a})})})},e.prototype.onProQuickSettlement=function(t){if(null!=t){var e=this,a=t.state;UIManager.getInstance().showUI(CPopupView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,{type:2,state:a}),0==a&&e.updateOptBtnState(-1,-1,0)}},e.prototype.onSynDissolution=function(t){if(null!=t){GlobalDataManager.getInstance().setGameOver(!0);var e=LanguageManager.getInstance().getLabelLanguage(this);PopManager.getInstance().showPromptBox(e.lbl_0,2,Handler.create(self,function(){var e=t.navigateTo;if(null!=e){GMDManager.closeGMD();var a=e.id,n=e.name,r=e.ori,o=e.jsVer,i=e.resVer,l=e.attRes,C=e.path;GMDManager.addGMDInfo(a,n,r,o,i,C,l);var s=new Object;s.param={},GMDManager.startGMD(a,s)}}))}},e.prototype.onSynBuffCD=function(t){if(null!=t){var e="";for(var a in t){var n=t[a];if(null==n||n.length<=0)return;e+="{卡牌编号:"+a+"  BUFF:{ ";for(var r=n.buffs,o=0,i=r.length;i>o;o++){var l=r[o];if(null!=l){var C=l.fromCode,s=l.buffName,u=l.buffCode,c=l.buffCd,d=l.buffRound;e+="[ 发起编号:"+C+"  ",e+="BUFF编号:"+u+"  ",e+="BUFF名称:"+s+"  ",e+="BUFFCD:"+c+"  ",e+="BUFF回合:"+d+"  ]"}}e+="}  技能:{ ";for(var p=n.skills,o=0,i=p.length;i>o;o++){var m=p[o];if(null!=m){var _=m.skillName,g=m.skillCode,f=m.skillCd,T=m.skillRound;e+="[技能编号:"+_+"  ",e+="技能名称:"+g+"  ",e+="技能CD:"+f+"  ",e+="技能回合:"+T+"  ]"}}e+="}}\n"}console.log(e)}},e.prototype.setWaitStartView=function(t){var e=this;null==e.cWaitStartView?(UIManager.getInstance().showUI(CWaitStartView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,t),e.cWaitStartView=UIManager.getInstance().getViewByName(CWaitStartView)):e.cWaitStartView.updateShow(t),null!=t&&1==t.type&&0==t.cutdown&&this.onGameStart()},e.prototype.onGameStart=function(){var t=this;0==t.remainReqQuickSettleCount&&(t.remainReqQuickSettleCount=CombatConstants.REQ_QUICK_SETTLEMENT_MAX_COUNT),t.updateOptBtnState(0,0,0)},e.prototype.setHead=function(t,e){if(null!=e){var a=this;switch(t){case CombatConstants.PLACE_ATK:var n=new CAtkHeadView,r={},o=GlobalDataManager.getInstance().getAccountData();r.name=o.getNick(),r.lv=o.getLvl(),r.iconUrl=o.getHead_Url(),r.ticket=o.getTicket(),r.hp=e.hp,r.leftHp=e.leftHp,r.power=e.rank,n.initData(r),a.groupAtkHead.addChild(n),a.combatParser.setAtkHeadView(n);var i=e.fetterDatas;a.combatParser.initFetters(t,i);break;case CombatConstants.PLACE_DFD:var l=new CDfdHeadView,r={};r.hp=e.hp,r.leftHp=e.leftHp,r.power=e.rank,r.name=e.nick,r.lv=e.lvl,r.iconUrl=e.head_url,r.ticket=e.tk,r.bl=null==e.bl?0:e.bl,l.initData(r),a.groupDfdHead.addChild(l),a.combatParser.setDfdHeadView(l);var i=e.fetterDatas;a.combatParser.initFetters(t,i)}}},e.prototype.cleanHead=function(){var t=this;null!=t.groupAtkHead&&t.groupAtkHead.numChildren>0&&t.groupAtkHead.removeChildren(),null!=t.groupDfdHead&&t.groupDfdHead.numChildren>0&&t.groupDfdHead.removeChildren()},e.prototype.updateReadyCount=function(t,e){var a=this,n="";switch(t){case CombatConstants.PLACE_ATK:a.lblAtkReadyCount.text=n+e;break;case CombatConstants.PLACE_DFD:a.lblDfdReadyCount.text=n+e;break;default:a.lblDfdReadyCount.text=n+e,a.lblAtkReadyCount.text=n+e}},e.prototype.updateRound=function(t){this.lblRound.text=t+""},e.prototype.updateDirIndicator=function(t){var e=this,a=-10,n=80;e.imgDirSun.y=t==CombatConstants.PLACE_ATK?a:n,e.imgDirMoon.y=t==CombatConstants.PLACE_ATK?n:a},e.prototype.updateOutCardCutDown=function(t){this.lblOutCardCutDown.text=CombatUtils.getCutDownShowContent(t)},e.prototype.updateOptBtnState=function(t,e,a){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===a&&(a=-1);var n=this;return-1==t&&-1==e&&-1==a?void(n.btnQuick.visible=n.btnUnHosting.visible=n.btnHosting.visible=n.btnAtk.visible=n.btnEnd.visible=!1):(0==e?(n.btnUnHosting.visible=!1,n.btnHosting.visible=!0):1==e&&(n.btnUnHosting.visible=!0,n.btnHosting.visible=!1),0==t?(n.btnAtk.visible=!1,n.btnEnd.visible=!0,n.btnEnd.enabled=!1):1==t?(n.btnAtk.visible=!1,n.btnEnd.visible=!0,n.btnEnd.enabled=!0):2==t&&(n.btnAtk.visible=!0,n.btnEnd.visible=!1),void(0==a?(n.btnQuick.visible=!0,n.btnQuick.enabled=n.remainReqQuickSettleCount>0):1==a&&(n.btnQuick.visible=!0,n.btnQuick.enabled=!1)))},e.prototype.addCombatNodeToSerial=function(t){if(null!=t){var e=this;null!=e.combatSerial&&e.combatSerial.getCombatNodeListLength()<=0&&(e.combatSerial=null),null==e.combatSerial?e.combatSerial=CombatFactory.createCombatSerial(e.combatParser,[t]):e.combatSerial.addNodeAndPlay(t)}},e.prototype.surrenderGame=function(){var t=this;t.sendRequst(CombatCmdDef.CMD_SURRENDER_GAME,{})},e.prototype.reqForceReconnectGame=function(){var t=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(t.getSname(),CombatCmdDef.CMD_FORCE_RECONNECT_GAME,{},!1)},e.prototype.onForceReconnectGame=function(t){if(null!=t){var e=t.navigateTo;if(null!=e){GMDManager.closeGMD();var a=e.id,n=e.name,r=e.ori,o=e.jsVer,i=e.resVer,l=e.attRes,C=e.path;GMDManager.addGMDInfo(a,n,r,o,i,C,l);var s=new Object;s.param={},GMDManager.startGMD(a,s)}else{var u=t.reconnect;if(null!=u){var c=u.ruuid;GlobalDataManager.getInstance().setRUUID(c);var d=u.room;GlobalDataManager.getInstance().setRoom(d),GlobalDataManager.getInstance().setThredID(0);var p=u.scode;GlobalDataManager.getInstance().setGameServerName(p),GlobalDataManager.getInstance().setGameOver(!1);var m=u.surl,_=new ServerData;_.setSname(p),_.setSurl(m),_.setResolver(WebSocketManager.getInstance().getResolver(JsonResolver.NAME)),WebSocketManager.getInstance().registerServer(_),WebSocketManager.getInstance().connectServer(p,!0)}}}},e.prototype.setFetterList=function(){for(var t=this,e=0;4>e;e++){var a={type:"jbmingcheng"+(e%4+1),canTouch:!1,visible:5>e},n=new CardFetterView;n.initData(a),t.groupAtkFetter.addChild(n),n.scaleX=n.scaleY=.38;var r=new CardFetterView;r.initData(a),t.groupDfdFetter.addChild(r),r.scaleX=r.scaleY=.38}},e.prototype.initCombatParser=function(){var t=this;t.combatParser=CDebugConfig.getInstance().getCombatParser(t);var e=new CAtkHeadView,a={};a.hp=666,a.leftHp=666,a.power=666,a.name="测试1",a.lv=66,a.ticket="123",e.initData(a),t.groupAtkHead.addChild(e),t.combatParser.setAtkHeadView(e);var n=new CDfdHeadView,r={};r.hp=666,r.leftHp=666,r.power=666,r.name="测试2",r.lv=66,r.ticket="456",n.initData(r),t.groupDfdHead.addChild(n),t.combatParser.setDfdHeadView(n)},e.prototype.onClickHostBtn=function(){var t=this,e=this.editSkillId.text;e=null==e||""==e?"0":e;var a=5;Number(e)>1e3&&(a=CombatConstants.OPT_TYPE_ATK_SKILL_CONT);var n=[{toTarget:"10",hited:!0,damage:-6666,damageShow:"-6666",recoverShow:"+666"},{toTarget:"11",hited:!0,damage:6666,damageShow:"+6666",recoverShow:"+666"},{toTarget:"12",hited:!1}],r=null,o=Number(e);43==o?(r={toTarget:"123",type:CombatConstants.FIGHT_TYPE_USER,hited:!0,damage:-66,damageShow:"-66",recoverShow:"+666"},n.push(r)):(45==o||46==o||47==o)&&(r={toTarget:"20",recipient:!1,type:CombatConstants.FIGHT_TYPE_OUT_CARD,hited:!0,damage:66,damageShow:"-66",recoverShow:"+666"},n.push(r));var i=[{note:"技能攻击 上方攻击",optType:a,senderPlace:1,skillKey:e,fromTarget:"20",fightNodeArr:n}];new CombatSerial(t.combatParser);for(var l in i){var C=i[l];if(null!=C){var s=CombatUtils.getConfig(C,CombatNode);t.addCombatNodeToSerial(s)}}if(""!=e){var u=CombatConfig.getInstance().getConfigs(),c=u[CombatConstants.RC_SKILL_EXP_FORMS];
if(null==c)return null;var d=c[e];if(null==d)return null;var p=0,m=d[CombatConstants.SKILL_RES_ATTR];if(null!=m){var _=m[CombatConstants.USAGE_TIME];null!=_&&_>p&&(p=_)}var g=d[CombatConstants.SKILL_REC_ATTR];if(null!=g){var _=g[CombatConstants.USAGE_TIME];null!=_&&_>p&&(p=_)}egret.Tween.get(this).wait(p).call(function(){var n=[{toTarget:"20",hited:!0,damage:-6666,damageShow:"-6666",recoverShow:"+666"},{toTarget:"21",hited:!0,damage:6666,damageShow:"+6666",recoverShow:"+666"},{toTarget:"22",hited:!1}],r=null,o=Number(e);43==o?(r={toTarget:"456",type:CombatConstants.FIGHT_TYPE_USER,hited:!0,damage:-66,damageShow:"-66",recoverShow:"+666"},n.push(r)):(45==o||46==o||47==o)&&(r={toTarget:"10",recipient:!1,type:CombatConstants.FIGHT_TYPE_OUT_CARD,hited:!0,damage:66,damageShow:"-66",recoverShow:"+666"},n.push(r));var i=[{note:"技能攻击 下方攻击",optType:a,senderPlace:0,skillKey:e,fromTarget:"10",fightNodeArr:n}];for(var l in i){var C=i[l];if(null!=C){var s=CombatUtils.getConfig(C,CombatNode);t.addCombatNodeToSerial(s)}}})}},e.prototype.onClickDfdDBtn=function(){var t=this,e=new CombatNode;e.optType=CombatConstants.OPT_TYPE_REDUCE_ROUND;var a=CombatConstants.PLACE_ATK;return e.receiverPlace=a,e.senderPlace=CombatConstants.PLACE_ATK,void t.combatParser.parse(e)},e.prototype.onClickAtkDBtn=function(){var t=this;if(""!=t.editTFrameRate.text&&""!=t.editSkillId.text&&""!=t.editFrameRate.text){var e=Number(t.editTFrameRate.text),a=Number(t.editFrameRate.text);if(""==t.editSpeed.text)return void(t.editSpeed.text=1e3*Number((e/a).toFixed(2))+"");var n=t.editSkillId.text,r=CombatConfig.getInstance().getConfigs(),o=r[CombatConstants.EFF_COMPONENTS];if(null==o)return null;var i=o[CombatConstants.EFF_COMP_MOVIECLIPS];if(null==i)return null;var l=Number(t.editFrameRate.text);i[n].frameRate=l,t.editSpeed.text=Math.floor(e/l*1e3)+""}},e.prototype.testTimeout=function(t,e){var a=this;egret.Tween.get(a).wait(e).call(function(){t.run()})},e.prototype.onClickAtkBtn=function(){var t=this,e=this.editSkillId.text;e=null==e||""==e?"0":e;var a=CombatConstants.OPT_TYPE_ATK_SKILL,n=[{note:"技能攻击 上方攻击",optType:a,senderPlace:1,skillKey:e,fromTarget:"20",fightNodeArr:[{toTarget:"10",hited:!0},{toTarget:"11",hited:!0},{toTarget:"12",hited:!1}]}];new CombatSerial(t.combatParser);for(var r in n){var o=n[r];if(null!=o){var i=CombatUtils.getConfig(o,CombatNode);t.addCombatNodeToSerial(i)}}var l=CombatConfig.getInstance().getConfigs(),C=l[CombatConstants.RC_SKILL_EXP_FORMS];if(null==C)return null;var s=C[e];if(null==s)return null;var u=0,c=s[CombatConstants.SKILL_RES_ATTR];if(null!=c){var d=c[CombatConstants.USAGE_TIME];null!=d&&d>u&&(u=d)}var p=s[CombatConstants.SKILL_REC_ATTR];if(null!=p){var d=p[CombatConstants.USAGE_TIME];null!=d&&d>u&&(u=d)}egret.Tween.get(this).wait(u).call(function(){var n=[{toTarget:"10",hited:!0,damage:-6666,damageShow:"-6666",recoverShow:"+666"},{toTarget:"11",hited:!0,damage:6666,damageShow:"+6666",recoverShow:"+666"},{toTarget:"12",hited:!1}],r=null,o=Number(e);43==o?(r={toTarget:"123",type:CombatConstants.FIGHT_TYPE_USER,hited:!0,damage:-66,damageShow:"-66",recoverShow:"+666"},n.push(r)):(45==o||46==o||47==o)&&(r={toTarget:"20",recipient:!1,type:CombatConstants.FIGHT_TYPE_OUT_CARD,hited:!0,damage:66,damageShow:"-66",recoverShow:"+666"},n.push(r));var i=[{note:"技能攻击 上方攻击",optType:a,senderPlace:1,skillKey:e,fromTarget:"21",fightNodeArr:n}];new CombatSerial(t.combatParser);for(var l in i){var C=i[l];if(null!=C){var s=CombatUtils.getConfig(C,CombatNode);t.addCombatNodeToSerial(s)}}})},e.prototype.onClickSetBtn=function(){},Object.defineProperty(e.prototype,"combatParser",{get:function(){var t=this;if(null==t._combatParser){var e={view:t};t._combatParser=new CombatParser(e)}return t._combatParser},set:function(t){this._combatParser=t},enumerable:!0,configurable:!0}),e.prototype.onResize=function(e){t.prototype.onResize.call(this,e);var a=this;if(null!=a.groupCombat){var n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,r=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=a.$stage.stageWidth,i=a.$stage.stageHeight,l=Number((o/i/(n/r)).toFixed(2));return l>1||0>l?void(a.groupCombat.scaleX=a.groupCombat.scaleY=1):void(a.groupCombat.scaleX=a.groupCombat.scaleY=l)}},e.NAME="CombatSkin",e}(BaseView);__reflect(CombatView.prototype,"CombatView");var CPopupView=function(t){function e(){return t.call(this,e.NAME)||this}return __extends(e,t),e.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.labelObj=LanguageManager.getInstance().getLabelLanguage(this);var a=t.prototype.getData.call(this);e.updateShow(a)},e.prototype.sleep=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&t.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t),t.labelObj=null},e.prototype.touchTap=function(t){var e=this,a=t.target;a instanceof eui.Button&&(a==e.btnCance?e.hiden():a==e.btnConfirm?(null!=e.callbackHandler&&e.callbackHandler.run(),e.hiden()):a==e.btnRefuse?(null!=e.callbackHandler&&e.callbackHandler.runWith(!1),e.hiden()):a==e.btnAgree?(null!=e.callbackHandler&&e.callbackHandler.runWith(!0),e.hiden()):a==e.btnConfirmCenter&&e.hiden())},e.prototype.updateShow=function(t){if(null!=t){var e=this;e.group0.visible=e.group1.visible=e.group2.visible=!1;var a=t.type;if(0==a)e.group0.visible=!0,e.lbl0.textFlow=[{text:e.labelObj.lbl_0,style:{textColor:16777215}},{text:t.countStr+"\n",style:{textColor:3719423}},{text:e.labelObj.lbl_1,style:{textColor:16777215}},{text:e.labelObj.lbl_2,style:{textColor:16713222}}],e.callbackHandler=t.callbackHandler;else if(1==a)e.group1.visible=!0,e.callbackHandler=t.callbackHandler;else if(2==a){e.group2.visible=!0;var n=0==t.state?e.labelObj.lbl_5:e.labelObj.lbl_4;e.lbl2.text=n}}},e.prototype.onResize=function(e){t.prototype.onResize.call(this,e);var a=this;if(null!=a.groupCPopup){var n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,r=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=a.$stage.stageWidth,i=a.$stage.stageHeight,l=Number((o/i/(n/r)).toFixed(2));return l>1||0>l?void(a.groupCPopup.scaleX=a.groupCPopup.scaleY=1):void(a.groupCPopup.scaleX=a.groupCPopup.scaleY=l)}},e.NAME="CPopupSkin",e}(BaseView);__reflect(CPopupView.prototype,"CPopupView");var CRBuffItemView=function(t){function e(){return t.call(this,e.NAME)||this}return __extends(e,t),e.prototype.week=function(){var e=this,a=t.prototype.getData.call(this);if(null!=a){e.buffKey=a.skillKey;var n=a.buffRound,r=a.iconRes;e.updateShow(n,r)}},e.prototype.sleep=function(){},e.prototype.updateShow=function(t,e){void 0===e&&(e="");var a=this;a.lblName.text=t+"",""!=e&&(a.imgIcon.source=e)},e.prototype.getCurBuffKey=function(){return this.buffKey},e.prototype.getViewWidth=function(){return this.groupBufftem.width},e.NAME="CRBuffItemSkin",e}(IBaseView);__reflect(CRBuffItemView.prototype,"CRBuffItemView");var CRCardItemView=function(t){function e(){return t.call(this,e.NAME)||this}return __extends(e,t),e.prototype.week=function(){var e=this,a=t.prototype.getData.call(this);if(null!=a){e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2;var n=null==a.cscaleX?1:a.cscaleX,r=null==a.cscaleY?1:a.cscaleY,o=a.cdata;e.setCardItem(o,n,r)}},e.prototype.sleep=function(){var t=this;t.removeCard()},e.prototype.setCardItem=function(t,e,a){var n=this;n.removeCard(),n.cardData=t,1==LanguageManager.getInstance().getCurLanguageType()&&t.hasOwnProperty("name_en")&&(n.cardData.name=t.name_en);var r=new CardRectangleView;r.initData(t),r.x=0,r.y=0,r.scaleX=e,r.scaleY=a,n.groupCard.addChild(r),n.cardView=r},e.prototype.removeCard=function(){var t=this;null!=t.cardView&&(t.cardView.parent.removeChild(t.cardView),t.cardView=null),t.cardData=null},e.prototype.getCardData=function(){return this.cardData},e.prototype.setDamage=function(t){if(0!=t){var e=this;null!=e.cardView&&e.cardView.setDamage(t)}},e.prototype.modifyLimitHp=function(t){if(0!=t){var e=this;null!=e.cardView&&e.cardView.modifyLimitHp(t)}},e.prototype.modifyAtk=function(t){if(0!=t){var e=this;null!=e.cardView&&e.cardView.modifyAtk(t)}},e.prototype.updateCardData=function(t){var e=this,a=null==e.cardView?1:e.cardView.scaleX,n=null==e.cardView?1:e.cardView.scaleY;e.setCardItem(t,a,n)},e.prototype.forceUpdateAtk=function(t){this.cardView.setAtk(t)},e.prototype.forceUpdateHp=function(t){this.cardView.setHp(t)},e.prototype.getParentByZIndex=function(t){return-1!=t?this.groupFront:this.groupBack},e.prototype.getParentByType=function(t){var e=this,a=e.groupFront;switch(t){case 0:a=e.groupBack;break;case 1:a=e.groupFront;break;case 2:a=e.groupBuffIcon;break;default:a=e.groupFront}return a},e.prototype.getFightExpForm=function(){var t=this;return null==t.fightExpForm&&(t.fightExpForm=new FightExpForm(t)),t.fightExpForm},e.NAME="CRCardItemSkin",e}(IBaseView);__reflect(CRCardItemView.prototype,"CRCardItemView",["ExpFromImpl"]);var CRFetterItemView=function(t){function e(){return t.call(this,e.NAME)||this}return __extends(e,t),e.prototype.week=function(){var e=this,a=t.prototype.getData.call(this);if(null!=a){e.fetterKey=a.skillKey;var n=a.iconRes;e.updateShow(n)}},e.prototype.sleep=function(){},e.prototype.updateShow=function(t){void 0===t&&(t="");var e=this;""!=t&&(e.imgIcon.source=t,e.imgIcon.scaleX=1.2,e.imgIcon.scaleY=1.2,e.imgIcon.alpha=0,egret.Tween.get(e.imgIcon).to({alpha:1},1e3).wait(500).to({scaleX:1,scaleY:1},500))},e.prototype.getCurFetterKey=function(){return this.fetterKey},e.NAME="CRFetterItemSkin",e}(IBaseView);__reflect(CRFetterItemView.prototype,"CRFetterItemView");var CSCardItemView=function(t){function e(){var a=t.call(this,e.NAME)||this;return a.cardState=CombatConstants.CARD_STATE_NOR,a.longPressTime=1,a.clickType=ClickEnum.Click_Nor,a}return __extends(e,t),e.prototype.week=function(){var e=this,a=t.prototype.getData.call(this);if(null!=a){e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2;var n=null==a.cscaleX?1:a.cscaleX,r=null==a.cscaleY?1:a.cscaleY,o=a.cdata;e.setCardItem(o,n,r),e.hasEventListener(egret.TouchEvent.TOUCH_BEGIN)||e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.touchBegin,e),e.hasEventListener(egret.TouchEvent.TOUCH_MOVE)||e.addEventListener(egret.TouchEvent.TOUCH_MOVE,e.touchMove,e),e.hasEventListener(egret.TouchEvent.TOUCH_END)||e.addEventListener(egret.TouchEvent.TOUCH_END,e.touchEnd,e),e.hasEventListener(egret.TouchEvent.TOUCH_CANCEL)||e.addEventListener(egret.TouchEvent.TOUCH_CANCEL,e.touchCancel,e)}},e.prototype.sleep=function(){var t=this;t.removeCard(),t.hasEventListener(egret.TouchEvent.TOUCH_BEGIN)&&t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,t.touchBegin,t),t.hasEventListener(egret.TouchEvent.TOUCH_MOVE)&&t.removeEventListener(egret.TouchEvent.TOUCH_MOVE,t.touchMove,t),t.hasEventListener(egret.TouchEvent.TOUCH_END)&&t.removeEventListener(egret.TouchEvent.TOUCH_END,t.touchEnd,t),t.hasEventListener(egret.TouchEvent.TOUCH_CANCEL)&&t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,t.touchCancel,t)},e.prototype.touchBegin=function(t){},e.prototype.touchMove=function(t){},e.prototype.touchEnd=function(t){},e.prototype.touchCancel=function(t){var e=this;e.RemovePopupInfoView()},e.prototype.RemovePopupInfoView=function(){},e.prototype.OpenTimer=function(){},e.prototype.setCardItem=function(t,e,a){var n=this;n.removeCard(),n.cardData=t,1==LanguageManager.getInstance().getCurLanguageType()&&t.hasOwnProperty("name_en")&&(n.cardData.name=t.name_en);var r=new CardSquareView;r.initData(t),r.x=0,r.y=0,r.scaleX=e,r.scaleY=a,n.groupCard.addChild(r),n.cardView=r},e.prototype.removeCard=function(){var t=this;null!=t.cardView&&(t.cardView.parent.removeChild(t.cardView),t.cardView=null),t.cardData=null},e.prototype.getCardData=function(){return this.cardData},e.prototype.getCardState=function(){return this.cardState},e.prototype.setCardState=function(t){this.cardState=t},e.prototype.changeCardViewColor=function(t){this.cardView.changeViewColor(t)},e.prototype.reduceRound=function(t){void 0===t&&(t=!1);var e=this,a=e.cardView.reduceRound();0>=a&&e.setTouchState(t)},e.prototype.setTouchState=function(t){void 0===t&&(t=!1);var e=this,a=e.cardView.getCurRound();return 0>=a&&t?(e.playClickableEffect(),void((e.cardState==CombatConstants.CARD_STATE_NOR||e.cardState==CombatConstants.CARD_STATE_NON_CLICKABLE)&&(e.cardState=CombatConstants.CARD_STATE_CLICKABLE))):void e.setNonClickable()},e.prototype.setNonClickable=function(){var t=this;t.cancelClickableEffect(),t.cardState=CombatConstants.CARD_STATE_NON_CLICKABLE},e.prototype.playClickableEffect=function(){this.getFightExpForm().addSCContinueSkill(CombatConstants.EFF_CLICKABLE,CombatConstants.SKILL_RES_ATTR)},e.prototype.cancelClickableEffect=function(){this.getFightExpForm().removeContinueSkill(CombatConstants.EFF_CLICKABLE)},e.prototype.getParentByZIndex=function(t){return-1!=t?this.groupFront:this.groupBack},e.prototype.getParentByType=function(t){var e=this,a=e.groupFront;switch(t){case 0:a=e.groupBack;break;case 1:a=e.groupFront;break;default:a=e.groupFront}return a},e.prototype.getFightExpForm=function(){var t=this;return null==t.fightExpForm&&(t.fightExpForm=new FightExpForm(t)),t.fightExpForm},e.NAME="CSCardItemSkin",e}(IBaseView);__reflect(CSCardItemView.prototype,"CSCardItemView",["ExpFromImpl"]);var CSetView=function(t){function e(){return t.call(this,e.NAME)||this}return __extends(e,t),e.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e);var a=t.prototype.getData.call(this);null!=a&&(e.surrenderGameHandler=a.surrenderGameHandler)},e.prototype.sleep=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&t.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t)},e.prototype.touchTap=function(t){var e=this,a=t.target;a instanceof eui.Button?a==e.btnClose?e.hiden():a==e.btnSurrender?(null!=e.surrenderGameHandler&&e.surrenderGameHandler.run(),e.hiden()):a==e.btnHelp&&e.hiden():a instanceof eui.Rect&&a==e.rectBG&&e.hiden()},e.NAME="CSetSkin",e}(BaseView);__reflect(CSetView.prototype,"CSetView");var CSHeadView=function(t){function e(){return t.call(this,e.NAME)||this}return __extends(e,t),e.prototype.week=function(){var e=this,a=t.prototype.getData.call(this);null!=a&&e.updateData(a)},e.prototype.sleep=function(){},e.prototype.setCardHead=function(t){null!=t&&void 0!=t&&(this.imgHead.source="headImg0Sheet_json."+t)},e.prototype.setCardHeadFrame=function(t){switch(t){case"common":this.imgHeadFrame.source="combatImg1Sheet_json.a82x82";break;case"rare":this.imgHeadFrame.source="combatImg1Sheet_json.b82x82";break;case"epic":this.imgHeadFrame.source="combatImg1Sheet_json.c82x82";break;case"legendary":this.imgHeadFrame.source="combatImg1Sheet_json.d82x82";break;case"mythical":this.imgHeadFrame.source="combatImg1Sheet_json.e82x82"}},e.prototype.setAttr=function(t){switch(t){case"metal":this.imgAttr.source="combatImg1Sheet_json.a28x28";break;case"wood":this.imgAttr.source="combatImg1Sheet_json.b28x28";break;case"water":this.imgAttr.source="combatImg1Sheet_json.c28x28";break;case"fire":this.imgAttr.source="combatImg1Sheet_json.d28x28";break;case"earth":this.imgAttr.source="combatImg1Sheet_json.e28x28"}},e.prototype.setCardName=function(t){this.labCardName.text=t},e.prototype.setLvl=function(t,e){var a=this;if(a.GroupStar.numChildren>0)for(var n=a.GroupStar.numChildren-1;n>=0;n--)a.GroupStar.removeChildAt(n);for(var r=a.levelnumTo5lvl(t),n=0;r>n;n++){var o=new eui.Image;a.GroupStar.addChild(o),o.source="combatImg1Sheet_json.a15x15",o.x=15*n,o.y=0}var i=LanguageManager.getInstance().getLabelLanguage(this);a.labGene.text=e+i.lbl_2;var l=a.labGene.width+15*r,C=Number((a.groupCardHead.width/2-l/2).toFixed(2));a.labGene.x=C,a.GroupStar.x=C+a.labGene.width},e.prototype.levelnumTo5lvl=function(t){return(t-1)%5+1},e.prototype.setExpPrb=function(t){this.prbExp.value=100*t},e.prototype.setExpChange=function(t){return null==t||void 0==t?void(this.labExp.visible=!1):void(this.labExp.text="EXP"+t)},e.prototype.setLvlChange=function(t){switch(t){case 0:this.labLvlChange.visible=!1;break;case 1:this.labLvlChange.visible=!0;var e=LanguageManager.getInstance().getLabelLanguage(this);this.labLvlChange.text=e.lbl_0;break;case 2:this.labLvlChange.visible=!0;var e=LanguageManager.getInstance().getLabelLanguage(this);this.labLvlChange.text=e.lbl_1}},e.prototype.updateData=function(t){var e=this,a=t.icon;e.setCardHead(a);var n=t.rarity;e.setCardHeadFrame(n);var r=t.element;e.setAttr(r);var o=t.level,i=t.generation;e.setLvl(o,i);var l=t.name;e.setCardName(l);var C=t.expPercent;e.setExpPrb(C);var s=t.expChange;e.setExpChange(s);var u=t.lvlChange;e.setLvlChange(u)},e.prototype.getViewHeight=function(){return this.groupCardHead.height},e.prototype.getViewWidth=function(){return this.groupCardHead.width},e.NAME="CSHeadSkin",e}(BaseView);__reflect(CSHeadView.prototype,"CSHeadView");var CSSHeadView=function(t){function e(){return t.call(this,e.NAME)||this}return __extends(e,t),e.prototype.week=function(){var e=this,a=t.prototype.getData.call(this);if(null!=a){var n=a.icon;e.setCardHead(n);var r=a.rarity;e.setCardHeadFrame(r);var o=a.element;e.setAttr(o);var i=a.level;e.setLvl(i)}},e.prototype.sleep=function(){},e.prototype.cleanArray=function(t){if(!(null==t||t.length<=0))for(var e=t.length-1;e>=0;e--){var a=t[e];if(null!=a){var n=a.parent;n.removeChild(a)}t.splice(e,1)}},e.prototype.setCardHead=function(t){null!=t&&void 0!=t&&(this.imgHead.source="headImg0Sheet_json."+t)},e.prototype.setCardHeadFrame=function(t){switch(t){case"common":this.imgHeadFrame.source="combatImg1Sheet_json.a82x82";break;case"rare":this.imgHeadFrame.source="combatImg1Sheet_json.b82x82";break;case"epic":this.imgHeadFrame.source="combatImg1Sheet_json.c82x82";break;case"legendary":this.imgHeadFrame.source="combatImg1Sheet_json.d82x82";break;case"mythical":this.imgHeadFrame.source="combatImg1Sheet_json.e82x82"}},e.prototype.setAttr=function(t){switch(t){case"metal":this.imgAttr.source="combatImg1Sheet_json.a28x28";break;case"wood":this.imgAttr.source="combatImg1Sheet_json.b28x28";break;case"water":this.imgAttr.source="combatImg1Sheet_json.c28x28";break;case"fire":this.imgAttr.source="combatImg1Sheet_json.d28x28";break;case"earth":this.imgAttr.source="combatImg1Sheet_json.e28x28"}},e.prototype.setLvl=function(t){for(var e=this.levelnumTo5lvl(t),a=0;e>a;a++){var n=new eui.Image;this.groupStar.addChild(n),n.source="combatImg1Sheet_json.a15x15",n.width=8,n.height=8,n.x=8*a,n.y=0}},e.prototype.levelnumTo5lvl=function(t){return(t-1)%5+1},e.NAME="CSSHeadSkin",e}(IBaseView);__reflect(CSSHeadView.prototype,"CSSHeadView");var CWaitStartView=function(t){function e(){return t.call(this,e.NAME)||this}return __extends(e,t),e.prototype.week=function(){var e=this,a=t.prototype.getData.call(this);null!=a&&e.updateShow(a)},e.prototype.sleep=function(){},e.prototype.startJump=function(){var t=this;t.groupWaitPlayer.visible=!0,t.groupStartCutDown.visible=!1;var e=t.imgPoint0.y;e=60>=e?60:180;for(var a=0;3>a;a++){var n=t["imgPoint"+a];n.y=e,egret.Tween.removeTweens(n),egret.Tween.get(n,{loop:!0}).wait(100*a).to({y:e-30},180,egret.Ease.quartIn).wait(100).to({y:e},200,egret.Ease.quartOut).wait(1e3-100*a)}},e.prototype.startCutDown=function(t){var e=this;e.groupWaitPlayer.visible=!1,e.groupStartCutDown.visible=!0,e.timeCounter=t,e.updateTimeShow(),0==t&&e.hiden()},e.prototype.updateTimeShow=function(){var t=this;t.bitCutdown.text=t.timeCounter+""},e.prototype.updateShow=function(t){var e=this,a=t.type;if(0!=a){var n=t.cutdown;e.startCutDown(n)}else e.startJump()},e.NAME="CWaitStartSkin",e}(BaseView);__reflect(CWaitStartView.prototype,"CWaitStartView");var CAtkHeadView=function(t){function e(){return t.call(this,e.NAME)||this}return __extends(e,t),e.prototype.week=function(){var e=this;e.setImgMask();var a=t.prototype.getData.call(this);if(null!=a){var n=a.name;e.setName(n);var r=a.hp;e.origHp=r;var o=a.leftHp;e.setHp(o);var i=a.lv;e.setLv(i);var l=a.power;e.setPower(l);var C=a.ticket;e.ticket=C;var s=a.iconUrl;(null==s||""==s)&&(s="headicon_json.head_01"),e.imgIcon.source=s}},e.prototype.sleep=function(){var t=this;null!=t.iconMaskShape&&(t.iconMaskShape.parent.removeChild(t.iconMaskShape),t.iconMaskShape=null),null!=t.hpMaskShape&&(t.hpMaskShape.parent.removeChild(t.hpMaskShape),t.hpMaskShape=null),t.origHp=null},e.prototype.setImgMask=function(){var t=this,e=new egret.Shape;e.graphics.beginFill(0);var a=t.imgHp.width/2,n=t.imgHp.height/2;e.x=a,e.y=n,e.rotation=-90,e.graphics.drawCircle(0,0,n),e.graphics.endFill(),t.groupHp.addChild(e),t.hpMaskShape=e,t.imgHp.mask=e;var r=new egret.Shape;r.graphics.beginFill(0),a=t.imgIcon.width/2,n=t.imgIcon.height/2,r.x=a,r.y=n,r.graphics.drawCircle(0,0,a),r.graphics.endFill(),t.groupIcon.addChild(r),t.iconMaskShape=r,t.imgIcon.mask=r},e.prototype.setHpProgressBar=function(t){var e=this;if(null!=e.hpMaskShape){var a=e.hpMaskShape,n=360*(1-t);1==t?n=360:0==t&&(n=0),a.graphics.clear(),a.graphics.beginFill(0);var r=e.imgHp.height/2;a.graphics.moveTo(0,0),a.graphics.lineTo(r,0),a.graphics.drawArc(0,0,r,0,n*Math.PI/180,!0),a.graphics.lineTo(0,0),a.graphics.endFill()}},e.prototype.setName=function(t){var e=null==t||void 0==t?"":t;this.lblName.text=e},e.prototype.setHp=function(t){var e=this,a=null==t||void 0==t?"0":t.toString();e.lblHp.text="HP:"+a,e.curHp=t,e.setHpProgressBar(t/e.origHp)},e.prototype.setLv=function(t){var e=null==t||void 0==t?"0":t.toString();this.lblLv.text=e},e.prototype.setPower=function(t){var e=null==t||void 0==t?"0":t.toString();this.lblPower.text=e},e.prototype.onLoadImgCompleteHandler=function(t){if(t.currentTarget.data){var e=this,a=new egret.Texture;a.bitmapData=t.currentTarget.data;var n=new egret.Bitmap(a);n.x=0,n.y=0,n.width=e.imgIcon.width,n.height=e.imgIcon.height,e.groupIcon.addChild(n),e.imgIcon.visible=!1}},e.prototype.getFetterParent=function(){var t=this;return t.groupFetter0.numChildren<=0?t.groupFetter0:t.groupFetter1.numChildren<=0?t.groupFetter1:t.groupFetter2.numChildren<=0?t.groupFetter2:t.groupFetter3},e.prototype.setDamage=function(t){var e=this,a=e.curHp+t;a=a>=e.origHp?e.origHp:a,a=0>=a?0:a,e.setHp(a)},e.prototype.getTicket=function(){return this.ticket},e.prototype.getHp=function(){return this.curHp},e.prototype.getParentByZIndex=function(t){return-1!=t?this.groupFront:this.groupBack},e.prototype.getParentByType=function(t){var e=this,a=e.groupFront;switch(t){case 0:a=e.groupBack;break;case 1:a=e.groupFront;break;case 2:a=e.getFetterParent();break;default:a=e.groupFront}return a},e.prototype.getFightExpForm=function(){var t=this;return null==t.fightExpForm&&(t.fightExpForm=new FightExpForm(t)),t.fightExpForm},e.NAME="CAtkHeadSkin",e}(IBaseView);__reflect(CAtkHeadView.prototype,"CAtkHeadView",["ExpFromImpl"]);var CombatCmdDef;!function(t){t[t.CMD_DISCONNECT_GAME=1001]="CMD_DISCONNECT_GAME",t[t.CMD_RECONNECT_GAME=1002]="CMD_RECONNECT_GAME",t[t.CMD_ENTER_GAME=1003]="CMD_ENTER_GAME",t[t.CMD_ENTER_COUNT_TIME=1004]="CMD_ENTER_COUNT_TIME",t[t.CMD_SYN_OTHER_DATA_GAME=1005]="CMD_SYN_OTHER_DATA_GAME",t[t.CMD_SYN_ME_DATA_GAME=1006]="CMD_SYN_ME_DATA_GAME",t[t.CMD_SNED_CARD=1007]="CMD_SNED_CARD",t[t.CMD_SYN_PLAY_CARD_TIME=1008]="CMD_SYN_PLAY_CARD_TIME",t[t.CMD_OUT_CARD=1009]="CMD_OUT_CARD",t[t.CMD_SYN_PLAY_CARD_DATA=1010]="CMD_SYN_PLAY_CARD_DATA",t[t.CMD_SYN_GAME_RESULT_DATA=1011]="CMD_SYN_GAME_RESULT_DATA",t[t.CMD_SYN_CHANGE_ROUND_DATA_GAME=1012]="CMD_SYN_CHANGE_ROUND_DATA_GAME",t[t.CMD_SYN_BATTLE_DATA_GAME=1013]="CMD_SYN_BATTLE_DATA_GAME",t[t.CMD_SYN_ATK_DATA_GAME=1014]="CMD_SYN_ATK_DATA_GAME",t[t.CMD_SURRENDER_GAME=1015]="CMD_SURRENDER_GAME",t[t.CMD_START_BATTLE=1016]="CMD_START_BATTLE",t[t.CMD_SYN_HOSTING=1017]="CMD_SYN_HOSTING",t[t.CMD_SYN_START_FETTER=1018]="CMD_SYN_START_FETTER",t[t.CMD_REQ_QUICK_SETTLEMENT=1019]="CMD_REQ_QUICK_SETTLEMENT",t[t.CMD_PRO_QUICK_SETTLEMENT=1020]="CMD_PRO_QUICK_SETTLEMENT",t[t.CMD_SYN_DISSOLUTION_GAME=1099]="CMD_SYN_DISSOLUTION_GAME",t[t.CMD_DEBUG_GET_BUFF_CD=1030]="CMD_DEBUG_GET_BUFF_CD",t[t.CMD_FORCE_RECONNECT_GAME=900]="CMD_FORCE_RECONNECT_GAME"}(CombatCmdDef||(CombatCmdDef={}));var CombatDecoder=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initDecoderFunction=function(){var t=this;for(var e in CombatCmdDef){var a=e;if(isNaN(a)){var n=CombatCmdDef[e],r=n,o=t.method_Combat;o&&t.registerCmd(r,o)}}},e.prototype.removeDecoderFunction=function(){var t=this;for(var e in CombatCmdDef){var a=e;if(isNaN(a)){var n=CombatCmdDef[e],r=n,o=t.method_Combat;o&&t.unRegisterFunction(r)}}},e.prototype.method_Combat=function(t,e){var a=UIManager.getInstance().getViewByName(CombatView);null!=a&&a.recvData(e,t.msg)},e}(BaseDecoder);__reflect(CombatDecoder.prototype,"CombatDecoder");var CDebugConfig=function(){function t(){}return t.getInstance=function(){var e=this;return null==e.m_manager&&(e.m_manager=new t,e.m_manager.initConfig()),e.m_manager},t.prototype.initConfig=function(){var t=this,e=RES.getRes("debugConfig_json");t.configs=e},t.prototype.getCombatParser=function(t){var e=this,a=e.configs.Atkc_Hand,n=e.configs.Atkc_Out,r=e.configs.Atkc_Death,o=e.configs.Dfdc_Hand,i=e.configs.Dfdc_Out,l=e.configs.Dfdc_Death,C=e.configs.Player_Id;C=C;var s={view:t,playerId:C,atkHandCard:a,atkOutCard:n,atkDeathCard:r,dfdHandCard:o,dfdOutCard:i,dfdDeathCard:l},u=new CombatParser(s);return e.combatParser=u,u},t.prototype.onPlayCombatSerial=function(t){var e=this,a=new CombatSerial(e.combatParser),n="Click_"+t+"_Play_Key",r=e.configs[n];if(null!=r){var o=e.configs.Combat_Serial;if(null!=o){var i=o[r];if(null!=i){for(var l in i){var C=i[l];if(null!=C){var s=CombatUtils.getConfig(C,CombatNode);a.addNode(s)}}a.startPlay()}}}},t}();__reflect(CDebugConfig.prototype,"CDebugConfig");var CombatAction=function(){function t(){}return t.playActions=function(t,e,a){if(!(null==t||t.length<=0)){var n=t[0],r=n.loop,o=egret.Tween.get(e,{loop:r});for(var i in t){var l=t[i];if(null!=l){var C={};null!=l.moveX?C.x=e.x+l.moveX:null!=l.moveToX&&(C.x=l.moveToX),null!=l.moveY?C.y=e.y+l.moveY:null!=l.moveToY&&(C.y=l.moveToY),null!=l.rotateRange&&(C.rotation=l.rotateRange),null!=l.alpha&&(C.alpha=l.alpha);var s=Object.keys(C),u=s.length;u>0?o.wait(l.preDelay).to(C,l.speed).wait(l.postDelay):o.wait(l.preDelay).wait(l.postDelay)}}null!=a&&o.call(function(){a.run()}),n.remove&&o.call(function(){e.parent&&e.parent.removeChild(e)})}},t.playAction=function(t,e,a){if(null==t)return null;var n=egret.Tween.get(e,{loop:t.loop}),r={};null!=t.moveX?r.x=e.x+t.moveX:null!=t.moveToX&&(r.x=t.moveToX),null!=t.moveY?r.y=e.y+t.moveY:null!=t.moveToY&&(r.y=t.moveToY),null!=t.rotateRange&&(r.rotation=t.rotateRange),null!=t.alpha&&(r.alpha=t.alpha),n.wait(t.preDelay).to(r,t.speed).wait(t.postDelay),null!=a&&n.call(function(){a.run()}),t.remove&&n.call(function(){e.parent&&e.parent.removeChild(e)})},t.recoverAction=function(t){if(null!=t&&null!=t.target&&null!=t.oriData){var e=t.target,a=t.oriData;egret.Tween.removeTweens(e),null!=a.x&&(e.x=a.x),null!=a.y&&(e.y=a.y),null!=a.rotation&&(e.rotation=a.rotation),null!=a.alpha&&(e.alpha=a.alpha)}},t.completeAction=function(t){if(null!=t&&null!=t.target&&null!=t.endData){var e=t.target,a=t.endData;egret.Tween.removeTweens(e),null!=a.x&&(e.x=a.x),null!=a.y&&(e.y=a.y),null!=a.rotation&&(e.rotation=a.rotation),null!=a.alpha&&(e.alpha=a.alpha)}},t}();__reflect(CombatAction.prototype,"CombatAction");var CombatConfig=function(){function t(){}return t.getInstance=function(){var e=this;return null==e.m_manager&&(e.m_manager=new t,e.m_manager.initConfig()),e.m_manager},t.prototype.initConfig=function(){var t=this,e=RES.getRes(CombatConstants.COMBAT_CONFIG_JSON);t.configs=e},t.prototype.getHeadCommonExpFormsConfig=function(){return this.configs[CombatConstants.HEAD_COMMON_EXP_FORMS]},t.prototype.getHeadSkillExpFormsConfig=function(){return this.configs[CombatConstants.HEAD_SKILL_EXP_FORMS]},t.prototype.getHeadFetterExpFormsConfig=function(){return this.configs[CombatConstants.HEAD_FETTER_EXP_FORMS]},t.prototype.getRCBuffExpFormsConfig=function(){return this.configs[CombatConstants.RC_BUFF_EXP_FORMS]},t.prototype.getRCCommonExpFormsConfig=function(){return this.configs[CombatConstants.RC_COMMON_EXP_FORMS]},t.prototype.getRCSkillExpFormsConfig=function(){return this.configs[CombatConstants.RC_SKILL_EXP_FORMS]},t.prototype.getRCFetterExpFormsConfig=function(){return this.configs[CombatConstants.RC_FETTER_EXP_FORMS]},t.prototype.getSCSkillExpFormsConfig=function(){return this.configs[CombatConstants.SC_SKILL_EXP_FORMS]},t.prototype.getSendCardConfigByPlace=function(t){var e=t==CombatConstants.PLACE_ATK?CombatConstants.ATKC_ATTR:CombatConstants.DFDC_ATTR,a=this.configs[CombatConstants.SEND_CARD],n=a[e];return CombatUtils.getConfig(n,SendCardConfig)},t.prototype.getOutCardConfigByPlace=function(t){var e=t==CombatConstants.PLACE_ATK?CombatConstants.ATKC_ATTR:CombatConstants.DFDC_ATTR,a=this.configs[CombatConstants.OUT_CARD],n=a[e];return CombatUtils.getConfig(n,OutCardConfig)},t.prototype.getDeathCardConfigByPlace=function(t){var e=t==CombatConstants.PLACE_ATK?CombatConstants.ATKC_ATTR:CombatConstants.DFDC_ATTR,a=this.configs[CombatConstants.DEATH_CARD],n=a[e];return CombatUtils.getConfig(n,DeathCardConfig)},t.prototype.getCommonActionDataById=function(t){if(null==t||""==t)return null;var e=this.configs[CombatConstants.COMMON_ACTIONS];return e[t]},t.prototype.getActionAttrConfig=function(t){if(null==t)return null;var e=CombatUtils.getConfig(t[CombatConstants.ATTR_ACT],CActionConfig);return null==e?null:(e.speed=CombatUtils.getAMSpeed(e.speed),e.preDelay=CombatUtils.getAMSpeed(e.preDelay),e.postDelay=CombatUtils.getAMSpeed(e.postDelay),e)},t.prototype.getActionConfig=function(t,e){if(void 0===e&&(e=null),null==t)return null;var a=new CActionConfig;return t.hasOwnProperty(CombatConstants.ATTR_MOVE_X)?a.moveX=t[CombatConstants.ATTR_MOVE_X]:t.hasOwnProperty(CombatConstants.ATTR_MOVE_TO_X)&&(a.moveToX=t[CombatConstants.ATTR_MOVE_TO_X]),t.hasOwnProperty(CombatConstants.ATTR_MOVE_Y)?a.moveY=t[CombatConstants.ATTR_MOVE_Y]:t.hasOwnProperty(CombatConstants.ATTR_MOVE_TO_Y)&&(a.moveToY=t[CombatConstants.ATTR_MOVE_TO_Y]),t.hasOwnProperty(CombatConstants.ATTR_ROTATE_RANGE)&&(a.rotateRange=t[CombatConstants.ATTR_ROTATE_RANGE]),t.hasOwnProperty(CombatConstants.ATTR_ALPHA)&&(a.alpha=t[CombatConstants.ATTR_ALPHA]),t.hasOwnProperty(CombatConstants.ATTR_LOOP)?a.loop=t[CombatConstants.ATTR_LOOP]:null!=e&&(a.loop=e.loop),t.hasOwnProperty(CombatConstants.ATTR_SPEED)?a.speed=CombatUtils.getAMSpeed(t[CombatConstants.ATTR_SPEED]):null!=e&&(a.speed=e.speed),t.hasOwnProperty(CombatConstants.ATTR_PRE_DELAY)?a.preDelay=CombatUtils.getAMSpeed(t[CombatConstants.ATTR_PRE_DELAY]):null!=e&&(a.preDelay=e.preDelay),t.hasOwnProperty(CombatConstants.ATTR_POST_DELAY)?a.postDelay=CombatUtils.getAMSpeed(t[CombatConstants.ATTR_POST_DELAY]):null!=e&&(a.postDelay=e.postDelay),t.hasOwnProperty(CombatConstants.ATTR_REMOVE)?a.remove=t[CombatConstants.ATTR_REMOVE]:null!=e&&(a.remove=e.remove),a},t.prototype.getEffComponentConfig=function(t,e){if(null==t)return null;var a=t[CombatConstants.COMPONENT_ID],n=this.configs[CombatConstants.EFF_COMPONENTS];if(null==n)return null;var r=n[e];if(null==r)return null;var o;switch(e){case CombatConstants.EFF_COMP_IMAGE:o=ImageConfig;break;case CombatConstants.EFF_COMP_IMAGES:o=ImageConfig;break;case CombatConstants.EFF_COMP_BITMAP_LABELS:o=BitmapLabelConfig;break;case CombatConstants.EFF_COMP_LABELS:o=LabelConfig;break;case CombatConstants.EFF_COMP_MOVIECLIPS:o=MovieClipConfig}var i=CombatUtils.getConfig(r[a],o);return CombatUtils.assignmentObj(i,t),null!=i.frameRate&&(i.frameRate=CombatUtils.getAMFrameRate(i.frameRate)),i},t.prototype.getConfigs=function(){return this.configs},t}();__reflect(CombatConfig.prototype,"CombatConfig");var CombatConstants=function(){function t(){}return t.OPT_TYPE_NO_ACTION=0,t.OPT_TYPE_SEND_CARD=1,t.OPT_TYPE_REDUCE_ROUND=2,t.OPT_TYPE_OUT_CARD=3,t.OPT_TYPE_ATK_NOR=4,t.OPT_TYPE_ATK_SKILL=5,t.OPT_TYPE_DEATH=6,t.OPT_TYPE_REVIVE=7,t.OPT_TYPE_ROUND_RECOVER=8,t.OPT_TYPE_ROUND_LOST=9,t.OPT_TYPE_MODIFY_ATTRIBUTE=10,t.OPT_TYPE_PERSUADE_BACK=11,t.OPT_TYPE_OUT_CARD_BACK=13,t.OPT_TYPE_SORT_HAND_CARD=14,t.OPT_TYPE_SORT_OUT_CARD=15,t.OPT_TYPE_SORT_DEATH_CARD=16,t.OPT_TYPE_SEL_CARD=17,t.OPT_TYPE_FORCE_DESEL_CARD=18,t.OPT_TYPE_SET_NON_CLICKABLE=19,t.OPT_TYPE_ATK_SKILL_CONT=20,t.OPT_TYPE_ATK_SKILL_DECONT=21,t.OPT_TYPE_BUFF_ADD=23,t.OPT_TYPE_BUFF_REMOVE=24,t.OPT_TYPE_BUFF_UPDATE=25,t.OPT_TYPE_FETTER_ADD=26,t.OPT_TYPE_FETTER_REMOVE=27,t.FIGHT_ACCELERATION_MULTIPLE=1,t.PLACE_ATK=0,t.PLACE_DFD=1,t.CARD_GROUP_ATK_HAND=0,t.CARD_GROUP_DFD_HAND=1,t.CARD_GROUP_ATK_OUT=2,t.CARD_GROUP_DFD_OUT=3,t.CARD_GROUP_ATK_DEATH=4,t.CARD_GROUP_DFD_DEATH=5,t.CARD_HAND_MAX_COUNT=5,t.CARD_OUT_MAX_COUNT=5,t.REQ_QUICK_SETTLEMENT_MAX_COUNT=3,t.CARD_SQUARE_GROUP_PREFIX="groupCS_",t.CARD_RECTANGLE_GROUP_PREFIX="groupRS_",t.FIGHT_TYPE_USER=0,t.FIGHT_TYPE_OUT_CARD=1,t.FIGHT_TYPE_HAND_CARD=2,t.FIGHT_TYPE_READY_CARD=3,t.COMBAT_TYPE_ATK_NOR=0,t.COMBAT_TYPE_ATK_SKILL=1,t.COMBAT_TYPE_BUFF_ADD=2,t.COMBAT_TYPE_BUFF_REMOVE=3,t.COMBAT_TYPE_BUFF_UPDATE=4,t.COMBAT_TYPE_REVIVE=5,t.COMBAT_TYPE_ROUND_RECOVER=6,t.COMBAT_TYPE_ROUND_LOST=7,t.COMBAT_TYPE_MODIFY_ATTRIBUTE=8,t.COMBAT_TYPE_PERSUADE_BACK=9,t.COMBAT_TYPE_FETTER_ADD=10,t.COMBAT_TYPE_FETTER_REMOVE=11,t.CARD_STATE_NOR=0,t.CARD_STATE_CLICKABLE=1,t.CARD_STATE_CLICKED=2,t.CARD_STATE_NON_CLICKABLE=3,t.COMBAT_CONFIG_JSON="combatConfig_json",t.SEND_CARD="Send_Card",t.OUT_CARD="Out_Card",t.DEATH_CARD="Death_Card",t.HEAD_COMMON_EXP_FORMS="Head_Common_ExpForms",t.HEAD_SKILL_EXP_FORMS="Head_Skill_ExpForms",t.HEAD_FETTER_EXP_FORMS="Head_Fetter_ExpForms",t.RC_COMMON_EXP_FORMS="RC_Common_ExpForms",t.RC_BUFF_EXP_FORMS="RC_Buff_ExpForms",t.RC_SKILL_EXP_FORMS="RC_Skill_ExpForms",t.RC_FETTER_EXP_FORMS="RC_Fetter_ExpForms",t.SC_SKILL_EXP_FORMS="SC_Skill_ExpForms",t.EFF_COMPONENTS="Eff_Components",t.COMMON_ACTIONS="Common_Actions",t.EXP_FORM_ATK="atk",t.EXP_FORM_HIT="hit",t.EXP_FORM_RECOVER="recover",t.EXP_FORM_LOST="lost",t.EXP_FORM_EVASIVE="evasive",t.EXP_FORM_DEATH="death",t.EXP_FORM_RELEASE="release",t.EXP_FORM_MODIFY="modify",t.SKILL_RES_ATTR="res_attr",t.SKILL_REC_ATTR="rec_attr",t.EFF_COMP="eff_comp",t.USAGE_TIME="usage_time",t.ATKC_ATTR="atkc_attr",t.DFDC_ATTR="dfdc_attr",t.COMPONENT_ID="compId",t.ACTION_ID="actId",t.EFF_COMP_IMAGE="image",t.EFF_COMP_IMAGES="images",t.EFF_COMP_BITMAP_LABELS="bitmapLabels",t.EFF_COMP_LABELS="labels",t.EFF_COMP_MOVIECLIPS="movieClips",t.EFF_COMP_LABEL_REDUCE="reduceShow",t.EFF_COMP_LABEL_INCREASE="increaseShow",t.EFF_ACTS="acts",t.ATTR_ACT="act_attr",t.ATTR_RES="res",t.ATTR_JS_NAME="jsName",t.ATTR_MC_NAME="mcName",t.ATTR_POS_X="posX",t.ATTR_POS_Y="posY",t.ATTR_GAP_X="gapX",t.ATTR_GAP_Y="gapY",t.ATTR_SCALE_X="scaleX",t.ATTR_SCALE_Y="scaleY",t.ATTR_ROTATION="rotation",t.ATTR_SPACE="space",t.ATTR_TEXT="text",t.ATTR_TEXT_COLOR="textColor",t.ATTR_FONT_FAMILY="fontFamily",t.ATTR_STROKE="stroke",t.ATTR_STROKE_COLOR="strokeColor",t.ATTR_ZINDEX="zIndex",t.ATTR_MOVE_X="moveX",t.ATTR_MOVE_Y="moveY",t.ATTR_MOVE_TO_X="moveToX",t.ATTR_MOVE_TO_Y="moveToY",t.ATTR_ROTATE_RANGE="rotateRange",t.ATTR_ALPHA="alpha",t.ATTR_LOOP="loop",t.ATTR_SPEED="speed",t.ATTR_PRE_DELAY="preDelay",t.ATTR_POST_DELAY="postDelay",t.ATTR_REMOVE="remove",t.ATTR_PLAYTIMES="playTimes",t.ATTR_FRAMERATE="frameRate",t.EFF_CLICKABLE="eff_clickable",t.FIGHT_DATA="fightData",t.BUFF_DATA="buffData",t.FETTER_DATA="fetterData",t.MODIFY_ATTRIBUTE_HP="mhp",t.MODIFY_ATTRIBUTE_LIMIT_HP="mlhp",t.MODIFY_ATTRIBUTE_ATK="matk",t.MODIFY_ATTRIBUTE_SKILL_CD="mscd",t.MODIFY_ATTRIBUTE_REDUCE_DAMAGE="mrda",t
}();__reflect(CombatConstants.prototype,"CombatConstants");var ClickEnum;!function(t){t[t.Click_Nor=0]="Click_Nor",t[t.Click_MoveLeave=1]="Click_MoveLeave",t[t.Click_LongPress=2]="Click_LongPress"}(ClickEnum||(ClickEnum={}));var CombatEffComp=function(){function t(){}return t.addMovieClipByConfig=function(t,e){if(null==t||null==e)return null;var a=new UIMovieClip;return a.scaleX=t.scaleX,a.scaleY=t.scaleY,a.x=t.posX+t.gapX,a.y=t.posY+t.gapY,a.source=t.jsName+"."+t.mcName,a.gotoAndPlay(t.actName,t.playTimes),-1!=t.frameRate&&(a.frameRate=t.frameRate),e.addChild(a),t.anchorCenter&&(a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2),t.posCenter&&(a.x=e.width/2+t.gapX,a.y=e.height/2+t.gapY),a},t.addImageByConfig=function(t,e){if(null==t||null==e)return null;var a=new eui.Image;return a.scaleX=t.scaleX,a.scaleY=t.scaleY,a.x=t.posX+t.gapX,a.y=t.posY+t.gapY,a.source=t.res,e.addChild(a),t.anchorCenter&&(a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2),t.posCenter&&(a.x=e.width/2+t.gapX,a.y=e.height/2+t.gapY),a},t.addBitmapLabelByConfig=function(t,e,a){if(void 0===a&&(a=""),null==t||null==e)return null;var n=new eui.BitmapLabel;return n.scaleX=t.scaleX,n.scaleY=t.scaleY,n.x=t.posX+t.gapX,n.y=t.posY+t.gapY,n.font=t.res,n.text=a,e.addChild(n),t.anchorCenter&&(n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2),t.posCenter&&(n.x=e.width/2+t.gapX,n.y=e.height/2+t.gapY),n},t.addLabelByConfig=function(t,e,a){if(void 0===a&&(a=""),null==t||null==e)return null;var n=new eui.Label;return n.scaleX=t.scaleX,n.scaleY=t.scaleY,n.x=t.posX+t.gapX,n.y=t.posY+t.gapY,n.text=""==a?t.text:a,n.size=t.size,n.textColor=t.textColor,n.fontFamily=t.fontFamily,n.stroke=t.stroke,n.strokeColor=t.strokeColor,n.bold=t.bold,n.lineSpacing=t.lineSpacing,n.textAlign=t.textAlign,n.wordWrap=t.wordWrap,e.addChild(n),-1!=t.width&&(n.width=t.width),-1!=t.height&&(n.height=t.height),t.anchorCenter&&(n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2),t.posCenter&&(n.x=e.width/2+t.gapX,n.y=e.height/2+t.gapY),n},t}();__reflect(CombatEffComp.prototype,"CombatEffComp");var CombatFactory=function(){function t(){}return t.createCombatNode=function(t,e){void 0===e&&(e=null);var a=new CombatNode;switch(a.optType=t,a.optRankId=CombatUtils.getRankId(),t){case CombatConstants.OPT_TYPE_SEND_CARD:var n=e.place,r=e.card;a.senderPlace=n,a.optCardData=r;break;case CombatConstants.OPT_TYPE_REDUCE_ROUND:var n=e.place;a.receiverPlace=n,a.senderPlace=CombatConstants.PLACE_ATK;break;case CombatConstants.OPT_TYPE_OUT_CARD:var n=e.place,r=e.card;a.senderPlace=n,a.optCardData=r,a.removeCard=!0;break;case CombatConstants.OPT_TYPE_SORT_HAND_CARD:case CombatConstants.OPT_TYPE_SORT_OUT_CARD:case CombatConstants.OPT_TYPE_SORT_DEATH_CARD:var n=e.place;a.senderPlace=n;break;case CombatConstants.OPT_TYPE_SEL_CARD:var n=e.place,o=e.code;a.senderPlace=n,a.fromTarget=o;break;case CombatConstants.OPT_TYPE_FORCE_DESEL_CARD:break;case CombatConstants.OPT_TYPE_SET_NON_CLICKABLE:break;case CombatConstants.OPT_TYPE_ATK_NOR:for(var i=e[CombatConstants.FIGHT_DATA],l=i.fromTarget,C=i.fightNodeArr,s=i.showDrift,u=0,c=C.length;c>u;u++){var d=C[u];if(null!=d&&s){var p=CombatUtils.getSymbolStr(d.damage);d.damage<=0?(0==d.damage&&p.length>0&&"-"!=p.substr(0,1)&&(p="-"+p),d.damageShow=p):d.recoverShow=p}}a.fromTarget=l,a.fightNodeArr=C;break;case CombatConstants.OPT_TYPE_ATK_SKILL:var i=e[CombatConstants.FIGHT_DATA],l=i.fromTarget,C=i.fightNodeArr,m=i.skillKey,s=i.showDrift;if(s)for(var u=0,c=C.length;c>u;u++){var d=C[u];if(null!=d){var p=CombatUtils.getSymbolStr(d.damage);d.damage<=0?(0==d.damage&&p.length>0&&"-"!=p.substr(0,1)&&(p="-"+p),d.damageShow=p):d.recoverShow=p}}a.fromTarget=l,a.fightNodeArr=C,a.skillKey=m;break;case CombatConstants.OPT_TYPE_REVIVE:case CombatConstants.OPT_TYPE_PERSUADE_BACK:var i=e[CombatConstants.FIGHT_DATA],l=i.fromTarget,C=i.fightNodeArr,m=i.skillKey,s=i.showDrift;if(s)for(var u=0,c=C.length;c>u;u++){var d=C[u];if(null!=d){var p=CombatUtils.getSymbolStr(d.damage);d.damage<0?d.damageShow=p:(0==d.damage&&p.length>0&&"+"!=p.substr(0,1)&&(p="+"+p),d.recoverShow=p)}}a.fromTarget=l,a.fightNodeArr=C,a.skillKey=m,a.removeCard=!0;break;case CombatConstants.OPT_TYPE_ROUND_RECOVER:var i=e[CombatConstants.FIGHT_DATA],C=i.fightNodeArr,s=i.showDrift;if(s)for(var u=0,c=C.length;c>u;u++){var d=C[u];if(null!=d){var p=CombatUtils.getSymbolStr(d.damage);d.damage<0?d.damageShow=p:(0==d.damage&&p.length>0&&"+"!=p.substr(0,1)&&(p="+"+p),d.recoverShow=p)}}a.fightNodeArr=C;break;case CombatConstants.OPT_TYPE_ROUND_LOST:var i=e[CombatConstants.FIGHT_DATA],C=i.fightNodeArr,s=i.showDrift;if(s)for(var u=0,c=C.length;c>u;u++){var d=C[u];if(null!=d){var p=CombatUtils.getSymbolStr(d.damage);d.damage<=0?(0==d.damage&&p.length>0&&"-"!=p.substr(0,1)&&(p="-"+p),d.damageShow=p):d.recoverShow=p}}a.fightNodeArr=C;break;case CombatConstants.OPT_TYPE_MODIFY_ATTRIBUTE:var i=e[CombatConstants.FIGHT_DATA],l=i.fromTarget,C=i.fightNodeArr,m=i.skillKey,s=i.showDrift;if(s)for(var u=0,c=C.length;c>u;u++){var d=C[u];if(null!=d){var _=d.toTargetObj;if(null!=_){var g=CombatConstants.MODIFY_ATTRIBUTE_HP,f=CombatConstants.MODIFY_ATTRIBUTE_LIMIT_HP,T=CombatConstants.MODIFY_ATTRIBUTE_ATK,b=CombatConstants.MODIFY_ATTRIBUTE_SKILL_CD,h="",v=0;if(null!=_[g]?(v=_[g],h=g):null!=_[f]?(v=_[f],h=f):null!=_[T]?(v=_[T],h=T):null!=_[b]&&(v=_[b],h=b),""!=h){var p=CombatUtils.getSymbolAttributeStr(h,v);0>v?d.reduceShow=p:d.increaseShow=p}}}}a.fromTarget=l,a.fightNodeArr=C,a.skillKey=m;break;case CombatConstants.OPT_TYPE_FETTER_ADD:var i=e[CombatConstants.FETTER_DATA],l=i.fromTarget,C=i.fightNodeArr,m=i.skillKey,s=i.showDrift;if(s)for(var u=0,c=C.length;c>u;u++){var d=C[u];if(null!=d){var _=d.toTargetObj;if(null!=_){var g=CombatConstants.MODIFY_ATTRIBUTE_HP,f=CombatConstants.MODIFY_ATTRIBUTE_LIMIT_HP,T=CombatConstants.MODIFY_ATTRIBUTE_ATK,b=CombatConstants.MODIFY_ATTRIBUTE_SKILL_CD,E=CombatConstants.MODIFY_ATTRIBUTE_REDUCE_DAMAGE,A="",D="";if(null!=_[g]){var v=_[g],y=CombatUtils.getSymbolAttributeStr(g,v);0>v?A+=y:D+=y}if(null!=_[f]){var v=_[f],y=CombatUtils.getSymbolAttributeStr(f,v);0>v?A+=y:D+=y}if(null!=_[T]){var v=_[T],y=CombatUtils.getSymbolAttributeStr(T,v);0>v?A+=y:D+=y}if(null!=_[b]){var v=_[b],y=CombatUtils.getSymbolAttributeStr(b,v);0>v?A+=y:D+=y}if(null!=_[E]){var v=_[E],y=CombatUtils.getSymbolAttributeStr(E,v);0>v?A+=y:D+=y}""!=D&&(d.increaseShow=D),""!=A&&(d.reduceShow=A)}}}a.fromTarget=l,a.fightNodeArr=C,a.skillKey=m;break;case CombatConstants.OPT_TYPE_ATK_SKILL_CONT:case CombatConstants.OPT_TYPE_ATK_SKILL_DECONT:case CombatConstants.OPT_TYPE_BUFF_ADD:case CombatConstants.OPT_TYPE_BUFF_REMOVE:case CombatConstants.OPT_TYPE_BUFF_UPDATE:var S=e[CombatConstants.BUFF_DATA],C=S.fightNodeArr,m=S.skillKey;a.fightNodeArr=C,a.skillKey=m}return a},t.createCombatSerial=function(t,e,a){void 0===a&&(a=null);for(var n=new CombatSerial(t,a),r=0,o=e.length;o>r;r++){var i=e[r];null!=i&&n.addNode(i)}return n.startPlay(),n},t}();__reflect(CombatFactory.prototype,"CombatFactory");var CombatParser=function(){function t(t){this.initData(t)}return t.prototype.initData=function(t){var e=this;e.contextData=t,e.arrAtkHandCardView=new Array,e.arrDfdHandCardView=new Array,e.arrAtkOutCardView=new Array,e.arrDfdOutCardView=new Array,e.arrAtkDeathCardView=new Array,e.arrDfdDeathCardView=new Array,e.atkHeadView=null,e.dfdHeadView=null,e.arrCombatOptNote=new Array,e.createCardViewByArr(CombatConstants.CARD_GROUP_ATK_HAND,t.atkHandCard),e.createCardViewByArr(CombatConstants.CARD_GROUP_DFD_HAND,t.dfdHandCard),e.createCardViewByArr(CombatConstants.CARD_GROUP_ATK_OUT,t.atkOutCard),e.createCardViewByArr(CombatConstants.CARD_GROUP_DFD_OUT,t.dfdOutCard),e.createCardViewByArr(CombatConstants.CARD_GROUP_ATK_DEATH,t.atkDeathCard),e.createCardViewByArr(CombatConstants.CARD_GROUP_DFD_DEATH,t.dfdDeathCard)},t.prototype.cleanData=function(){var t=this;t.cleanArray(t.arrAtkHandCardView),t.cleanArray(t.arrDfdHandCardView),t.cleanArray(t.arrAtkOutCardView),t.cleanArray(t.arrDfdOutCardView),t.cleanArray(t.arrAtkDeathCardView),t.cleanArray(t.arrDfdDeathCardView),t.atkHeadView=null,t.dfdHeadView=null,t.arrCombatOptNote=null},t.prototype.cleanArray=function(t){if(!(null==t||t.length<=0))for(var e=t.length-1;e>=0;e--){var a=t[e];if(null!=a){var n=a.parent;n.removeChild(a)}t.splice(e,1)}},t.prototype.initCards=function(t,e){this.createCardViewByArr(t,e)},t.prototype.initFetters=function(t,e){if(!(null==e||e.length<=0)){var a=this,n=t==CombatConstants.PLACE_ATK?a.atkHeadView.getFightExpForm():a.dfdHeadView.getFightExpForm();if(null!=n)for(var r=0,o=e.length;o>r;r++){var i=e[r];null!=i&&""!=i&&n.playHeadFetterExpFrom(i,CombatConstants.SKILL_RES_ATTR,t,null,!1)}}},t.prototype.setHandCardTouchState=function(t){for(var e=this,a=0,n=e.arrAtkHandCardView.length;n>a;a++){var r=e.arrAtkHandCardView[a];null!=r&&r.setTouchState(t)}},t.prototype.setAtkHeadView=function(t){var e=this;null!=e.atkHeadView&&(e.atkHeadView.parent.removeChild(e.atkHeadView),e.atkHeadView=null),e.atkHeadView=t},t.prototype.getAtkHeadView=function(){return this.atkHeadView},t.prototype.setDfdHeadView=function(t){var e=this;null!=e.dfdHeadView&&(e.dfdHeadView.parent.removeChild(e.dfdHeadView),e.dfdHeadView=null),e.dfdHeadView=t},t.prototype.getDfdHeadView=function(){return this.dfdHeadView},t.prototype.synUpdateOutCards=function(t,e){if(null!=e){var a=e;if(null!=a){var n=this,r=t==CombatConstants.PLACE_ATK?n.arrAtkOutCardView:n.arrDfdOutCardView;if(r.length!=a.length){for(var o=new Array,i=0,l=a.length;l>i;i++){var C=a[i];if(null!=C){var s=C.code;if(null!=s){var u=C.cardData;null!=u&&o.push(u)}}}n.cleanArray(r);var c=t==CombatConstants.PLACE_ATK?CombatConstants.CARD_GROUP_ATK_OUT:CombatConstants.CARD_GROUP_DFD_OUT;n.initCards(c,o)}else for(var i=0,l=a.length;l>i;i++){var C=a[i];if(null!=C){var s=C.code;if(null!=s){var u=C.cardData,d=r[i],p=d.getCardData();if(null!=p){var m=p.code;if(m!=s){var _=d.parent,g=t==CombatConstants.PLACE_ATK?CombatConstants.CARD_GROUP_ATK_OUT:CombatConstants.CARD_GROUP_DFD_OUT,f=CombatUtils.changeCardGroupName(g,u),T=CombatConfig.getInstance().getOutCardConfigByPlace(t);_.removeChild(d);var b=new CRCardItemView;b.initData({cdata:f,cscaleX:T.scaleX,cscaleY:T.scaleY}),_.addChild(b),r[i]=b}else d.forceUpdateAtk(u.atk),d.forceUpdateHp(u.curHp)}}}}n.sortOutCard(t)}}},t.prototype.createCardViewByArr=function(t,e){if(!(null==e||e.length<=0)){var a=this,n=a.contextData,r=n.view;if(null!=r){var o,i,l,C,s=(t+1)%2!=0?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD;switch(t){case CombatConstants.CARD_GROUP_ATK_HAND:i=r.groupAtkSCard,o=CSCardItemView,l=a.arrAtkHandCardView,C=CombatConfig.getInstance().getSendCardConfigByPlace(s);break;case CombatConstants.CARD_GROUP_DFD_HAND:i=r.groupDfdSCard,o=CSCardItemView,l=a.arrDfdHandCardView,C=CombatConfig.getInstance().getSendCardConfigByPlace(s);break;case CombatConstants.CARD_GROUP_ATK_OUT:i=r.groupAtkRCard,o=CRCardItemView,l=a.arrAtkOutCardView,C=CombatConfig.getInstance().getOutCardConfigByPlace(s);break;case CombatConstants.CARD_GROUP_DFD_OUT:i=r.groupDfdRCard,o=CRCardItemView,l=a.arrDfdOutCardView,C=CombatConfig.getInstance().getOutCardConfigByPlace(s);break;case CombatConstants.CARD_GROUP_ATK_DEATH:i=r.groupAtkDList,o=CSCardItemView,l=a.arrAtkDeathCardView,C=CombatConfig.getInstance().getDeathCardConfigByPlace(s);break;case CombatConstants.CARD_GROUP_DFD_DEATH:i=r.groupDfdDList,o=CSCardItemView,l=a.arrDfdDeathCardView,C=CombatConfig.getInstance().getDeathCardConfigByPlace(s)}for(var u=0,c=e.length;c>u;u++){var d=e[u];if(null!=d){var p=CombatUtils.create(o),m=d;if(null!=m){var _=Object.keys(m);_.length>0&&(m=CombatUtils.changeCardGroupName(t,m))}if(p.initData({cdata:m,cscaleX:C.scaleX,cscaleY:C.scaleY}),i.addChild(p),l.push(p),t==CombatConstants.CARD_GROUP_ATK_DEATH||t==CombatConstants.CARD_GROUP_DFD_DEATH){var g=p;g.changeCardViewColor(!0)}}}t==CombatConstants.CARD_GROUP_ATK_HAND||t==CombatConstants.CARD_GROUP_DFD_HAND?a.sortHandCard(s):t==CombatConstants.CARD_GROUP_ATK_OUT||t==CombatConstants.CARD_GROUP_DFD_OUT?a.sortOutCard(s):(t==CombatConstants.CARD_GROUP_ATK_HAND||t==CombatConstants.CARD_GROUP_DFD_HAND)&&a.sortDeathCard(s)}}},t.prototype.sortHandCard=function(t){void 0===t&&(t=-1);var e,a=this;(-1==t||t==CombatConstants.PLACE_ATK)&&(e=CombatConfig.getInstance().getSendCardConfigByPlace(CombatConstants.PLACE_ATK),CombatUtils.sortCardPos(a.arrAtkHandCardView,e.space,new egret.Point(e.gapX,e.gapY))),(-1==t||t==CombatConstants.PLACE_DFD)&&(e=CombatConfig.getInstance().getSendCardConfigByPlace(CombatConstants.PLACE_DFD),CombatUtils.sortCardPos(a.arrDfdHandCardView,e.space,new egret.Point(e.gapX,e.gapY)))},t.prototype.sortOutCard=function(t){void 0===t&&(t=-1);var e,a=this;(-1==t||t==CombatConstants.PLACE_ATK)&&(e=CombatConfig.getInstance().getOutCardConfigByPlace(CombatConstants.PLACE_ATK),CombatUtils.sortCardPos(a.arrAtkOutCardView,e.space,new egret.Point(e.gapX,e.gapY))),(-1==t||t==CombatConstants.PLACE_DFD)&&(e=CombatConfig.getInstance().getOutCardConfigByPlace(CombatConstants.PLACE_DFD),CombatUtils.sortCardPos(a.arrDfdOutCardView,e.space,new egret.Point(e.gapX,e.gapY)))},t.prototype.sortDeathCard=function(t){void 0===t&&(t=-1);var e,a=this;(-1==t||t==CombatConstants.PLACE_ATK)&&(e=CombatConfig.getInstance().getDeathCardConfigByPlace(CombatConstants.PLACE_ATK),CombatUtils.sortCardPos(a.arrAtkDeathCardView,e.space,new egret.Point(e.gapX,e.gapY))),(-1==t||t==CombatConstants.PLACE_DFD)&&(e=CombatConfig.getInstance().getDeathCardConfigByPlace(CombatConstants.PLACE_DFD),CombatUtils.sortCardPos(a.arrDfdDeathCardView,e.space,new egret.Point(e.gapX,e.gapY)))},t.prototype.addCombatOptNote=function(t,e){var a=this,n=!1,r=a.getCombatOptNote(t);return null==r?(r=new CombatOptNote,r.code=t,r.arrCombatNode=new Array,r.curCombatNode=e,a.arrCombatOptNote.push(r),n=!1):(n=r.curCombatNode!=e,r.curCombatNode.optType==e.optType?n=!1:r.arrCombatNode.push(e)),n},t.prototype.removeCombatOptNote=function(t,e){var a=this,n=a.getCombatOptNote(t);if(null!=n)if(n.curCombatNode==e)if(n.arrCombatNode.length<=0)for(var r=0,o=a.arrCombatOptNote.length;o>r;r++){var i=a.arrCombatOptNote[r];if(null!=i&&i.code==t){a.arrCombatOptNote.splice(r,1);break}}else{var l=n.arrCombatNode.shift();n.curCombatNode=l,a.parse(l);for(var C=new Array,s=l.optType,r=0,o=n.arrCombatNode.length;o>r;r++){var u=n.arrCombatNode[r];if(null==u||u.optType!=s)break;C.push(r),a.parse(u)}for(var r=C.length-1;r>=0;r--)n.arrCombatNode.splice(C[r],1)}else for(var r=0,o=n.arrCombatNode.length;o>r;r++){var c=n.arrCombatNode[r];if(null!=c&&c.optType==e.optType){n.arrCombatNode.splice(r,1);break}}},t.prototype.getCombatOptNote=function(t){for(var e=this,a=null,n=0,r=e.arrCombatOptNote.length;r>n;n++){var o=e.arrCombatOptNote[n];if(null!=o&&o.code==t){a=o;break}}return a},t.prototype.parse=function(t){if(null!=t){var e=this,a=t.optType;switch(a){case CombatConstants.OPT_TYPE_NO_ACTION:break;case CombatConstants.OPT_TYPE_SEND_CARD:e.onSendCard(t);break;case CombatConstants.OPT_TYPE_REDUCE_ROUND:e.onReduceRound(t);break;case CombatConstants.OPT_TYPE_OUT_CARD:e.onOutCard(t);break;case CombatConstants.OPT_TYPE_ATK_NOR:e.onCardGeneralAttack(t);break;case CombatConstants.OPT_TYPE_ATK_SKILL:e.onCardSkillAttack(t);break;case CombatConstants.OPT_TYPE_DEATH:e.onCardDeath(t);break;case CombatConstants.OPT_TYPE_REVIVE:e.onCardRevive(t);break;case CombatConstants.OPT_TYPE_PERSUADE_BACK:e.onCardPersuadeBack(t);break;case CombatConstants.OPT_TYPE_ROUND_RECOVER:e.onRoundRecover(t);break;case CombatConstants.OPT_TYPE_ROUND_LOST:e.onRoundLost(t);break;case CombatConstants.OPT_TYPE_MODIFY_ATTRIBUTE:e.onModifyAttribute(t);break;case CombatConstants.OPT_TYPE_OUT_CARD_BACK:e.onOutCardBack(t);break;case CombatConstants.OPT_TYPE_SORT_HAND_CARD:e.onSortHandCard(t);break;case CombatConstants.OPT_TYPE_SORT_OUT_CARD:e.onSortOutCard(t);break;case CombatConstants.OPT_TYPE_SORT_DEATH_CARD:e.onSortDeathCard(t);break;case CombatConstants.OPT_TYPE_SEL_CARD:e.onSelCard(t);break;case CombatConstants.OPT_TYPE_FORCE_DESEL_CARD:e.onForceDeselCard(t);break;case CombatConstants.OPT_TYPE_SET_NON_CLICKABLE:e.onSetNonClickable(t);break;case CombatConstants.OPT_TYPE_ATK_SKILL_CONT:e.onCardSkillContinue(t);break;case CombatConstants.OPT_TYPE_ATK_SKILL_DECONT:e.onCardSkillDeContinue(t);break;case CombatConstants.OPT_TYPE_BUFF_ADD:e.onAddBuff(t);break;case CombatConstants.OPT_TYPE_BUFF_REMOVE:e.onRemoveBuff(t);break;case CombatConstants.OPT_TYPE_BUFF_UPDATE:e.onUpdateBuff(t);break;case CombatConstants.OPT_TYPE_FETTER_ADD:e.onAddFetter(t);break;case CombatConstants.OPT_TYPE_FETTER_REMOVE:e.onRemoveFetter(t)}}},t.prototype.onSendCard=function(t){var e=this,a=e.contextData.view;if(null!=a){var n=t.optCardData;if(null==n)return void(t.callBack&&t.callBack.run());var r=CombatConstants.PLACE_ATK==t.senderPlace;r&&(n=CombatUtils.changeCardGroupName(CombatConstants.CARD_GROUP_ATK_HAND,n));var o=r?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD,i=CombatConfig.getInstance().getSendCardConfigByPlace(o),l=new CSCardItemView;l.initData({cdata:n,cscaleX:i.scaleX,cscaleY:i.scaleY});var C=r?a.groupAtkSendCard:a.groupDfdSendCard;C.addChild(l);var s=r?e.arrAtkHandCardView:e.arrDfdHandCardView;s.push(l);var u=r?a.groupAtkSCard:a.groupDfdSCard,c=(s.length-1)*(l.width+i.space)+l.anchorOffsetX,d=0+l.anchorOffsetY,p=C.x-u.x-u.parent.x,m=C.y-u.y-u.parent.y;egret.Tween.removeTweens(l),egret.Tween.get(l).to({x:c+i.gapX-p,y:d+i.gapY-m},CombatUtils.getAMSpeed(i.act_attr.speed)).call(function(){u.addChild(l),t.callBack&&t.callBack.run()},e)}},t.prototype.onOutCard=function(t){var e=this,a=e.contextData.view;if(null==a)return void(t.callBack&&t.callBack.run());var n=t.optCardData;if(null==n)return void(t.callBack&&t.callBack.run());var r=n.code;if(!e.addCombatOptNote(r,t)){var o=CombatConstants.PLACE_ATK==t.senderPlace,i=o?e.arrAtkHandCardView:e.arrDfdHandCardView,l=0;o&&(l=CombatUtils.getCardIndexByCardCode(r,i));var C=i[l];if(null==C)return void(t.callBack&&t.callBack.run());var s=o?CombatConstants.CARD_GROUP_ATK_OUT:CombatConstants.CARD_GROUP_DFD_OUT;n=CombatUtils.changeCardGroupName(s,n);var u=o?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD,c=CombatConfig.getInstance().getOutCardConfigByPlace(u),d=new CRCardItemView;d.initData({cdata:n,cscaleX:c.scaleX,cscaleY:c.scaleY});var p=o?a.groupAtkSCard:a.groupDfdSCard;p.addChild(d),d.x=C.x,d.y=C.y;var m=o?e.arrAtkOutCardView:e.arrDfdOutCardView;m.push(d),t.removeCard&&(C.parent.removeChild(C),i.splice(l,1));var _=o?a.groupAtkRCard:a.groupDfdRCard,g=(m.length-1)*(d.width+c.space)+d.anchorOffsetX,f=0+d.anchorOffsetY,T=p.parent.x+p.x-_.x,b=p.parent.y+p.y-_.y;d.getFightExpForm().moveExpForm(g+c.gapX-T,f+c.gapY-b,CombatUtils.getAMSpeed(c.act_attr.speed),Handler.create(e,function(){var a=!o;if(!a){var i=CombatUtils.getCardIndexByCardCode(n.code,m);a=-1!=i}a&&(_.addChild(d),e.sortOutCard(u)),e.removeCombatOptNote(r,t),t.callBack&&t.callBack.run()}))}},t.prototype.onReduceRound=function(t){var e=this,a=e.contextData.view;if(null==a)return void(t.callBack&&t.callBack.run());for(var n=t.senderPlace,r=t.receiverPlace,o=0,i=e.arrAtkHandCardView.length;i>o;o++){var l=e.arrAtkHandCardView[o];null!=l&&l.reduceRound(n==r)}t.callBack&&t.callBack.run()},t.prototype.onCardDeath=function(t){var e=this,a=e.contextData.view;if(null==a)return void(t.callBack&&t.callBack.run());var n=CombatConstants.PLACE_ATK==t.senderPlace,r=t.fromTarget,o=n?e.arrAtkOutCardView:e.arrDfdOutCardView,i=CombatUtils.getCardIndexByCardCode(r,o);if(-1==i)return void(t.callBack&&t.callBack.run());var l=o[i];if(null==l)return void(t.callBack&&t.callBack.run());var C=l.getCardData(),s=n?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD,u=CombatConfig.getInstance().getDeathCardConfigByPlace(s),c=new CSCardItemView;c.initData({cdata:C,cscaleX:u.scaleX,cscaleY:u.scaleY});var d=n?a.groupAtkRCard:a.groupDfdRCard;d.addChild(c),c.changeCardViewColor(!0),c.x=l.x,c.y=l.y;var p=n?e.arrAtkDeathCardView:e.arrDfdDeathCardView;p.push(c),t.removeCard&&(l.parent.removeChild(l),o.splice(i,1));var m=CombatConfig.getInstance().getOutCardConfigByPlace(s),_=n?a.groupAtkDCard:a.groupDfdDCard,g=_.width/2,f=_.height/2,T=d.x-_.x,b=d.y-_.y;egret.Tween.removeTweens(c),egret.Tween.get(c).to({x:g+u.gapX-T,y:f+u.gapY-b},CombatUtils.getAMSpeed(m.act_attr.speed)).call(function(){var e=n?a.groupAtkDList:a.groupDfdDList;e.addChild(c),t.callBack&&t.callBack.run()},e)},t.prototype.onCardRevive=function(t){var e=this,a=e.contextData.view;if(null==a)return void(t.callBack&&t.callBack.run());var n=t.fromTarget;if(!e.addCombatOptNote(n,t)){var r=!0,o=CombatUtils.getCardViewByCardCode(n,e.arrAtkOutCardView);if(null==o&&(o=CombatUtils.getCardViewByCardCode(n,e.arrDfdOutCardView),r=!1),null==o)return void(t.callBack&&t.callBack.run());var i=t.fightNodeArr,l=i.length+1,C=function(){l--,0==l&&(e.removeCombatOptNote(n,t),t.callBack&&t.callBack.run())}.bind(e),s=Handler.create(e,C,null,!1);o.getFightExpForm().playRCSkillExpFromByType(t.skillKey,CombatConstants.SKILL_RES_ATTR,r?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD,null,s);for(var u=r?e.arrAtkDeathCardView:e.arrDfdDeathCardView,c=0,d=i.length;d>c;c++){var p=i[c];if(null!=p){var m=p.toTarget,_=CombatUtils.getCardIndexByCardCode(m,u),g=u[_];if(null!=g){var f=p.toTargetObj,T=r?CombatConstants.CARD_GROUP_ATK_HAND:CombatConstants.CARD_GROUP_DFD_HAND;f=r?CombatUtils.changeCardGroupName(T,f):{visible:!1};var b=r?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD,h=CombatConfig.getInstance().getSendCardConfigByPlace(b),v=new CSCardItemView;v.initData({cdata:f,cscaleX:h.scaleX,cscaleY:h.scaleY});var E=r?a.groupAtkDCard:a.groupDfdDCard;E.addChild(v),v.x=E.width/2,v.y=E.height/2,t.removeCard&&(g.parent.removeChild(g),u.splice(_,1));var A=r?a.groupAtkSendCard:a.groupDfdSendCard,D=0,y=0,S=E.x-A.x,R=E.y-A.y,O=!1,P=p.type;if(P==CombatConstants.FIGHT_TYPE_HAND_CARD){var w=r?e.arrAtkHandCardView:e.arrDfdHandCardView;A=r?a.groupAtkSCard:a.groupDfdSCard,D=w.length*(v.width+h.space)+v.anchorOffsetX,y=0+v.anchorOffsetY,S=E.x-A.x-A.parent.x,R=E.y-A.y-A.parent.y,O=!0}egret.Tween.removeTweens(v),egret.Tween.get(v).to({x:D+h.gapX-S,y:y+h.gapY-R},CombatUtils.getAMSpeed(h.act_attr.speed)).call(function(t,a,n,r,o){t?(a.addChild(r),n.push(r),e.sortHandCard()):r.parent.removeChild(r),o.run()}.bind(e,O,A,w,v,s),e)}}}}},t.prototype.onCardPersuadeBack=function(t){var e=this,a=e.contextData.view;if(null==a)return void(t.callBack&&t.callBack.run());var n=t.fromTarget;if(!e.addCombatOptNote(n,t)){var r=!0,o=CombatUtils.getCardViewByCardCode(n,e.arrAtkOutCardView);if(null==o&&(o=CombatUtils.getCardViewByCardCode(n,e.arrDfdOutCardView),r=!1),null==o)return void(t.callBack&&t.callBack.run());var i=t.fightNodeArr,l=i.length;null!=t.skillKey&&""!=t.skillKey&&l++;var C=function(){l--,0==l&&(e.removeCombatOptNote(n,t),t.callBack&&t.callBack.run())}.bind(e),s=Handler.create(e,C,null,!1);null!=t.skillKey&&""!=t.skillKey&&o.getFightExpForm().playRCSkillExpFromByType(t.skillKey,CombatConstants.SKILL_RES_ATTR,r?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD,null,s);for(var u=0,c=i.length;c>u;u++){var d=i[u];if(null!=d){var p=d.toTarget,m=CombatConstants.PLACE_DFD,_=CombatUtils.getCardViewByCardCode(p,e.arrDfdOutCardView);if(null==_&&(_=CombatUtils.getCardViewByCardCode(p,e.arrAtkOutCardView),m=CombatConstants.PLACE_ATK),null!=_){var g=null==d.recipient||d.recipient?CombatConstants.SKILL_REC_ATTR:CombatConstants.SKILL_RES_ATTR,f=Handler.create(e,function(n,r,o,i){var l=o==CombatConstants.PLACE_ATK,C=r.toTargetObj,u=l?CombatConstants.CARD_GROUP_ATK_HAND:CombatConstants.CARD_GROUP_DFD_HAND;C=l?CombatUtils.changeCardGroupName(u,C):{visible:!1};var c=CombatConfig.getInstance().getSendCardConfigByPlace(m),d=new CSCardItemView;d.initData({cdata:C,cscaleX:c.scaleX,cscaleY:c.scaleY});var p=l?a.groupAtkRCard:a.groupDfdRCard;if(p.addChild(d),d.x=n.x,d.y=n.y,t.removeCard){n.parent.removeChild(n);var _=l?e.arrAtkOutCardView:e.arrDfdOutCardView,g=CombatUtils.getCardIndexByCardCode(i,_);_.splice(g,1)}var f=l?a.groupAtkSendCard:a.groupDfdSendCard,T=0,b=0,h=p.x-f.x,v=p.y-f.y,E=!1,A=r.type;if(A==CombatConstants.FIGHT_TYPE_HAND_CARD){var D=l?e.arrAtkHandCardView:e.arrDfdHandCardView;f=l?a.groupAtkSCard:a.groupDfdSCard,T=D.length*(d.width+c.space)+d.anchorOffsetX,b=0+d.anchorOffsetY,h=p.x-f.x-f.parent.x,v=p.y-f.y-f.parent.y,E=!0}egret.Tween.removeTweens(d),egret.Tween.get(d).to({x:T+c.gapX-h,y:b+c.gapY-v},CombatUtils.getAMSpeed(c.act_attr.speed)).call(function(t,a,n,r,o){t?(a.addChild(r),n.push(r),e.sortHandCard()):r.parent.removeChild(r),o.run()}.bind(e,E,f,D,d,s),e)},[_,d,m,p]),T=Handler.create(e,function(t,e){e.run()},[_,f]);null!=t.skillKey&&""!=t.skillKey?_.getFightExpForm().playRCSkillExpFromByType(t.skillKey,g,m,d,T):T.run()}else C()}else C()}}},t.prototype.onOutCardBack=function(t){var e=this,a=e.contextData.view;if(null==a)return void(t.callBack&&t.callBack.run());var n=t.fromTarget;if(!e.addCombatOptNote(n,t)){var r=e.arrAtkHandCardView,o=CombatUtils.getCardViewByCardCode(n,r);if(null!=o){var i=o.getCardData(),l=i.code,C=CombatUtils.getCardIndexByCardCode(l,e.arrAtkOutCardView),s=e.arrAtkOutCardView,u=s[C];if(null!=u){var c=s[C].getCardData(),d=CombatConstants.PLACE_ATK,p=CombatConfig.getInstance().getSendCardConfigByPlace(d),m=new CSCardItemView;m.initData({cdata:c,cscaleX:p.scaleX,cscaleY:p.scaleY});var _=a.groupAtkRCard;_.addChild(m),m.x=u.x,m.y=u.y,t.removeCard&&(u.parent.removeChild(u),s.splice(C,1));var g=e.arrAtkHandCardView,f=CombatUtils.getCardViewByCardCode(l,g);if(null!=f){var T=CombatConfig.getInstance().getOutCardConfigByPlace(d),b=a.groupAtkSCard,h=f.x,v=f.y,E=_.x-b.x-b.parent.x,A=_.y-b.y-b.parent.y;egret.Tween.removeTweens(m),egret.Tween.get(m).to({x:h+p.gapX-E,y:v+p.gapY-A},CombatUtils.getAMSpeed(T.act_attr.speed)).call(function(){m.parent.removeChild(m),e.removeCombatOptNote(n,t),t.callBack&&t.callBack.run()},e)}}}}},t.prototype.onSortHandCard=function(t){var e=this,a=t.senderPlace;e.sortHandCard(a)},t.prototype.onSortOutCard=function(t){var e=this,a=t.senderPlace;e.sortOutCard(a)},t.prototype.onSortDeathCard=function(t){var e=this,a=t.senderPlace;e.sortDeathCard(a)},t.prototype.onSelCard=function(t){var e=this,a=t.fromTarget,n=e.arrAtkHandCardView,r=CombatUtils.getCardViewByCardCode(a,n);if(null!=r){var o=r.getCardState();switch(o){case CombatConstants.CARD_STATE_NOR:case CombatConstants.CARD_STATE_NON_CLICKABLE:t.callBack&&t.callBack.run();break;case CombatConstants.CARD_STATE_CLICKABLE:var i=new CombatNode;i.optType=CombatConstants.OPT_TYPE_OUT_CARD,i.senderPlace=t.senderPlace,i.fromTarget=a,i.optCardData=r.getCardData(),i.removeCard=!1,i.callBack=Handler.create(e,function(){r.getCardState()!=CombatConstants.CARD_STATE_NON_CLICKABLE&&r.setCardState(CombatConstants.CARD_STATE_CLICKED),t.callBack&&t.callBack.run()}.bind(e)),e.parse(i),r.setCardState(CombatConstants.CARD_STATE_CLICKED),r.changeCardViewColor(!0);break;case CombatConstants.CARD_STATE_CLICKED:var i=new CombatNode;i.optType=CombatConstants.OPT_TYPE_OUT_CARD_BACK,i.senderPlace=t.senderPlace,i.fromTarget=a,i.removeCard=!0,i.callBack=Handler.create(e,function(){r.getCardState()!=CombatConstants.CARD_STATE_NON_CLICKABLE&&r.setCardState(CombatConstants.CARD_STATE_CLICKABLE),t.callBack&&t.callBack.run()}.bind(e)),e.parse(i),r.setCardState(CombatConstants.CARD_STATE_CLICKABLE),r.changeCardViewColor(!1)}}},t.prototype.onForceDeselCard=function(t){for(var e=this,a=e.arrAtkOutCardView,n=0,r=e.arrAtkHandCardView.length;r>n;n++){var o=e.arrAtkHandCardView[n];if(null!=o){o.getCardState()!=CombatConstants.CARD_STATE_NON_CLICKABLE&&o.setCardState(CombatConstants.CARD_STATE_CLICKABLE),o.changeCardViewColor(!1);var i=o.getCardData(),l=i.code,C=CombatUtils.getCardIndexByCardCode(l,a);if(-1!=C){var s=a[C];s.parent.removeChild(s),a.splice(C,1)}}}t.callBack&&t.callBack.run()},t.prototype.onSetNonClickable=function(t){var e=this;e.setHandCardTouchState(!1)},t.prototype.onCardGeneralAttack=function(t){var e=this,a=t.fromTarget;if(!e.addCombatOptNote(a,t)){var n=!0,r=CombatUtils.getCardViewByCardCode(a,e.arrAtkOutCardView);if(null==r&&(r=CombatUtils.getCardViewByCardCode(a,e.arrDfdOutCardView),n=!1),null==r)return void(t.callBack&&t.callBack.run());var o=t.fightNodeArr,i=o.length+1,l=function(){i--,0==i&&(e.removeCombatOptNote(a,t),t.callBack&&t.callBack.run())}.bind(e),C=Handler.create(e,l,null,!1);r.getFightExpForm().playRCCommonExpFromByType(CombatConstants.EXP_FORM_ATK,n?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD,null,C);for(var s=0,u=o.length;u>s;s++){var c=o[s];if(null!=c){var d=c.damage,p=CombatConstants.EXP_FORM_HIT;if(c.hited?d>0&&(p=CombatConstants.EXP_FORM_RECOVER):p=CombatConstants.EXP_FORM_EVASIVE,c.type==CombatConstants.FIGHT_TYPE_USER){var m=c.toTarget,_=Handler.create(e,function(t,a){C.run(),e.atkHeadView.getTicket()==a?e.atkHeadView.setDamage(t):e.dfdHeadView.setDamage(t)},[d,m]);e.atkHeadView.getTicket()==m?e.atkHeadView.getFightExpForm().playHeadCommonExpFromByType(p,CombatConstants.PLACE_ATK,c,_):e.dfdHeadView.getFightExpForm().playHeadCommonExpFromByType(p,CombatConstants.PLACE_DFD,c,_)}else{var g=c.toTarget,f=CombatConstants.PLACE_DFD,T=CombatUtils.getCardViewByCardCode(g,e.arrDfdOutCardView);if(null==T&&(T=CombatUtils.getCardViewByCardCode(g,e.arrAtkOutCardView),f=CombatConstants.PLACE_ATK),null==T){l();continue}var b=Handler.create(e,function(t,a,n,r,o){if(C.run(),o.setDamage(t),r){var i=new CombatNode;i.optType=CombatConstants.OPT_TYPE_DEATH,i.senderPlace=n,i.fromTarget=a,i.removeCard=!0,e.parse(i)}},[d,g,f,c.died,T]);T.getFightExpForm().playRCCommonExpFromByType(p,f,c,b)}}else l()}}},t.prototype.onCardSkillAttack=function(t){var e=this,a=t.fromTarget;if(!e.addCombatOptNote(a,t)){var n=!0,r=CombatUtils.getCardViewByCardCode(a,e.arrAtkOutCardView);if(null==r&&(r=CombatUtils.getCardViewByCardCode(a,e.arrDfdOutCardView),n=!1),null==r)return void(t.callBack&&t.callBack.run());var o=t.fightNodeArr,i=o.length+1,l=function(){i--,0==i&&(e.removeCombatOptNote(a,t),t.callBack&&t.callBack.run())}.bind(e),C=Handler.create(e,l,null,!1);r.getFightExpForm().playRCSkillExpFromByType(t.skillKey,CombatConstants.SKILL_RES_ATTR,n?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD,null,C);for(var s=0,u=o.length;u>s;s++){var c=o[s];if(null!=c){var d=null==c.recipient||c.recipient?CombatConstants.SKILL_REC_ATTR:CombatConstants.SKILL_RES_ATTR,p=c.damage;if(c.type==CombatConstants.FIGHT_TYPE_USER){var m=c.toTarget,_=Handler.create(e,function(t,a){C.run(),e.atkHeadView.getTicket()==a?e.atkHeadView.setDamage(t):e.dfdHeadView.setDamage(t)},[p,m]);e.atkHeadView.getTicket()==m?e.atkHeadView.getFightExpForm().playHeadSkillExpFromByType(t.skillKey,d,CombatConstants.PLACE_ATK,c,_):e.dfdHeadView.getFightExpForm().playHeadSkillExpFromByType(t.skillKey,d,CombatConstants.PLACE_DFD,c,_)}else{var g=c.toTarget,f=CombatConstants.PLACE_DFD,T=CombatUtils.getCardViewByCardCode(g,e.arrDfdOutCardView);if(null==T&&(T=CombatUtils.getCardViewByCardCode(g,e.arrAtkOutCardView),f=CombatConstants.PLACE_ATK),null==T){l();continue}var b=Handler.create(e,function(t,a,n,r,o){if(C.run(),o.setDamage(t),r){var i=new CombatNode;i.optType=CombatConstants.OPT_TYPE_DEATH,i.senderPlace=n,i.fromTarget=a,i.removeCard=!0,e.parse(i)}},[p,g,f,c.died,T]);T.getFightExpForm().playRCSkillExpFromByType(t.skillKey,d,f,c,b)}}}}},t.prototype.onRoundRecover=function(t){var e=this,a=t.fightNodeArr;if(a.length<=0)return void(t.callBack&&t.callBack.run());for(var n=a.length,r=function(){n--,0==n&&t.callBack&&t.callBack.run()}.bind(e),o=Handler.create(e,r,null,!1),i=0,l=a.length;l>i;i++){var C=a[i];if(null!=C){var s=C.damage,u=CombatConstants.EXP_FORM_RECOVER;if(C.type==CombatConstants.FIGHT_TYPE_USER){var c=C.toTarget,d=Handler.create(e,function(t,a){o.run(),e.atkHeadView.getTicket()==a?e.atkHeadView.setDamage(t):e.dfdHeadView.setDamage(t)},[s,c]);e.atkHeadView.getTicket()==c?e.atkHeadView.getFightExpForm().playHeadCommonExpFromByType(u,CombatConstants.PLACE_ATK,C,d):e.dfdHeadView.getFightExpForm().playHeadCommonExpFromByType(u,CombatConstants.PLACE_DFD,C,d)}else{var p=C.toTarget,m=CombatConstants.PLACE_DFD,_=CombatUtils.getCardViewByCardCode(p,e.arrDfdOutCardView);
if(null==_&&(_=CombatUtils.getCardViewByCardCode(p,e.arrAtkOutCardView),m=CombatConstants.PLACE_ATK),null==_){r();continue}var g=Handler.create(e,function(t,e,a){o.run(),a.setDamage(t)},[s,p,_]);_.getFightExpForm().playRCCommonExpFromByType(u,m,C,g)}}}},t.prototype.onRoundLost=function(t){var e=this,a=t.fightNodeArr;if(a.length<=0)return void(t.callBack&&t.callBack.run());for(var n=a.length,r=function(){n--,0==n&&t.callBack&&t.callBack.run()}.bind(e),o=Handler.create(e,r,null,!1),i=0,l=a.length;l>i;i++){var C=a[i];if(null!=C){var s=C.damage,u=CombatConstants.EXP_FORM_LOST;if(C.type==CombatConstants.FIGHT_TYPE_USER){var c=C.toTarget,d=Handler.create(e,function(t,a){o.run(),e.atkHeadView.getTicket()==a?e.atkHeadView.setDamage(t):e.dfdHeadView.setDamage(t)},[s,c]);e.atkHeadView.getTicket()==c?e.atkHeadView.getFightExpForm().playHeadCommonExpFromByType(u,CombatConstants.PLACE_ATK,C,d):e.dfdHeadView.getFightExpForm().playHeadCommonExpFromByType(u,CombatConstants.PLACE_DFD,C,d)}else{var p=C.toTarget,m=CombatConstants.PLACE_DFD,_=CombatUtils.getCardViewByCardCode(p,e.arrDfdOutCardView);if(null==_&&(_=CombatUtils.getCardViewByCardCode(p,e.arrAtkOutCardView),m=CombatConstants.PLACE_ATK),null==_){r();continue}var g=Handler.create(e,function(t,a,n,r,i){if(o.run(),i.setDamage(t),r){var l=new CombatNode;l.optType=CombatConstants.OPT_TYPE_DEATH,l.senderPlace=n,l.fromTarget=a,l.removeCard=!0,e.parse(l)}},[s,p,m,C.died,_]);_.getFightExpForm().playRCCommonExpFromByType(u,m,C,g)}}}},t.prototype.onModifyAttribute=function(t){var e=this,a=t.fightNodeArr;if(a.length<=0)return void(t.callBack&&t.callBack.run());var n=t.fromTarget;if(!e.addCombatOptNote(n,t)){var r=!0,o=CombatUtils.getCardViewByCardCode(n,e.arrAtkOutCardView);null==o&&(o=CombatUtils.getCardViewByCardCode(n,e.arrDfdOutCardView),r=!1);var i=t.skillKey,l=a.length;null!=i&&""!=i&&l++;var C=function(){l--,0==l&&(e.removeCombatOptNote(n,t),t.callBack&&t.callBack.run())}.bind(e),s=Handler.create(e,C,null,!1);null!=i&&""!=i&&o.getFightExpForm().playRCModifyAttributeExpFrom(i,CombatConstants.SKILL_RES_ATTR,r?CombatConstants.PLACE_ATK:CombatConstants.PLACE_DFD,null,s);for(var u=0,c=a.length;c>u;u++){var d=a[u];if(null!=d){var p=d.toTarget,m=CombatConstants.PLACE_DFD,_=CombatUtils.getCardViewByCardCode(p,e.arrDfdOutCardView);if(null==_&&(_=CombatUtils.getCardViewByCardCode(p,e.arrAtkOutCardView),m=CombatConstants.PLACE_ATK),null!=_){var g=d.toTargetObj;if(null!=g){var f=d.damage,T=null==d.recipient||d.recipient?CombatConstants.SKILL_REC_ATTR:CombatConstants.SKILL_RES_ATTR,b=Handler.create(e,function(t,a,n,r,o,i){if(s.run(),null!=i){var l=i[CombatConstants.MODIFY_ATTRIBUTE_LIMIT_HP];null!=l&&o.modifyLimitHp(l);var C=i[CombatConstants.MODIFY_ATTRIBUTE_ATK];null!=C&&o.modifyAtk(C)}if(null!=t&&o.setDamage(t),r){var u=new CombatNode;u.optType=CombatConstants.OPT_TYPE_DEATH,u.senderPlace=n,u.fromTarget=a,u.removeCard=!0,e.parse(u)}},[f,p,m,d.died,_,g]);_.getFightExpForm().playRCModifyAttributeExpFrom(i,T,m,d,b)}}}}}},t.prototype.onCardSkillContinue=function(t){var e=this,a=t.fightNodeArr;if(a.length<=0)return void(t.callBack&&t.callBack.run());for(var n=a.length,r=function(){n--,0==n&&t.callBack&&t.callBack.run()}.bind(e),o=Handler.create(e,r,null,!1),i=0,l=a.length;l>i;i++){var C=a[i];if(null!=C){var s=C.toTarget,u=CombatConstants.PLACE_DFD,c=CombatUtils.getCardViewByCardCode(s,e.arrDfdOutCardView);null==c&&(c=CombatUtils.getCardViewByCardCode(s,e.arrAtkOutCardView),u=CombatConstants.PLACE_ATK),null!=c?c.getFightExpForm().addRCContinueSkill(t.skillKey,CombatConstants.SKILL_REC_ATTR,u,o):r()}}},t.prototype.onCardSkillDeContinue=function(t){var e=this,a=t.fightNodeArr;if(a.length<=0)return void(t.callBack&&t.callBack.run());for(var n=0,r=a.length;r>n;n++){var o=a[n];if(null!=o){var i=o.toTarget,l=CombatUtils.getCardViewByCardCode(i,e.arrDfdOutCardView);null==l&&(l=CombatUtils.getCardViewByCardCode(i,e.arrAtkOutCardView)),null!=l&&l.getFightExpForm().removeContinueSkill(t.skillKey)}}},t.prototype.onAddBuff=function(t){var e=this,a=t.fightNodeArr;if(a.length<=0)return void(t.callBack&&t.callBack.run());for(var n=a.length,r=function(){n--,0==n&&t.callBack&&t.callBack.run()}.bind(e),o=Handler.create(e,r,null,!1),i=0,l=a.length;l>i;i++){var C=a[i];if(null!=C){var s=C.toTarget;if(C.type==CombatConstants.FIGHT_TYPE_OUT_CARD){var u=CombatUtils.getCardViewByCardCode(s,e.arrDfdOutCardView);if(null==u&&(u=CombatUtils.getCardViewByCardCode(s,e.arrAtkOutCardView)),null==u)continue;var c=Handler.create(e,function(){o.run()});u.getFightExpForm().addRCBuff(t.skillKey,C,c)}}}},t.prototype.onRemoveBuff=function(t){var e=this,a=t.fightNodeArr;if(a.length<=0)return void(t.callBack&&t.callBack.run());for(var n=a.length,r=function(){n--,0==n&&t.callBack&&t.callBack.run()}.bind(e),o=Handler.create(e,r,null,!1),i=0,l=a.length;l>i;i++){var C=a[i];if(null!=C){var s=C.toTarget;if(C.type==CombatConstants.FIGHT_TYPE_OUT_CARD){var u=CombatConstants.PLACE_DFD,c=CombatUtils.getCardViewByCardCode(s,e.arrDfdOutCardView);if(null==c&&(c=CombatUtils.getCardViewByCardCode(s,e.arrAtkOutCardView),u=CombatConstants.PLACE_ATK),null==c)continue;var d=Handler.create(e,function(t,a,n){if(o.run(),n){var r=new CombatNode;r.optType=CombatConstants.OPT_TYPE_DEATH,r.senderPlace=a,r.fromTarget=t,r.removeCard=!0,e.parse(r)}},[s,u,C.died]);c.getFightExpForm().removeRCBuff(t.skillKey,d)}}}},t.prototype.onUpdateBuff=function(t){var e=this,a=t.fightNodeArr;if(a.length<=0)return void(t.callBack&&t.callBack.run());for(var n=a.length,r=function(){n--,0==n&&t.callBack&&t.callBack.run()}.bind(e),o=Handler.create(e,r,null,!1),i=0,l=a.length;l>i;i++){var C=a[i];if(null!=C){var s=C.toTarget;if(C.type==CombatConstants.FIGHT_TYPE_OUT_CARD){var u=CombatConstants.PLACE_DFD,c=CombatUtils.getCardViewByCardCode(s,e.arrDfdOutCardView);if(null==c&&(c=CombatUtils.getCardViewByCardCode(s,e.arrAtkOutCardView),u=CombatConstants.PLACE_ATK),null==c)continue;var d=Handler.create(e,function(t,e,a){o.run()},[s,u,C.died]);c.getFightExpForm().updateRCBuff(t.skillKey,C,d)}}}},t.prototype.onAddFetter=function(t){var e=this,a=t.fromTarget,n=a==e.atkHeadView.getTicket(),r=t.fightNodeArr,o=r.length,i=function(){o--,0==o&&t.callBack&&t.callBack.run()}.bind(e),l=t.skillKey,C=Handler.create(e,i,null,!1),s=Handler.create(e,function(){C.run()});n?e.atkHeadView.getFightExpForm().playHeadFetterExpFrom(l,CombatConstants.SKILL_RES_ATTR,CombatConstants.PLACE_ATK,s):e.dfdHeadView.getFightExpForm().playHeadFetterExpFrom(l,CombatConstants.SKILL_RES_ATTR,CombatConstants.PLACE_DFD,s);for(var u=0,c=r.length;c>u;u++){var d=r[u];if(null!=d){var p=d.toTarget,m=CombatConstants.PLACE_DFD,_=CombatUtils.getCardViewByCardCode(p,e.arrDfdOutCardView);if(null==_&&(_=CombatUtils.getCardViewByCardCode(p,e.arrAtkOutCardView),m=CombatConstants.PLACE_ATK),null!=_){var g=d.toTargetObj;if(null!=g){var f=d.damage,T=null==d.recipient||d.recipient?CombatConstants.SKILL_REC_ATTR:CombatConstants.SKILL_RES_ATTR,b=Handler.create(e,function(t,e,a){if(C.run(),null!=a){var n=a[CombatConstants.MODIFY_ATTRIBUTE_LIMIT_HP];null!=n&&e.modifyLimitHp(n);var r=a[CombatConstants.MODIFY_ATTRIBUTE_ATK];null!=r&&e.modifyAtk(r)}null!=t&&e.setDamage(t)},[f,_,g]);_.getFightExpForm().playRCFetterExpFrom(l,T,m,d,b)}}}}},t.prototype.onRemoveFetter=function(t){var e=t.fightNodeArr;return e.length<=0?void(t.callBack&&t.callBack.run()):void 0},t.prototype.getOptBtnAtkType=function(t){var e=this,a=0;if(t==CombatConstants.PLACE_ATK){for(var n=0,r=0,o=0,i=e.arrAtkHandCardView.length;i>o;o++){var l=e.arrAtkHandCardView[o];if(null!=l){var C=l.getCardState();if(C==CombatConstants.CARD_STATE_CLICKED){n++;break}C==CombatConstants.CARD_STATE_CLICKABLE&&r++}}0!=n?a=2:0!=r&&(a=1)}return a},t.prototype.getCurSelCardsCode=function(){for(var t=this,e=new Array,a=new Array,n=0,r=t.arrAtkHandCardView.length;r>n;n++){var o=t.arrAtkHandCardView[n];if(null!=o){var i=o.getCardState();if(i==CombatConstants.CARD_STATE_CLICKED){var l=o.getCardData();a.push(l.code)}}}if(a.length<2)return a;for(var n=0,r=t.arrAtkOutCardView.length;r>n;n++){var C=t.arrAtkOutCardView[n];if(null!=C)for(var l=C.getCardData(),s=l.code,u=0,c=a.length;c>u;u++){var d=a[u];if(null!=d&&d==s){e.push(d),a.splice(u,1);break}}}return e},t}();__reflect(CombatParser.prototype,"CombatParser");var CombatSerial=function(){function t(t,e){void 0===e&&(e=null),this.timeDelay=500,this.initData(t,e)}return t.prototype.initData=function(t,e){void 0===e&&(e=null);var a=this;a.combatParser=t,a.combatNodeList=new Array,a.timeCounter=0,a.callBack=e},t.prototype.parse=function(t){},t.prototype.addNode=function(t){var e=this;t.callBack=Handler.create(e,e.playNext),e.combatNodeList.push(t)},t.prototype.addNodeAndPlay=function(t){var e=this;t.callBack=Handler.create(e,e.playNext),e.combatNodeList.push(t),1==e.combatNodeList.length&&e.startPlay()},t.prototype.startPlay=function(){this.playNext()},t.prototype.playNext=function(){var t=this;if(t.combatNodeList.length<=0)return void(null!=t.callBack&&t.callBack.run());var e=t.combatNodeList.shift();null!=e&&(t.combatParser.parse(e),-1!=e.usageTime&&t.startTimer(e.usageTime,e.callBack))},t.prototype.stopTimer=function(){var t=this;null!=t.timer&&t.timer.stop()},t.prototype.startTimer=function(t,e){void 0===t&&(t=0),void 0===e&&(e=null);var a=this;if(a.stopTimer(),a.timeCounter=t,null!=e&&(a.timeCBack=e),null==a.timer){var n=new egret.Timer(a.timeDelay);n.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),a.timer=n}a.timer.start()},t.prototype.timerFunc=function(){var t=this;t.timeCounter-=t.timeDelay,t.timeCounter<=0&&(t.stopTimer(),null!=t.timeCBack&&t.timeCBack.run())},t.prototype.getCombatNodeListLength=function(){var t=this;return null==t.combatNodeList?0:this.combatNodeList.length},t}();__reflect(CombatSerial.prototype,"CombatSerial");var CombatNode=function(){function t(){this.optType=CombatConstants.OPT_TYPE_NO_ACTION,this.senderPlace=-1,this.receiverPlace=-1,this.fromTarget="",this.optCardData=null,this.removeCard=!1,this.skillKey="",this.fightNodeArr=[],this.usageTime=-1,this.callBack=null}return t}();__reflect(CombatNode.prototype,"CombatNode");var FightNode=function(){function t(){this.hited=!0,this.damage=0,this.buffRound=0,this.recipient=!0,this.died=!1}return t}();__reflect(FightNode.prototype,"FightNode");var CombatOptNote=function(){function t(){}return t}();__reflect(CombatOptNote.prototype,"CombatOptNote");var FightSkillContent=function(){function t(){}return t}();__reflect(FightSkillContent.prototype,"FightSkillContent");var ActionContent=function(){function t(){}return t}();__reflect(ActionContent.prototype,"ActionContent");var CardFormsConfig=function(){function t(){this.posX=0,this.posY=0,this.gapX=0,this.gapY=0,this.scaleX=1,this.scaleY=1,this.zIndex=0}return t}();__reflect(CardFormsConfig.prototype,"CardFormsConfig");var SendCardConfig=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.space=0,e.act_attr={spead:0},e}return __extends(e,t),e}(CardFormsConfig);__reflect(SendCardConfig.prototype,"SendCardConfig");var OutCardConfig=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.space=0,e.act_attr={spead:0},e}return __extends(e,t),e}(CardFormsConfig);__reflect(OutCardConfig.prototype,"OutCardConfig");var DeathCardConfig=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.space=0,e.act_attr={spead:0},e}return __extends(e,t),e}(CardFormsConfig);__reflect(DeathCardConfig.prototype,"DeathCardConfig");var EffCompBaseConfig=function(){function t(){this.note="",this.compId="",this.posX=0,this.posY=0,this.gapX=0,this.gapY=0,this.scaleX=1,this.scaleY=1,this.zIndex=0,this.anchorCenter=!0,this.posCenter=!0,this.showDelay=0}return t}();__reflect(EffCompBaseConfig.prototype,"EffCompBaseConfig");var ImageConfig=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.res="",e}return __extends(e,t),e}(EffCompBaseConfig);__reflect(ImageConfig.prototype,"ImageConfig");var BitmapLabelConfig=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.res="",e}return __extends(e,t),e}(EffCompBaseConfig);__reflect(BitmapLabelConfig.prototype,"BitmapLabelConfig");var LabelConfig=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.text="",e.size=0,e.textColor=0,e.fontFamily="",e.stroke=0,e.strokeColor=0,e.bold=!1,e.lineSpacing=0,e.textAlign="left",e.wordWrap=!1,e.width=-1,e.height=-1,e}return __extends(e,t),e}(EffCompBaseConfig);__reflect(LabelConfig.prototype,"LabelConfig");var MovieClipConfig=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.jsName="",e.mcName="",e.actName="",e.frameRate=-1,e.playTimes=-1,e.remove=!1,e.directionX=!1,e.directionY=!1,e}return __extends(e,t),e}(EffCompBaseConfig);__reflect(MovieClipConfig.prototype,"MovieClipConfig");var CActionAttrConfig=function(){function t(){this.loop=!1,this.speed=200,this.preDelay=0,this.postDelay=0,this.remove=!1}return t}();__reflect(CActionAttrConfig.prototype,"CActionAttrConfig");var CActionConfig=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(CActionAttrConfig);__reflect(CActionConfig.prototype,"CActionConfig");var CombatUtils=function(){function t(){}return t.getConfig=function(e,a){if(null==e)return null;var n=new a;return t.assignmentObj(n,e),n},t.assignmentObj=function(t,e){if(null!=t){var a=Object.getOwnPropertyNames(t);for(var n in a){var r=a[n];e.hasOwnProperty(r)&&(t[r]=e[r])}}},t.create=function(t){return new t},t.sortCardPos=function(t,e,a){for(var n=0,r=t.length;r>n;n++){var o=t[n];null!=o&&(o.x=n*(o.width+e)+a.x+o.anchorOffsetX,o.y=0+a.y+o.anchorOffsetY)}},t.getCardIndexByCardCode=function(t,e){for(var a=-1,n=0,r=e.length;r>n;n++){var o=e[n],i=o.getData().cdata;if(null!=i.code&&i.code==t){a=n;break}}return a},t.getCardViewByCardCode=function(t,e){for(var a,n=0,r=e.length;r>n;n++){var o=e[n],i=o.getData().cdata;if(null!=i&&null!=i.code&&i.code==t){a=o;break}}return a},t.changeCardGroupName=function(t,e){var a={},n=e.groupName,r="";switch(t){case CombatConstants.CARD_GROUP_ATK_HAND:case CombatConstants.CARD_GROUP_DFD_HAND:case CombatConstants.CARD_GROUP_ATK_DEATH:case CombatConstants.CARD_GROUP_DFD_DEATH:null==n&&(e.groupName=n=CombatConstants.CARD_SQUARE_GROUP_PREFIX+e.code),n.substr(0,8)!=CombatConstants.CARD_SQUARE_GROUP_PREFIX&&(r=CombatConstants.CARD_SQUARE_GROUP_PREFIX);break;case CombatConstants.CARD_GROUP_ATK_OUT:case CombatConstants.CARD_GROUP_DFD_OUT:null==n&&(e.groupName=n=CombatConstants.CARD_RECTANGLE_GROUP_PREFIX+e.code),n.substr(0,8)!=CombatConstants.CARD_RECTANGLE_GROUP_PREFIX&&(r=CombatConstants.CARD_RECTANGLE_GROUP_PREFIX)}if(""!=r){var o=n.split("_");if(2!=o.length)return;var i=o[1];for(var l in e)a[l]=e[l];a.groupName=r+i}else a=e;return a},t.getSymbolStr=function(t){return 0>=t?""+t:"+"+t},t.getSymbolAttributeStr=function(e,a){var n="",r=LanguageManager.getInstance().getLabelLanguage("CombatCommon");return e==CombatConstants.MODIFY_ATTRIBUTE_HP?n=r.lbl_0:e==CombatConstants.MODIFY_ATTRIBUTE_ATK?n=r.lbl_1:e==CombatConstants.MODIFY_ATTRIBUTE_LIMIT_HP?n=r.lbl_2:e==CombatConstants.MODIFY_ATTRIBUTE_SKILL_CD?n=r.lbl_3:e==CombatConstants.MODIFY_ATTRIBUTE_REDUCE_DAMAGE&&(n=r.lbl_4),n+=t.getSymbolStr(a)+"\n"},t.getAMSpeed=function(t,e){if(void 0===e&&(e=-1),null==t||0>=t)return t;var a=t/CombatConstants.FIGHT_ACCELERATION_MULTIPLE;return-1!=e&&(a=Number(a.toFixed(e))),a},t.getAMFrameRate=function(t,e){if(void 0===e&&(e=-1),null==t||0>=t)return t;var a=t*CombatConstants.FIGHT_ACCELERATION_MULTIPLE;return-1!=e&&(a=Number(a.toFixed(e))),a},t.checkHasData=function(t,e){for(var a=!1,n=0,r=e.length;r>n;n++){var o=e[n];if(null!=o&&o==t){a=!0;break}}return a},t.getCutDownShowContent=function(t){var e="00:00";if(t>0){var a=Math.floor(t/60),n=10>a?"0":"",r=t%60,o=10>r?"0":"";e=n+n+":"+o+r}return e},t.getRankId=function(t){void 0===t&&(t=8);for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=t,n=e.length,r=[],o=0;a>o;o++)r[o]=e.charAt(Math.random()*n);return r.join("")},t}();__reflect(CombatUtils.prototype,"CombatUtils");var CResManager=function(){function t(){}return t.getInstance=function(){var e=this;return null==e.m_manager&&(e.m_manager=new t),e.m_manager},t.prototype.addResByRCSkillKey=function(t){if(null!=t&&""!=t){var e=this;if(null==e.arrRCSkillKey&&(e.arrRCSkillKey=new Array),!CombatUtils.checkHasData(t,e.arrRCSkillKey)){e.arrRCSkillKey.push(t);var a=CombatConfig.getInstance().getRCSkillExpFormsConfig(),n=a[t];if(null!=n){var r=n[CombatConstants.SKILL_REC_ATTR];e.parseSkillMCConfig(r);var o=n[CombatConstants.SKILL_RES_ATTR];e.parseSkillMCConfig(o)}}}},t.prototype.parseSkillMCConfig=function(t){if(null!=t&&t.hasOwnProperty(CombatConstants.EFF_COMP)){var e=t[CombatConstants.EFF_COMP];if(null!=e||e.hasOwnProperty(CombatConstants.EFF_COMP_MOVIECLIPS)){var a=this,n=e[CombatConstants.EFF_COMP_MOVIECLIPS];for(var r in n){var o=n[r];null!=o&&o.hasOwnProperty(CombatConstants.COMPONENT_ID)&&a.addMCSource(a.getSourceByMCConfig(o))}}}},t.prototype.getSourceByMCConfig=function(t){if(null==t)return"";var e=CombatConfig.getInstance().getEffComponentConfig(t,CombatConstants.EFF_COMP_MOVIECLIPS);return e.jsName+"."+e.mcName},t.prototype.addMCSource=function(t){var e=this;null==e.arrMCSource&&(e.arrMCSource=new Array),CombatUtils.checkHasData(t,e.arrMCSource)||(e.arrMCSource.push(t),null==e.arrLoadMCSource&&(e.arrLoadMCSource=new Array),e.arrLoadMCSource.push(t),e.arrLoadMCSource.length<=1&&e.onLoadMCData(e.arrLoadMCSource))},t.prototype.onLoadMCData=function(t,e){void 0===e&&(e=null);var a=this;if(null!=t){if(null!=e)for(var n=0,r=t.length;r>n;n++){var o=t[n];if(null!=o&&o==e){t.splice(n,1);break}}if(!(t.length<=0)){var i=t[0],l=new UIMovieClip;l.source=i,l.once(UIMovieClip.LOAD_FIN_EVENT,a.onLoadMCData.bind(a,t,i),l)}}},t}();__reflect(CResManager.prototype,"CResManager");var FightExpForm=function(){function t(t){this.view=t}return t.prototype.moveExpForm=function(t,e,a,n){void 0===n&&(n=null);var r=this,o=new CActionConfig;o.moveToX=t,o.moveToY=e,o.speed=a,CombatAction.playAction(o,r.view,n)},t.prototype.playHeadCommonExpFromByType=function(t,e,a,n){if(void 0===a&&(a=null),void 0===n&&(n=null),null==t||""==t)return void(null!=n&&n.run());var r=this,o=CombatConfig.getInstance().getHeadCommonExpFormsConfig(),i=o[t];if(null==i)return void(null!=n&&n.run());var l=i[CombatConstants.EFF_COMP];r.setEffComponent(l,e,a);var C=e==CombatConstants.PLACE_ATK?CombatConstants.ATKC_ATTR:CombatConstants.DFDC_ATTR,s=i[C];null!=s&&r.parseExpFormsAction(s,r.view);var u=i[CombatConstants.USAGE_TIME];u=u=CombatUtils.getAMSpeed(u),null!=n&&egret.setTimeout(function(t){t.run()}.bind(r,n),r,u)},t.prototype.playHeadSkillExpFromByType=function(t,e,a,n,r){if(void 0===n&&(n=null),void 0===r&&(r=null),null==t||""==t||null==e||""==e)return void(null!=r&&r.run());var o=this,i=CombatConfig.getInstance().getHeadSkillExpFormsConfig(),l=i[t];if(null==l)return void this.playHeadCommonExpFromByType(CombatConstants.EXP_FORM_HIT,CombatConstants.PLACE_ATK,n,r);if(n=null==n?new FightNode:n,null==n.skillNameShow){var C=LanguageManager.getInstance().getCurLanguageType();null!=l.name&&null!=l.name[C]&&(n.skillNameShow=l.name[C])}var s=l[e];if(null==s)return void(null!=r&&r.run());var u=s[CombatConstants.EFF_COMP];o.setEffComponent(u,a,n);var c=a==CombatConstants.PLACE_ATK?CombatConstants.ATKC_ATTR:CombatConstants.DFDC_ATTR,d=s[c];null!=d&&o.parseExpFormsAction(d,o.view);var p=s[CombatConstants.USAGE_TIME];p=p=CombatUtils.getAMSpeed(p),null!=r&&egret.setTimeout(function(t){t.run()}.bind(o,r),o,p)},t.prototype.playHeadFetterExpFrom=function(t,e,a,n,r){if(void 0===n&&(n=null),void 0===r&&(r=!0),null==t||""==t||null==e||""==e)return void(null!=n&&n.run());var o=this,i=CombatConfig.getInstance().getHeadFetterExpFormsConfig(),l=i[t];if(null==l)return void(null!=n&&n.run());var C=l[e];if(null==C)return void(null!=n&&n.run());var s=C[CombatConstants.EFF_COMP],u=0,c="",d=s[CombatConstants.EFF_COMP_IMAGE];if(null!=d){var p=CombatConfig.getInstance().getEffComponentConfig(d,CombatConstants.EFF_COMP_IMAGES);c=p.res,u=p.showDelay}null==o.arrFetterView&&(o.arrFetterView=new Array);for(var m=null,_=0,g=o.arrFetterView.length;g>_;_++){var f=o.arrFetterView[_];if(null!=f&&f.getCurFetterKey()==t){m=f;break}}if(null!=m)return void(null!=n&&n.run());if(r){var T=new FightNode,b=LanguageManager.getInstance().getCurLanguageType();null!=l.name&&null!=l.name[b]&&(T.skillNameShow=l.name[b]),o.setEffComponent(s,a,T)}else u=0;m=new CRFetterItemView,m.initData({iconRes:c,skillKey:t});var h=o.view.getParentByType(2);h.addChild(m),o.delayDisplay(m,u,Handler.create(o,function(t){o.arrFetterView.push(t)},[m]));var v=C[CombatConstants.USAGE_TIME];v=v=CombatUtils.getAMSpeed(v),null!=n&&egret.setTimeout(function(t){t.run()}.bind(o,n),o,v)},t.prototype.playRCCommonExpFromByType=function(t,e,a,n){if(void 0===a&&(a=null),void 0===n&&(n=null),null==t||""==t)return void(null!=n&&n.run());var r=this,o=CombatConfig.getInstance().getRCCommonExpFormsConfig(),i=o[t];if(null==i)return void(null!=n&&n.run());var l=i[CombatConstants.EFF_COMP];r.setEffComponent(l,e,a);var C=e==CombatConstants.PLACE_ATK?CombatConstants.ATKC_ATTR:CombatConstants.DFDC_ATTR,s=i[C];null!=s&&r.parseExpFormsAction(s,r.view);var u=i[CombatConstants.USAGE_TIME];u=u=CombatUtils.getAMSpeed(u),null!=n&&egret.setTimeout(function(t){t.run()}.bind(r,n),r,u)},t.prototype.playRCModifyAttributeExpFrom=function(t,e,a,n,r){void 0===n&&(n=null),void 0===r&&(r=null);var o=this;""==t?o.playRCCommonExpFromByType(CombatConstants.EXP_FORM_MODIFY,a,n,r):o.playRCSkillExpFromByType(t,e,a,n,r)},t.prototype.playRCSkillExpFromByType=function(t,e,a,n,r){if(void 0===n&&(n=null),void 0===r&&(r=null),null==t||""==t||null==e||""==e)return void(null!=r&&r.run());var o=this,i=CombatConfig.getInstance().getRCSkillExpFormsConfig(),l=i[t];if(null==l)return void(null!=r&&r.run());if(n=null==n?new FightNode:n,null==n.skillNameShow){var C=LanguageManager.getInstance().getCurLanguageType();null!=l.name&&null!=l.name[C]&&(n.skillNameShow=l.name[C])}var s=l[e];if(null==s)return void(null!=r&&r.run());var u=s[CombatConstants.EFF_COMP];o.setEffComponent(u,a,n);var c=a==CombatConstants.PLACE_ATK?CombatConstants.ATKC_ATTR:CombatConstants.DFDC_ATTR,d=s[c];null!=d&&o.parseExpFormsAction(d,o.view);var p=s[CombatConstants.USAGE_TIME];p=p=CombatUtils.getAMSpeed(p),null!=r&&egret.setTimeout(function(t){t.run()}.bind(o,r),o,p)},t.prototype.playRCFetterExpFrom=function(t,e,a,n,r){if(void 0===n&&(n=null),void 0===r&&(r=null),null==t||""==t||null==e||""==e)return void(null!=r&&r.run());var o=this,i=CombatConfig.getInstance().getRCFetterExpFormsConfig(),l=i[t];if(null==l)return void(null!=r&&r.run());var C=l[e];if(null==C)return void(null!=r&&r.run());var s=C[CombatConstants.EFF_COMP];if(s.hasOwnProperty(CombatConstants.EFF_COMP_LABELS)){var u=s[CombatConstants.EFF_COMP_LABELS],c=null,d=null,p="",m="";if(null!=n&&null!=n[CombatConstants.EFF_COMP_LABEL_REDUCE]&&(p=n[CombatConstants.EFF_COMP_LABEL_REDUCE],c=u[CombatConstants.EFF_COMP_LABEL_REDUCE]),null!=n&&null!=n[CombatConstants.EFF_COMP_LABEL_INCREASE]&&(m=n[CombatConstants.EFF_COMP_LABEL_INCREASE],d=u[CombatConstants.EFF_COMP_LABEL_INCREASE]),""!=p||""!=m){var _=null,g=null;null!=c&&(_=CombatConfig.getInstance().getEffComponentConfig(c,CombatConstants.EFF_COMP_LABELS)),null!=d&&(g=CombatConfig.getInstance().getEffComponentConfig(d,CombatConstants.EFF_COMP_LABELS));var f=null;if(null!=_?f=CombatEffComp.addLabelByConfig(_,o.view.getParentByZIndex(_.zIndex),p+m):null!=d&&(f=CombatEffComp.addLabelByConfig(g,o.view.getParentByZIndex(g.zIndex),p+m)),null!=f){var T=[];""!=p&&T.push({text:p,style:{size:_.size,textColor:_.textColor,strokeColor:_.strokeColor}}),""!=m&&T.push({text:m,style:{size:g.size,textColor:g.textColor,strokeColor:g.strokeColor}}),0!=T.length&&(f.textFlow=T,null!=_?o.delayDisplay(f,_.showDelay,Handler.create(o,function(t,e){o.parseAction(t,e)},[c,f])):null!=g&&o.delayDisplay(f,g.showDelay,Handler.create(o,function(t,e){o.parseAction(t,e)},[d,f])))}}}var b=C[CombatConstants.USAGE_TIME];b=b=CombatUtils.getAMSpeed(b),null!=r&&egret.setTimeout(function(t){t.run()}.bind(o,r),o,b)},t.prototype.addRCBuff=function(t,e,a){if(void 0===e&&(e=null),void 0===a&&(a=null),null==t||""==t)return void(null!=a&&a.run());var n=this,r=CombatConfig.getInstance().getRCBuffExpFormsConfig(),o=r[t];if(null!=o){var i=o[CombatConstants.EFF_COMP],l="",C=i[CombatConstants.EFF_COMP_IMAGE];if(null!=C){var s=CombatConfig.getInstance().getEffComponentConfig(C,CombatConstants.EFF_COMP_IMAGES);l=s.res}var u=e.buffRound;null==n.arrBuffView&&(n.arrBuffView=new Array);for(var c=null,d=0,p=n.arrBuffView.length;p>d;d++){var m=n.arrBuffView[d];if(null!=m&&m.getCurBuffKey()==t){c=m;break}}if(null!=c)c.updateShow(u,l);else{c=new CRBuffItemView,c.initData({iconRes:l,buffRound:u,skillKey:t});var _=n.view.getParentByType(2);_.addChild(c),n.arrBuffView.push(c),n.sortRCBuff()}null!=a&&a.run()}},t.prototype.sortRCBuff=function(){var t=this;if(!(null==t.arrBuffView||t.arrBuffView.length<=0))for(var e=0,a=t.arrBuffView.length;a>e;e++){var n=t.arrBuffView[e];null!=n&&(n.x=e*n.getViewWidth())}},t.prototype.removeRCBuff=function(t,e){void 0===e&&(e=null);var a=this;if(null==a.arrBuffView)return void(null!=e&&e.run());for(var n=a.arrBuffView.length-1;n>=0;n--){var r=a.arrBuffView[n];null!=r&&r.getCurBuffKey()==t&&(r.parent.removeChild(r),a.arrBuffView.splice(n,1))}a.sortRCBuff(),null!=e&&e.run()},t.prototype.updateRCBuff=function(t,e,a){void 0===e&&(e=null),void 0===a&&(a=null);var n=this,r=null;if(null!=n.arrBuffView)for(var o=n.arrBuffView.length-1;o>=0;o--){var i=n.arrBuffView[o];if(null!=i&&i.getCurBuffKey()==t){r=i,i.updateShow(e.buffRound,"");break}}return null==r?void n.addRCBuff(t,e,a):(n.sortRCBuff(),void(null!=a&&a.run()))},t.prototype.addRCContinueSkill=function(t,e,a,n){void 0===n&&(n=null);var r=this;if(r.checkHasContinueSkill(t))return void(null!=n&&n.run());var o=CombatConfig.getInstance().getRCSkillExpFormsConfig(),i=o[t];if(null==i)return void(null!=n&&n.run());var l=i[e];if(null==l)return void(null!=n&&n.run());var C=l[CombatConstants.EFF_COMP];if(C.hasOwnProperty(CombatConstants.EFF_COMP_MOVIECLIPS)){var s=C[CombatConstants.EFF_COMP_MOVIECLIPS],u=new Array;for(var c in s){var d=s[c];if(null!=d){var p=r.addMovieClipByData(d,a);u.push(p)}}u.length>0&&r.addFightSkillContent(t,u)}var m=l[CombatConstants.USAGE_TIME];m=m=CombatUtils.getAMSpeed(m),null!=n&&egret.setTimeout(function(t){t.run()}.bind(r,n),r,m)},t.prototype.removeContinueSkill=function(t){this.removeFightSkillContent(t)},t.prototype.addSCContinueSkill=function(t,e,a,n){void 0===a&&(a=-1),void 0===n&&(n=null);var r=this;if(r.checkHasContinueSkill(t))return void(null!=n&&n.run());var o=CombatConfig.getInstance().getSCSkillExpFormsConfig(),i=o[t];if(null==i)return void(null!=n&&n.run());var l=i[e];if(null==l)return void(null!=n&&n.run());var C=l[CombatConstants.EFF_COMP];if(C.hasOwnProperty(CombatConstants.EFF_COMP_MOVIECLIPS)){var s=C[CombatConstants.EFF_COMP_MOVIECLIPS],u=new Array;for(var c in s){var d=s[c];if(null!=d){var p=r.addMovieClipByData(d,a);u.push(p)}}u.length>0&&r.addFightSkillContent(t,u)}var m=l[CombatConstants.USAGE_TIME];m=m=CombatUtils.getAMSpeed(m),null!=n&&egret.setTimeout(function(t){t.run()}.bind(r,n),r,m)},t.prototype.delayDisplay=function(t,e,a){if(void 0===a&&(a=null),null==t)return void(null!=a&&a.run());var n=CombatUtils.getAMSpeed(e);if(0!=n){var r=t.parent;if(null==r)return void(null!=a&&a.run());r.removeChild(t);var o=Handler.create(self,function(t,e,a){e.addChild(a),null!=t&&t.run()},[a,r,t]);egret.setTimeout(function(t){t.run()}.bind(self,o),self,n)}else null!=a&&a.run()},t.prototype.setEffComponent=function(t,e,a){if(void 0===a&&(a=null),null!=t){var n=this;if(t.hasOwnProperty(CombatConstants.EFF_COMP_IMAGES)){var r=t[CombatConstants.EFF_COMP_IMAGES];for(var o in r){var i=r[o];if(null!=i){var l=CombatConfig.getInstance().getEffComponentConfig(i,CombatConstants.EFF_COMP_IMAGES),C=CombatEffComp.addImageByConfig(l,n.view.getParentByZIndex(l.zIndex));n.delayDisplay(C,l.showDelay,Handler.create(n,function(t,e){n.parseAction(t,e)},[i,C]))}}}if(t.hasOwnProperty(CombatConstants.EFF_COMP_BITMAP_LABELS)){var s=t[CombatConstants.EFF_COMP_BITMAP_LABELS];for(var o in s){var u=s[o];if(null!=u){var c=null;if(null!=a&&null!=a[o])c=a[o];else{var d=g[CombatConstants.ATTR_TEXT];null!=d&&""!=d&&(c=d)}if(null!=c){var p=CombatConfig.getInstance().getEffComponentConfig(u,CombatConstants.EFF_COMP_BITMAP_LABELS),m=CombatEffComp.addBitmapLabelByConfig(p,n.view.getParentByZIndex(p.zIndex),c);n.delayDisplay(m,p.showDelay,Handler.create(n,function(t,e){n.parseAction(u,m)},[u,m]))}}}}if(t.hasOwnProperty(CombatConstants.EFF_COMP_LABELS)){var _=t[CombatConstants.EFF_COMP_LABELS];for(var o in _){var g=_[o];if(null!=g){var c=null;if(null!=a&&null!=a[o])c=a[o];else{var d=g[CombatConstants.ATTR_TEXT];null!=d&&""!=d&&(c=d)}if(null!=c){var f=CombatConfig.getInstance().getEffComponentConfig(g,CombatConstants.EFF_COMP_LABELS),T=CombatEffComp.addLabelByConfig(f,n.view.getParentByZIndex(f.zIndex),c);n.delayDisplay(T,f.showDelay,Handler.create(n,function(t,e){n.parseAction(t,e)},[g,T]))}}}}if(t.hasOwnProperty(CombatConstants.EFF_COMP_MOVIECLIPS)){var b=t[CombatConstants.EFF_COMP_MOVIECLIPS];for(var o in b){var h=b[o];null!=h&&n.addMovieClipByData(h,e)}}}},t.prototype.addMovieClipByData=function(t,e){if(null!=t){var a=this,n=CombatConfig.getInstance().getEffComponentConfig(t,CombatConstants.EFF_COMP_MOVIECLIPS),r=CombatEffComp.addMovieClipByConfig(n,a.view.getParentByZIndex(n.zIndex));return a.delayDisplay(r,n.showDelay,Handler.create(a,function(){a.parseAction(t,r)})),null!=n&&(null!=n.directionX&&n.directionX&&e==CombatConstants.PLACE_ATK&&(r.scaleX=-1),null!=n.directionY&&n.directionY&&e==CombatConstants.PLACE_ATK&&(r.scaleY=-1),null!=n.remove&&n.remove&&r.once(egret.Event.COMPLETE,function(t){r.parent.removeChild(r)},a)),r}},t.prototype.addFightSkillContent=function(t,e){var a=this;null==a.arrFightSkillContent&&(a.arrFightSkillContent=new Array);var n=new FightSkillContent;n.skillKey=t,n.mcs=e,a.arrFightSkillContent.push(n)},t.prototype.removeFightSkillContent=function(t){var e=this;if(null!=t&&""!=t&&null!=e.arrFightSkillContent)for(var a=e.arrFightSkillContent.length-1;a>=0;a--){var n=e.arrFightSkillContent[a];if(null!=n&&n.skillKey==t){for(var r=n.mcs,o=r.length-1;o>=0;o--){var i=r[a];null!=i.parent&&i.parent.removeChild(i),r.splice(a,1)}e.arrFightSkillContent.splice(a,1)}}},t.prototype.checkHasContinueSkill=function(t){if(null==t||""==t)return!1;var e=this;if(null==e.arrFightSkillContent)return!1;for(var a=!1,n=e.arrFightSkillContent.length-1;n>=0;n--){var r=e.arrFightSkillContent[n];if(null!=r&&r.skillKey==t){a=!0;break}}return a},t.prototype.parseExpFormsAction=function(t,e,a){if(void 0===a&&(a=null),null==t||null==e)return void(null!=a&&a.run());var n=this;null==n.arrExpFormsActions&&(n.arrExpFormsActions=new Array);for(var r=n.arrExpFormsActions.length-1;r>=0;r--){var o=n.arrExpFormsActions[r];null!=o&&o.target==e&&(CombatAction.recoverAction(o),n.arrExpFormsActions.splice(r,1))}var i=new ActionContent;i.oriData={x:e.x,y:e.y,rotation:e.rotation,alpha:e.alpha},i.target=e,n.arrExpFormsActions.push(i);var l=Handler.create(n,function(){for(var t=0,e=n.arrExpFormsActions.length;e>t;t++){var r=n.arrExpFormsActions[t];if(null!=r&&r==i){n.arrExpFormsActions.splice(t,1);break}}null!=a&&a.run()});n.parseAction(t,e,l)},t.prototype.parseAction=function(t,e,a){if(void 0===a&&(a=null),null==t||null==e)return void(null!=a&&a.run());var n=t;t.hasOwnProperty(CombatConstants.ACTION_ID)&&(n=CombatConfig.getInstance().getCommonActionDataById(t[CombatConstants.ACTION_ID]));var r=CombatConfig.getInstance().getActionAttrConfig(n),o=[];if(n.hasOwnProperty(CombatConstants.EFF_ACTS)){var i=n[CombatConstants.EFF_ACTS];for(var l in i){var C=i[l];if(null!=C){var s=CombatConfig.getInstance().getActionConfig(C,r);o.push(s)
}}}else null!=r&&o.push(r);CombatAction.playActions(o,e,a)},t}();__reflect(FightExpForm.prototype,"FightExpForm");