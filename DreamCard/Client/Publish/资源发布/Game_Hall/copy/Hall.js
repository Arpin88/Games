var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);r.prototype=t.prototype,e.prototype=new r},ChouCardView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrCardFetters=new Array,r.mallName=[],r.movieIdx=0,r.movieStateType=0,r}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),this.btnConfirm.$setVisible(!1),this.btnCancel.$setVisible(!1),e.tittle1.$setVisible(!1),e.movieStartTimer()},t.prototype.createImage=function(){var e=1;this.movieImg=new eui.Image,this.movieImg.source="res-Hall/res/animation/00001.png",this.movieImg.x=this.width/2-300*e,this.movieImg.y=0,this.movieImg.scaleX=this.movieImg.scaleY=e,this.addChild(this.movieImg)},t.prototype.clearAni=function(){this.movieTimer.stop(),null!=this.movieTimer&&this.movieImg.$setVisible(!1),null!=this.movieImg&&this.removeChild(this.movieImg)},t.prototype.movieStartTimer=function(){this.createImage(),this.movieStateType=0;var e=this;null==e.movieTimer&&(e.movieTimer=new egret.Timer(100,0),e.movieTimer.addEventListener(egret.TimerEvent.TIMER,e.movieTimerFunc,e)),this.movieImg.y=-500,egret.Tween.get(this.movieImg,{loop:!1}).to({y:150},600,egret.Ease.quadOut).call(function(){e.movieTimer.start()})},t.prototype.movieTimerFunc=function(){this.movieIdx=this.movieIdx+1,0==this.movieStateType?this.movieIdx>=26&&(this.movieIdx=8):(27==this.movieIdx&&(this.movieImg.x=this.width/2-250,this.movieImg.y=200),this.movieIdx>=41&&(this.movieIdx=0,this.movieStopTimer())),this.movieImg.source="res-Hall/res/animation/"+ExternalFun.prototype.add0(this.movieIdx,5)+".png"},t.prototype.movieStopTimer=function(){this.clearAni(),this.btnConfirm.$setVisible(!0),this.btnCancel.$setVisible(!0),this.setCardItem()},t.prototype.sleep=function(){this.cleanArray(this.arrCardFetters)},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_Award10:case HallCmdDef.CMD_MyCardList:for(var a=(t.msg,t.msg.length),n=0;a>n;n++){var o=t.msg[n];r.mallName[n]=o}0>=a?(r.tittle1.$setVisible(!0),this.clearAni()):this.movieStateType=1}},t.prototype.setCardItem=function(){for(var e=this.panel.width/5,t=40,r=this.mallName.length,a=.4,n=0;r>n;n++){var o=new CardRectangleView,i=this.mallName[n],l=0,s=0,c={icon:i.iconUrl,rarity:i.rarity,element:i.ele,round:i.round,generation:i.generation,name:i.name,cost:i.cost,level:i.level,atk:i.atk,hp:i.hp,groupName:i.groupname,canTouch:!0};o.initData(c),o.scaleX=a,o.scaleY=a;var u=r/2;if(u>n?(l=.2*e+e*n,s=t):(l=.2*e+e*(n-u),s=t+o.height*a+30),o.alpha=.2,o.x=this.width/2-100,o.y=this.height/2-100,this.panel.addChild(o),this.arrCardFetters.push(o),egret.Tween.get(o,{loop:!1}).wait(10+50*n).to({alpha:1,x:l,y:s},500),"common"==i.rarity){var p=new eui.Image;p.scaleX=5,p.scaleY=5,p.x=-450,p.y=-350,p.source="ani00008_png",p.alpha=.5,egret.Tween.get(p,{loop:!0}).to({alpha:1},1e3).to({alpha:.5},1e3),o.addChild(p)}else{var h=new UIMovieClip;h.scaleX=5,h.scaleY=5,h.x=190,h.y=290,"rare"==i.rarity?h.source="greenanimation.animation":"epic"==i.rarity?h.source="blueanimation.animation":"legendary"==i.rarity?h.source="purpleanimation.animation":"mythical"==i.rarity?h.source="orangeanimation.animation":h.source="purpleanimation.animation",h.gotoAndPlay("play1",-1),o.addChild(h)}}},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.touchTap=function(e){var t=this,r=e.target;if(r instanceof eui.Button){if(r==t.btnConfirm){t.hiden(),console.log("确定被按下");var a=new Object;a.param="抽奖";var n=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(n.getSname(),HallCmdDef.CMD_Award,a,!1)}else if(r==t.btnCancel){this.cleanArray(this.arrCardFetters);var a=new Object;a.param="十连抽抽奖按钮",a.pageid="1",a.pageSize="9";var n=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(n.getSname(),HallCmdDef.CMD_MyCardList,a,!1),this.btnConfirm.$setVisible(!1),this.btnCancel.$setVisible(!1),t.movieStartTimer()}}else r instanceof eui.Rect&&r==t.rectBG},t.NAME="ChouCardSkin",t}(BaseView);__reflect(ChouCardView.prototype,"ChouCardView");var Hall;!function(e){function t(){return{}}function r(e,t){LanguageManager.getInstance().setLanguagePackage("Hall"),UIManager.getInstance().registerViewNameByGkid(1,HallView,"大厅"),c=t,l(),o(e)}function a(){null!=c&&(c(),c=null)}function n(){i(),s()}function o(e){UIManager.getInstance().showUI(HallView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,e)}function i(){UIManager.getInstance().hideUI(HallView)}function l(){u||(u=new HallDecoder);var e=BaseDecode.getInstance();e.registerDecoder(u)}function s(){var e=BaseDecode.getInstance();e.removeDecoder(u)}var c;e.getResConf=t,e.init=r,e.onGameShow=a,e.dispose=n;var u}(Hall||(Hall={}));var CardHeadView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);if(null!=r){var a=r.icon;t.setCardHead(a);var n=r.rarity;t.setCardHeadFrame(n);var o=r.element;t.setAttr(o);var i=r.level,l=r.generation;t.setLvl(i,l);var s=r.name;t.setCardName(s);var c=r.combat;t.setCombat(c),t.showSimple()}},t.prototype.showSimple=function(){this.labGene.$setVisible(!1),this.groupLevel.$setVisible(!1)},t.prototype.sleep=function(){},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.setCardHead=function(e){null!=e&&void 0!=e&&(this.imgHead.source="headImg0Sheet_json."+e)},t.prototype.setGrayHead=function(){this.labCardName.textColor=11579568,this.zhanlitxt.textColor=11579568,ExternalFun.prototype.setImgGray(this.imgHeadFrame),ExternalFun.prototype.setImgGray(this.imgAttr),ExternalFun.prototype.setImgGray(this.imgHead)},t.prototype.setCardHeadFrame=function(e){switch(e){case"common":this.imgHeadFrame.source="combatRecordSheet_json.a86x86_0";break;case"rare":this.imgHeadFrame.source="combatRecordSheet_json.a86x86_1";break;case"epic":this.imgHeadFrame.source="combatRecordSheet_json.a86x86_2";break;case"legendary":this.imgHeadFrame.source="combatRecordSheet_json.a86x86_3";break;case"mythical":this.imgHeadFrame.source="combatRecordSheet_json.a86x86_4"}},t.prototype.setAttr=function(e){switch(e){case"fire":this.imgAttr.source="combatRecordSheet_json.a28x28_0";break;case"metal":this.imgAttr.source="combatRecordSheet_json.a28x28_1";break;case"wood":this.imgAttr.source="combatRecordSheet_json.a28x28_2";break;case"water":this.imgAttr.source="combatRecordSheet_json.a28x28_3";break;case"earth":this.imgAttr.source="combatRecordSheet_json.a28x28_4"}},t.prototype.setCardName=function(e){this.labCardName.text=e},t.prototype.setCombat=function(e){this.labCombat.text=""+e},t.prototype.setLvl=function(e,t){for(var r=0;e>r;r++){var a=new eui.Image;this.groupLevel.addChild(a),a.source="combatRecordSheet_json.a15x15_1",a.x=15*r,a.y=0}this.labGene.text=t+"代"},t.NAME="CardHeadViewSkin",t}(BaseView);__reflect(CardHeadView.prototype,"CardHeadView");var CardintroduceView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);if(null!=r){var a=r.icon;t.setCardHead(a);var n=r.code;t.setCardName(n)}},t.prototype.sleep=function(){},t.prototype.setCardHead=function(e){null!=e&&void 0!=e&&(this.imgIcon.source=e+"_json.r")},t.prototype.setCardName=function(e){this.imgElement.source="introducehero_json."+e},t.NAME="CardintroduceSkin",t}(BaseView);__reflect(CardintroduceView.prototype,"CardintroduceView");var CardItemView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrLetter=["a","b","c","d","e","f","g"],r}return __extends(t,e),t.prototype.week=function(){},t.prototype.sleep=function(){},t.prototype.setImgBG=function(e){var t=this;t.imgBG.source="lobbyImg1Sheet_json."+t.arrLetter[e-1]+"196x194"},t.prototype.getViewWidth=function(){return this.groupCI.width},t.prototype.getViewHeight=function(){return this.groupCI.height},t.NAME="CardItemSkin",t}(IBaseView);__reflect(CardItemView.prototype,"CardItemView");var CardOperationView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.bagItemChoose=1,r.arrBtnGroup=new Array,r.arrSkillList=new Array,r.curBtnIndex=-1,r.cardAttrInit=!1,r.cardFetterInit=!1,r.cardShowInit=!1,r.arrFetterItemView=new Array,r.arrAttrList=new Array,r.arrAttrLine=new Array,r.isTouchMove=!1,r.curCardView=null,r.myCardView=null,r.skillAry=[],r.skillOpenAry=[],r.unlockOpenAry=[],r.ckjTxt="参考价:",r.daijTxt="代",r.xingjTxt="星",r.zhudongTxt="主动技能",r.beidongTxt="被动技能",r.jiesuoTxt="解锁",r.weijiesuojTxt="未解锁",r}return __extends(t,e),t.prototype.week=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t),t.hasEventListener(egret.TouchEvent.TOUCH_BEGIN)||t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.touchBegin,t),t.hasEventListener(egret.TouchEvent.TOUCH_END)||t.addEventListener(egret.TouchEvent.TOUCH_END,t.touchEnd,t);var r=LanguageManager.getInstance().getCurLanguageType();1==r&&(t.ckjTxt="Reference Price： ",t.daijTxt="Gen",this.xingjTxt="Star",this.zhudongTxt="Active Skill",this.beidongTxt="Passive Skill",this.jiesuoTxt="Unlocked",this.weijiesuojTxt="Locked");var a=e.prototype.getData.call(this);null!=a&&(t.rarityObj=a,t.setCardInfo(t.rarityObj),t.setCurRightGroupShow(0))},t.prototype.sleep=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.myCardView=null,e.cleanArray([e.cardSquareView]),e.cleanArray(e.arrSkillList),e.cardFetterInit&&(e.cardFetterInit=!1,e.cleanArray(e.arrFetterItemView)),e.cardShowInit&&(e.cardShowInit=!1,e.cleanArray([e.cardRectangleView])),e.cardAttrInit&&(e.cleanArrayLabel(e.arrAttrList),e.cleanArrayShape(e.arrAttrLine))},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.cleanArrayLabel=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.cleanArrayShape=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.touchTap=function(e){var t=this;if(e.target instanceof eui.Button){var r=e.target,a=62,n=0;if(r==t.btnClose)t.hiden();else if(r==t.btnLvlUp)null!=this.upBagInfo.bag1&&this.upBagInfo.bag1.shopNum>0?(t.ImgChoose.x=t.btnUserItem0.x+a,t.ImgChoose.y=t.btnUserItem0.y-n,t.bagItemChoose=1):null!=this.upBagInfo.bag2&&this.upBagInfo.bag2.shopNum>0?(t.ImgChoose.x=t.btnUserItem1.x+a,t.ImgChoose.y=t.btnUserItem1.y-n,t.bagItemChoose=2):null!=this.upBagInfo.bag3&&this.upBagInfo.bag3.shopNum>0?(t.ImgChoose.x=t.btnUserItem2.x+a,t.ImgChoose.y=t.btnUserItem2.y-n,t.bagItemChoose=3):(t.ImgChoose.x=t.btnUserItem0.x+a,t.ImgChoose.y=t.btnUserItem0.y-n,t.bagItemChoose=1),this.setCurRightGroupShow(4);else if(r==t.btnGeneUp)t.bagItemChoose=4,this.setCurRightGroupShow(5);else if(r==t.btnZhanshi)this.setCurRightGroupShow(1);else if(r==t.btnUserItem0)t.ImgChoose.x=r.x+a,t.ImgChoose.y=r.y-n,t.bagItemChoose=1;else if(r==t.btnUserItem1)t.ImgChoose.x=r.x+a,t.ImgChoose.y=r.y-n,t.bagItemChoose=2;else if(r==t.btnUserItem2)t.ImgChoose.x=r.x+a,t.ImgChoose.y=r.y-n,t.bagItemChoose=3;else if(r==t.btnUserItem){if(null!=this.upBagInfo.bag1&&null!=this.upBagInfo.bag2&&null!=this.upBagInfo.bag3&&this.upBagInfo.bag1.shopNum+this.upBagInfo.bag2.shopNum+this.upBagInfo.bag3.shopNum<=0)return void PopManager.getInstance().showPromptBox("道具不足,请前往商城购买!",2,Handler.create(t,function(e){t.hiden(),UIManager.getInstance().showUI(MallView)}));var o=this.upBagInfo["bag"+t.bagItemChoose];if(null==o)return;var i=o.bagId;new Object;o.shopNum>0&&this.upLvlByBag(1,i,o.shopKind)}else if(r==t.btnUseGeneItem){var o=this.upBagInfo.bag4;if(null==o)return;var i=o.bagId;t.bagItemChoose=4,o.shopNum>0&&this.upLvlByBag(2,i,o.shopKind)}}var l=e.target;l instanceof eui.Image&&(l==t.imgAttribute?this.setCurRightGroupShow(0):l==t.imgFetter?this.setCurRightGroupShow(2):l==t.imgShow?this.setCurRightGroupShow(1):l==t.imgSell&&this.setCurRightGroupShow(3))},t.prototype.setImgBtnBg=function(e){for(var t=[this.imgAttribute,this.imgShow,this.imgFetter,this.imgSell],r=0;4>r;r++)e!=r?t[r].source="hallBtn1Sheet_json.a86x114_0":t[r].source="hallBtn1Sheet_json.a86x114_1";1==e?this.kuang.$setVisible(!1):this.kuang.$setVisible(!0)},t.prototype.upLvlByBag=function(e,t,r){var a=new Object;a.type=e,a.bagId=t,a.code=this.code,a.shop_kind=r,a.itemIdx=this.bagItemChoose,a.usetype=!0;var n=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(n.getSname(),HallCmdDef.CMD_BaguseUp,a,!0)},t.prototype.touchBegin=function(e){if(e.target instanceof eui.Group){var t=e.target;if("groupSkill_"==t.name.substr(0,11)){var r=t.name.split("_");if(2!=r.length)return;var a=Number(r[1]),n=this.skillAry[a],o=this.skillOpenAry[a];null!=n&&(this.groupSkillExplain.visible=!0,this.groupSkillExplain.x=this.groupLeft.x+this.groupSkillList.x+this.arrSkillList[a].x+72,this.groupSkillExplain.y=this.groupLeft.y+this.groupSkillList.y+this.arrSkillList[a].y-12,this.labSkillName.text=n.sklName+" Lv. "+n.sklLvl,this.labSkillExplain.text=n.sklDesc,this.labeffect.text="无","1"==n.sklType?(this.labSkillType.text=this.zhudongTxt,this.labSkillType.textColor=16518202):(this.labSkillType.text=this.beidongTxt,this.labSkillType.textColor=9294847),1==o?this.labLockState.text=this.jiesuoTxt:this.labLockState.text=this.weijiesuojTxt)}}},t.prototype.touchEnd=function(e){this.groupSkillExplain.visible=!1},t.prototype.setCardName=function(e){this.labCardName.text=e},t.prototype.setCardView=function(e){var t=this.myCardView;null==t&&(t=new CardSquareView),t.initData(e),t.scaleX=t.scaleY=this.groupCardView.width/t.width,this.groupCardView.addChild(t),t.x=0,t.y=0;var r=100*this.cardInfo.exp/this.upLvlInfo.allexp;this.prbLoading0.value=r,this.labPrice.text=this.ckjTxt+(parseInt(e.val_initial)+parseInt(e.val_growing))+" XWG"},t.prototype.setimgGene=function(e){switch(e){case 1:this.imgGene.source="hallText0Sheet_json.daishu1";break;case 2:this.imgGene.source="hallText0Sheet_json.daishu2";break;case 3:this.imgGene.source="hallText0Sheet_json.daishu3"}},t.prototype.setgroupStar=function(e){e=ExternalFun.prototype.levelnumTo5lvl(e),this.groupStar.removeChildren();for(var t=0;5>t;t++){var r=new eui.Image("newcardpanel_json.star0");this.groupStar.addChild(r),r.x=35*t,r.y=-23}for(var t=0;e>t;t++){var r=null;r=e-1>t?new eui.Image("newcardpanel_json.star1"):new eui.Image("newcardpanel_json.star2"),this.groupStar.addChild(r),r.x=35*t,r.y=-23}},t.prototype.setCardInfo=function(e){if(null!=e){var t=e.cardDetail;if(this.code=e.code,this.curCardView=e.viewhandle,null!=t){var r=t.attribute;null!=r&&this.setAttribute(r)}e.canTouch=!1,this.cardInfo=t.attribute,this.cardJBInfo=t.fetters,this.upLvlInfo=t.myupLvl,this.upBagInfo=t.mybag,this.setCardView(this.cardInfo),this.setCardName(this.cardInfo.name),this.setimgGene(this.cardInfo.generation),this.setgroupStar(this.cardInfo.level);var a=t.myskill;this.skillAry=[a.skil1,a.skil2,a.skil3,a.skil4];var n=t.skillopen;this.skillOpenAry=[n.skillopen_1,n.skillopen_2,n.skillopen_3,n.skillopen_4];for(var o=[],i=0;i<t.UnlockSkillConfig.length;i++){var l=t.UnlockSkillConfig[i],s=l.sklIndex;o[s]=l}this.unlockOpenAry=[o[1],o[2],o[3],o[4]],this.setCardSkill(this.skillAry,this.skillOpenAry,this.unlockOpenAry,this.cardInfo.level,this.cardInfo.generation),this.setGroupLvlUp(this.cardInfo),this.refreshUpBtns()}},t.prototype.refreshUpBtns=function(){return this.cardInfo.level>=15||this.cardInfo.generation>=4?(this.btnUserItem.enabled=!1,this.btnGeneUp.enabled=!1,this.btnLvlUp.enabled=!1,void(this.btnUseGeneItem.enabled=!1)):void(5*this.cardInfo.generation<=this.cardInfo.level?(this.btnUserItem.enabled=!1,this.btnGeneUp.enabled=!0,this.btnLvlUp.enabled=!1,this.btnUseGeneItem.enabled=!0):(this.btnUserItem.enabled=!0,this.btnGeneUp.enabled=!1,this.btnLvlUp.enabled=!0,this.btnUseGeneItem.enabled=!1))},t.prototype.setImgEXP=function(e,t){this.imgCurEXP.width=this.imgMaxEXP.width*e/t},t.prototype.setCardSkill=function(e,t,r,a,n){this.groupSkillList.removeChildren();for(var o=0,i=0;4>i;i++){var l={icon:"",rarity:"",canTouch:!0,groupName:"groupSkill_"+i};null!=e[i]&&(l={icon:e[i].iconUrl,rarity:e[i].sklLvl,canTouch:!0,groupName:"groupSkill_"+i});var s=new CardSkillView;if(s.initData(l),this.groupSkillList.addChild(s),this.arrSkillList[i]=s,o>1&&(o-=2),s.x=85*o,s.y=82*Math.floor(i/2),o++,null!=e[i]){var c=this.judjeSkillLock(i,a,n,r);if(0==t[i]){var u=new eui.Image;this.groupSkillList.addChild(u),u.source="newcardpanel_json.suo",u.x=s.x,u.y=s.y,u.touchEnabled=!1;var p=new eui.Label;this.groupSkillList.addChild(p),p.x=s.x+5,p.y=s.y,p.width=s.width-10,p.height=s.height,p.textAlign="center",p.verticalAlign="middle",p.lineSpacing=5,p.fontFamily="SimHei",p.size=18,p.text=c,p.touchEnabled=!1}}else{var h=new eui.Image;this.groupSkillList.addChild(h),h.source="hallText0Sheet_json.jineng0",h.x=s.x,h.y=s.y}}},t.prototype.judjeSkillLock=function(e,t,r,a){var n="";return n=a[e].gen+this.daijTxt+a[e].star+this.xingjTxt+this.jiesuoTxt},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_BaguseUp:var a=t.itemIdx,n=(t.bagId,t.msg);r.bagItemChoose=a,this.upBagInfo["bag"+r.bagItemChoose].shopNum=t.bagNum,this.cardInfo.exp=n.exp,this.upLvlInfo.allexp=t.allexp,this.cardInfo.generation=n.gen,this.cardInfo.level=n.level,this.cardInfo.val_initial=n.valInitial,this.cardInfo.val_growing=n.valGrowing;var o=r.rarityObj.cardDetail,i=o.attribute;i.atk=n.atk,i.hp=n.hp,this.setAttribute(i),this.skillOpenAry=[n.open_1,n.open_2,n.open_3,n.open_4],this.setGroupLvlUp(this.cardInfo),this.setCardView(this.cardInfo),this.setgroupStar(this.cardInfo.level),this.setimgGene(this.cardInfo.generation),this.setCardSkill(this.skillAry,this.skillOpenAry,this.unlockOpenAry,this.cardInfo.level,this.cardInfo.generation);var l=this.curCardView;l.setLevel(this.cardInfo.level),l.setHp(this.cardInfo.hp),l.setAtk(this.cardInfo.atk),l.setGeneration(this.cardInfo.generation),this.refreshUpBtns()}},t.prototype.setAttribute=function(e){var t=e.rarity,r=PublicMethodManager.getInstance().getCardRarity(t),a=e.generation,n=ExternalFun.prototype.levelnumTo5lvl(e.level),o=a+this.daijTxt+n+this.xingjTxt,i=e.atk,l=e.hit,s=e.hp,c=e.agl,u=e.att,p=e.cri_chance,h=e.cri_multiplier,g=e.rgn,d=LanguageManager.getInstance().getCurLanguageType();1==d?this.setGroupAttrList({Quality:r,Lv:o,Power:i+s,Waiting:u,HP:s,Atk:i,Accuracy:l,"Dodge Rate":c,"Crit Rate":p,"Crit Multipler":h,Recovery:g}):this.setGroupAttrList({"品质":r,"星级":o,"战力":i+s,"等待回合":u,"生命":s,"攻击":i,"命中率":l,"闪避率":c,"暴击率":p,"暴击倍数":h,"回复":g})},t.prototype.setCurRightGroupShow=function(e){if(this.curBtnIndex!=e){switch(this.curBtnIndex=e,e){case 1:this.setGroupShow();break;case 2:this.cardFetterInit||this.setGroupFetter();break;case 3:this.setGroupSold()}this.groupAttrList.visible=0==e,this.scrAttrListPanel.visible=0==e,this.scrAttrList.visible=0==e,this.groupShow.visible=1==e,this.groupFetter.visible=2==e,this.scrFetterPanel.visible=2==e,this.scrFetter.visible=2==e,this.groupShopPanel.visible=3==e,this.groupLvlUp.visible=4==e,this.groupGeneUp.visible=5==e,this.groupGeneUpPanel.visible=5==e,this.setImgBtnBg(e)}},t.prototype.setGroupAttrList=function(e){this.cardAttrInit=!0;var t=0;this.cleanArrayLabel(this.arrAttrList),this.cleanArrayShape(this.arrAttrLine);for(var r in e){var a=t%2,n=new eui.Label;n.x=240*a+54,n.y=60*Math.floor(t/2)+42,n.textColor=9159381,n.textAlign="left",n.fontFamily="SimHei",n.size=26,n.text=r+"：",this.groupAttrList.addChild(n);var o=new eui.Label;o.x=230*a+54+n.width,o.y=60*Math.floor(t/2)+42,o.textColor=16777215,o.textAlign="left",o.fontFamily="SimHei",o.size=26,o.stroke=1,o.text=e[r],this.groupAttrList.addChild(o),this.arrAttrList.push(n),this.arrAttrList.push(o),t++}},t.prototype.setGroupShow=function(){this.cardShowInit=!0;var e=this.cardInfo,t=new CardRectangleView;t.initData(e),t.scaleX=this.groupCardShow.width/t.width,t.scaleY=this.groupCardShow.height/t.height,this.groupCardShow.addChild(t),this.groupCardShow.$setVisible(!0),t.x=-8,t.y=0,this.cardRectangleView=t},t.prototype.setGroupFetter=function(){this.cardFetterInit=!0;this.cardInfo;this.scrFetter.scrollPolicyH="OFF",this.cleanArray(this.arrFetterItemView);for(var e=(GlobalDataManager.getInstance().getJiBanData(),this.cardJBInfo),t=0,r=0;r<e.length;r++){var a=e[r],n=new CardFetterItemView,o={hero:this.cardInfo.name,name:a.name,desc:a.desc,icon:a.icon,color:a.color,zc:a.zc};n.initData(o),this.groupFetter.addChild(n),n.width=n.getViewWidth(),n.height=n.getViewHeight(),n.x=22,n.y=t,t=t+n.height+17,this.arrFetterItemView.push(n)}},t.prototype.setGroupLvlUp=function(e){this.lvUp_level.text=this.cardInfo.generation+this.daijTxt+ExternalFun.prototype.levelnumTo5lvl(this.cardInfo.level)+this.xingjTxt,this.labExp.text=this.cardInfo.exp+"/"+this.upLvlInfo.allexp,this.labExp_left.text=this.cardInfo.exp+"/"+this.upLvlInfo.allexp,this.btnUserItem0.imgIcon.source="hallImg1Sheet_json.l2",this.btnUserItem1.imgIcon.source="hallImg1Sheet_json.l8",this.btnUserItem2.imgIcon.source="hallImg1Sheet_json.l1",this.BtnGeneUpItem.imgItem.source="hallImg1Sheet_json.l6";var t=LanguageManager.getInstance().getCurLanguageType();1==t?(this.btnUserItem0.lblName.text="Exp book",this.btnUserItem1.lblName.text="Exp stone",this.btnUserItem2.lblName.text="Exp potions"):(this.btnUserItem0.lblName.text="经验书",this.btnUserItem1.lblName.text="经验石",this.btnUserItem2.lblName.text="经验药水"),null!=this.upBagInfo.bag1&&(this.btnUserItem0.imgIcon.source="hallImg1Sheet_json."+this.upBagInfo.bag1.resUrl,this.btnUserItem0.lblCount.text=this.upBagInfo.bag1.shopNum,this.btnUserItem0.lblName.text=this.upBagInfo.bag1.shopName),null!=this.upBagInfo.bag2&&(this.btnUserItem1.imgIcon.source="hallImg1Sheet_json."+this.upBagInfo.bag2.resUrl,this.btnUserItem1.lblCount.text=this.upBagInfo.bag2.shopNum,this.btnUserItem1.lblName.text=this.upBagInfo.bag2.shopName),null!=this.upBagInfo.bag3&&(this.btnUserItem2.imgIcon.source="hallImg1Sheet_json."+this.upBagInfo.bag3.resUrl,this.btnUserItem2.lblCount.text=this.upBagInfo.bag3.shopNum,this.btnUserItem2.lblName.text=this.upBagInfo.bag3.shopName),null!=this.upBagInfo.bag4&&(this.BtnGeneUpItem.imgItem.source="hallImg1Sheet_json."+this.upBagInfo.bag4.resUrl,this.BtnGeneUpItem.labItemNum.text=this.upBagInfo.bag4.shopNum,this.labGeneUpItem.text=this.upBagInfo.bag4.shopName)},t.prototype.setGroupSold=function(){},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.cardoperationgruop){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.cardoperationgruop.scaleX=r.cardoperationgruop.scaleY=1):void(r.cardoperationgruop.scaleX=r.cardoperationgruop.scaleY=l)}},t.NAME="CardOperationSkin",t}(BaseView);__reflect(CardOperationView.prototype,"CardOperationView");var CardView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrOptionBtn=new Array,r.arrCardItem=new Array,r.arrCardInfo=new Array,r.arrRCardPosX=new Array,r.sortImgText=[["zhanligdd","zhanliddg","gongjigdd","gongjiddg","shengminggdd","shengmingddg","feiyonggdd","feiyongddg"],["quanpinzhi","putong","xiyou","shishi","chuanqi","shenghua"],["quanwuxing","jin","mu","shui","huo","tu"]],r.arrSort1=[],r.arrSort2=[],r.arrSort3=[],r.sortFactor={sort:0,rarity:0,element:0},r.pageNum=1,r.pageSize=20,r.receiveNum=0,r.needUp=!1,r.hIndex=0,r.vIndex=0,r.cardListData=[],r.movingState=!1,r}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.scrCardItem.addEventListener(eui.UIEvent.CHANGE,e.moveHandler,e),e.scrCardItem.addEventListener(eui.UIEvent.CHANGE_END,e.outHandler,e),e.scrCardItem.addEventListener(egret.TouchEvent.TOUCH_CANCEL,e.onCancelHandler,e),e.scrCardItem.addEventListener(egret.TouchEvent.TOUCH_END,e.onEndHandler,e),e.initView(),e.requestCardList()},t.prototype.initView=function(){var e=this;this.pageNum=1,this.needUp=!1,this.receiveNum=0,e.sortFactor.sort=0,e.sortFactor.rarity=0,e.sortFactor.element=0,this.cardListData=[],e.labelObj=LanguageManager.getInstance().getLabelLanguage(this);for(var t=0;20>t;t++)8>t?e.arrSort1.push(e.labelObj["lbl_"+t]):14>t?e.arrSort2.push(e.labelObj["lbl_"+t]):20>t&&e.arrSort3.push(e.labelObj["lbl_"+t]);e.setOptionBtn()},t.prototype.requestCardList=function(){var e=GlobalDataManager.getInstance().getCenterServer(),t=this,r={rarity:t.sortFactor.rarity,element:t.sortFactor.element,sort:t.sortFactor.sort,pageNum:t.pageNum,pageSize:t.pageSize};HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_CardViewLists,r)},t.prototype.onCancelHandler=function(){this.movingState=!0},t.prototype.onEndHandler=function(){this.movingState=!1},t.prototype.sleep=function(){var e=this;for(e.cleanArray(e.arrOptionBtn),e.cleanArray(e.arrCardItem),e.hIndex=0,e.vIndex=0,e.scrCardItem.viewport.scrollH=0,e.scrCardItem.viewport.scrollV=0;0!=e.arrSort1.length;)e.arrSort1.pop();for(;0!=e.arrSort2.length;)e.arrSort2.pop();for(;0!=e.arrSort3.length;)e.arrSort3.pop();e.labelObj=null},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_CardViewLists:var a=t.length;this.receiveNum=a;for(var n=0;a>n;n++){var o=t[n],i=(this.pageNum-1)*this.pageSize+n;r.cardListData[i]=o}r.setCardItemListByData(r.cardListData),a>0&&(this.pageNum=this.pageNum+1),UIManager.getInstance().hideUI(FilterView);break;case HallCmdDef.CMD_GET_CARD_DETAIL:r.showCardDetailViewByData(t)}},t.prototype.showCardDetailViewByData=function(e){var t=e;t.viewhandle=this.curCardView,UIManager.getInstance().showUI(CardOperationView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,e)},t.prototype.touchTap=function(e){var t=this;if(e.target instanceof eui.Button){var r=e.target;if("btnOption_"==r.name.substr(0,10)){var a=r.name.split("_");if(2!=a.length)return;var n=Number(a[1]);if(0==n){var o={desArr:t.arrSort1,cbHandler:Handler.create(t,t.onChooseCardSort1),selIndex:t.sortFactor.sort};UIManager.getInstance().showUI(FilterView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,o)}else if(1==n){var o={desArr:t.arrSort2,cbHandler:Handler.create(t,t.onChooseCardSort2),selIndex:t.sortFactor.rarity};UIManager.getInstance().showUI(FilterView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,o)}else if(2==n){var o={desArr:t.arrSort3,cbHandler:Handler.create(t,t.onChooseCardSort3),selIndex:t.sortFactor.element};UIManager.getInstance().showUI(FilterView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,o)}}else r==t.btnBack&&t.hiden()}else if(e.target instanceof eui.Group){var i=e.target;if("groupCR_"==i.name.substr(0,8)){if(t.movingState)return;var a=i.name.split("_");if(2!=a.length)return;var n=Number(a[1]);t.onClickSCardItem(n)}}},t.prototype.onClickSCardItem=function(e){var t=this.arrCardInfo[e];this.curCardView=this.arrCardItem[e];var r=t.code;this.requestCardDetaiData(r)},t.prototype.requestCardDetaiData=function(e){if(null!=e&&""!=e){var t=GlobalDataManager.getInstance().getCenterServer(),r={code:e};HttpManager.getInstance().send(t.getSname(),HallCmdDef.CMD_GET_CARD_DETAIL,r)}},t.prototype.onChooseCardSort1=function(e){this.onChangeCardSort(1,e)},t.prototype.onChooseCardSort2=function(e){this.onChangeCardSort(2,e)},t.prototype.onChooseCardSort3=function(e){this.onChangeCardSort(3,e)},t.prototype.onChangeCardSort=function(e,t){var r=this;if(null!=r.sortFactor){var a="";a=1==e?"sort":2==e?"rarity":"element";var n=r.sortFactor[a],o=!0;(null==n||n==t)&&(o=!1);var i=this.sortImgText[e-1][t];this.arrOptionBtn[e-1].setBtnImgContent(i),o?(r.sortFactor[a]=t,r.pageNum=1,r.cardListData=[],r.requestCardList()):UIManager.getInstance().hideUI(FilterView)}},t.prototype.moveHandler=function(e){this.scrCardItem.viewport.scrollV>this.scrCardItem.viewport.contentHeight-this.scrCardItem.viewport.height-40&&(this.needUp=!0)},t.prototype.outHandler=function(e){this.receiveNum<this.pageSize&&(this.needUp=!1),this.needUp&&(this.needUp=!1,this.requestCardList())},t.prototype.setOptionBtn=function(){for(var e=this,t=0;t<e.sortImgText.length;t++){var r=new OptionBtnView;r.init(),e.groupOptionBtn.addChild(r),r.setBtnImgContent(e.sortImgText[t][0]),r.setBtnName("btnOption_"+t),r.x=20,e.arrOptionBtn.push(r)}e.updateOptionBtnPos()},t.prototype.updateOptionBtnPos=function(){for(var e=this,t=0,r=0,a=e.arrOptionBtn.length;a>r;r++){var n=e.arrOptionBtn[r];null!=n&&(n.y=t,n.height=n.getViewHeight(),t+=n.getViewHeight()+20)}},t.prototype.removeRCardItem=function(){for(var e=this;e.arrRCardPosX.length;)e.arrRCardPosX.pop();for(;e.arrCardInfo.length;)e.arrCardInfo.pop();e.cleanArray(e.arrCardItem),e.groupCardItem.removeChildren(),e.groupCardItem.scrollV=0,e.hIndex=0,e.vIndex=0},t.prototype.setCardItemListByData=function(e){var t=this;t.pageNum<=1&&t.removeRCardItem();for(var r=5,a=t.scrCardItem.width/r,n=7,o=1,i=t.arrCardItem.length,l=e.length-i,s=0;l>s;s++){var c=i+s,u=e[c];if(null!=u){var p=new CardSquareView,h=this.toFormatObject(u,c);p.initData(h),p.scaleX=p.scaleY=.9,t.groupCardItem.addChild(p);var g=(a+2)*t.hIndex;p.x=g,p.y=t.vIndex*p.height,t.arrCardInfo.push(h),t.arrCardItem.push(p),t.arrRCardPosX.push(g),t.hIndex++,t.hIndex>=r&&(t.hIndex=0,t.vIndex++),o=o>=n?1:++o}}},t.prototype.toFormatObject=function(e,t){var r={icon:e.iconUrl,rarity:e.rarity,element:e.ele,round:e.round,generation:e.gen,name:e.name,cost:e.cst,level:(e.level-1)%5+1,atk:e.atk,hp:e.hp,agl:e.agl,hit:e.hit,att:e.att,code:e.code,cri_chance:1,cri_multiplier:1,rgn:e.rgn,jblist:1,groupName:"groupCR_"+t,canTouch:!0};return r},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.cardskingroup){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.cardskingroup.scaleX=r.cardskingroup.scaleY=1):void(r.cardskingroup.scaleX=r.cardskingroup.scaleY=l)}},t.NAME="CardSkin",t}(BaseView);__reflect(CardView.prototype,"CardView");var CombatRecordView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrRecordBtn=new Array,r.arrCardHeadView=new Array,r.arrCardFetters=new Array,r.arrCircle=new Array,r.needUp=!1,r.mallName=[],r.jbList=[],r.pageId=0,r.pageSize=8,r.duizhanTxt="对战ID:",r}return __extends(t,e),t.prototype.week=function(){var e=this,t=LanguageManager.getInstance().getCurLanguageType();1==t&&(e.duizhanTxt="Combat ID:"),e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.scrRecordBtn.addEventListener(eui.UIEvent.CHANGE,e.moveHandler,e),e.scrRecordBtn.addEventListener(eui.UIEvent.CHANGE_END,e.outHandler,e),e.initView(!1),e.sendGetRecordList()},t.prototype.initView=function(e){this.groupDetails.$setVisible(e),ExternalFun.prototype.setImgGray(this.imgRightHead),ExternalFun.prototype.setImgGray(this.rightFrame)},t.prototype.sendGetRecordList=function(){var e=GlobalDataManager.getInstance().getAccountData(),t=e.uname,r={ratity:t,pageid:1,pageSize:8},a=GlobalDataManager.getInstance().getCenterServer();
HttpManager.getInstance().send(a.getSname(),HallCmdDef.CMD_Record,r,!0)},t.prototype.sleep=function(){this.cleanArray(this.arrRecordBtn),this.cleanRecord()},t.prototype.cleanRecord=function(){this.cleanArray(this.arrCardHeadView),this.cleanArrayLabel(this.arrCardFetters),this.cleanArrayShape(this.arrCircle)},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.cleanArrayLabel=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.cleanArrayShape=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_Record:r.pageId=parseInt(t.pageId);for(var a=t.msg.length,n=0;a>n;n++){var o=t.msg[n];r.mallName[n+(r.pageId-1)*this.pageSize]=o}for(var i=t.jbconfig.length,n=0;i>n;n++){var o=t.jbconfig[n],l=t.jbconfig[n].code;r.jbList[l]=o}a>0&&(r.initView(!0),this.setRecordBtn(),r.setDetails(0))}},t.prototype.touchTap=function(e){var t=this;if(e.target instanceof eui.Button){var r=e.target;if("btnRecord_"==r.name.substr(0,10)){var a=r.name.split("_");if(2!=a.length)return;var n=Number(a[1]);t.setCurChooseOptionBtnByIndex(n),t.cleanRecord(),t.setDetails(n)}else r==t.btnBack&&t.hiden()}},t.prototype.moveHandler=function(e){this.scrRecordBtn.viewport.scrollV>this.scrRecordBtn.viewport.contentHeight-this.scrRecordBtn.viewport.height-40&&(this.needUp=!0)},t.prototype.outHandler=function(e){if(this.needUp){this.needUp=!1;var t=GlobalDataManager.getInstance().getAccountData(),r=t.uname,a={ratity:r,pageid:this.pageId+1,pageSize:this.pageSize},n=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(n.getSname(),HallCmdDef.CMD_Record,a,!1)}},t.prototype.addRecord=function(){this.setRecordBtn()},t.prototype.getDate=function(e){var t=e,r=t.split(" "),a=r[0].split("-"),n=r[1].split(":"),o=new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]),parseInt(n[0]),parseInt(n[1]),parseInt(n[2]));return o},t.prototype.setRecordBtn=function(){for(var e=this,t=e.mallName.length,r=e.arrRecordBtn.length,a=GlobalDataManager.getInstance().getAccountData(),n=0;t-r>n;n++){var o=new RecordBtnView;o.init(),e.groupRecordBtn.addChild(o);var i=e.mallName[n].createDate,l=new Date(i),s=ExternalFun.prototype.add0(l.getMinutes().toString(),2),c=ExternalFun.prototype.add0(l.getHours().toString(),2),u=ExternalFun.prototype.add0(l.getMonth()+1,2),p=ExternalFun.prototype.add0(l.getDate(),2);o.setBtnTmContent1(c+":"+s),o.setBtnTmContent(u+"-"+p);var h=e.mallName[n+r].winName;a.getNick()==h?(o.setBtnRewardImg(1),o.setBtnScoreContent("+"+e.mallName[n+r].resultNum)):(o.setBtnRewardImg(0),o.setBtnScoreContent("-"+e.mallName[n+r].resultNumlost)),o.setBtnName("btnRecord_"+(n+r)),o.x=10,o.width=o.getViewWidth(),o.height=o.getViewHeight(),o.y=o.getViewHeight()*n,e.arrRecordBtn.push(o)}e.updateOptionBtnPos(),e.setCurChooseOptionBtnByIndex(0)},t.prototype.setCurChooseOptionBtnByIndex=function(e){var t=this,r=null;if(null!=t.curChooseRecordBtnIndex&&-1!=t.curChooseRecordBtnIndex){if(r=t.getOptionBtnViewByIndex(t.curChooseRecordBtnIndex),null==r)return;if(r.setCurChoose(),t.curChooseRecordBtnIndex==e)return void(t.curChooseRecordBtnIndex=-1)}t.curChooseRecordBtnIndex=e,r=t.getOptionBtnViewByIndex(e),null!=r&&(r.setCurChoose(1),t.updateOptionBtnPos())},t.prototype.getOptionBtnViewByIndex=function(e){for(var t=null,r=this,a=0,n=r.arrRecordBtn.length;n>a;a++){var o=r.arrRecordBtn[a];if(null!=o){var i=o.getBtnName(),l=i.split("_");if(2==l.length){var s=Number(l[1]);if(e==s){t=o;break}}}}return t},t.prototype.updateOptionBtnPos=function(){for(var e=this,t=0,r=0,a=e.arrRecordBtn.length;a>r;r++){var n=e.arrRecordBtn[r];null!=n&&(n.y=t+5,t+=n.getViewHeight()+22)}},t.prototype.setCombatResult=function(e){if(0==e){var t=new egret.Shape;this.groupLeftHeadFrame.addChild(t);var r=new egret.Shape;this.groupRightHeadFrame.addChild(r)}else{var t=new egret.Shape;this.groupLeftHeadFrame.addChild(t);var r=new egret.Shape;this.groupRightHeadFrame.addChild(r)}},t.prototype.setLeftName=function(e){this.labLeftName.text=e},t.prototype.setRightName=function(e){this.labRightName.text=e},t.prototype.setLeftHead=function(e){""==e&&(e="headicon_json.head_01"),this.imgLeftHead.source=e},t.prototype.setRightHead=function(e){""==e&&(e="headicon_json.head_01"),this.imgRightHead.source=e},t.prototype.setLeftCombat=function(e){this.labLeftCombat.text=""+e},t.prototype.setRightCombat=function(e){this.labRightCombat.text=""+e},t.prototype.setRecordId=function(e){this.labRecordId.text=this.duizhanTxt+e},t.prototype.setLeftFetters=function(e){for(var t=0;t<e.length;t++){var r=new eui.Label;this.groupleftFetters.addChild(r),r.text=e[t],r.x=0,r.y=25*t,r.width=420,r.height=25,r.textAlign="left",r.verticalAlign="middle",r.size=20,r.fontFamily="SimHei",this.arrCardFetters.push(r)}},t.prototype.setRightFetters=function(e){for(var t=0;t<e.length;t++){var r=new eui.Label;this.groupRightFetters.addChild(r),r.text=e[t],r.x=0,r.y=25*t,r.width=420,r.height=25,r.textAlign="left",r.verticalAlign="middle",r.size=20,r.fontFamily="SimHei",this.arrCardFetters.push(r)}},t.prototype.setLeftCardHeads=function(e){for(var t=this.mallName[e].winCards,r=t.split("|"),a=r.length,n=0;a>n;n++){var t=r[n],o=t.split(","),i={icon:o[0],name:o[1],rarity:o[2],element:o[3],generation:o[4],level:ExternalFun.prototype.levelnumTo5lvl(parseInt(o[5])),combat:o[6]},l=new CardHeadView;l.initData(i),this.groupLeftCardHeads.addChild(l),this.arrCardHeadView.push(l),5>n?(l.x=n*this.groupLeftCardHeads.width/5,l.y=0):(l.x=(n-5)*this.groupLeftCardHeads.width/5,l.y=160)}},t.prototype.setRightCardHeads=function(e){for(var t=this.mallName[e].loseCards,r=t.split("|"),a=r.length,n=0;a>n;n++){var t=r[n],o=t.split(","),i={icon:o[0],name:o[1],rarity:o[2],element:o[3],generation:o[4],level:ExternalFun.prototype.levelnumTo5lvl(parseInt(o[5])),combat:o[6]},l=new CardHeadView;l.initData(i),l.setGrayHead(),this.groupRightCardHeads.addChild(l),this.arrCardHeadView.push(l),5>n?(l.x=n*this.groupRightCardHeads.width/5,l.y=0):(l.x=(n-5)*this.groupRightCardHeads.width/5,l.y=160)}},t.prototype.setDetails=function(e){var t=this,r=e;t.setLeftName(t.mallName[r].winName),t.setRightName(t.mallName[r].loseName),t.setLeftHead(t.mallName[r].winIcon),t.setRightHead(t.mallName[r].loseIcon),t.setLeftCombat(t.mallName[r].winCap),t.setRightCombat(t.mallName[r].loseCap),t.setRecordId(t.mallName[r].settId),t.setLeftCardHeads(r),t.setRightCardHeads(r);for(var a=t.mallName[r].winJbid,n=a.split("|"),o=[],i=0;i<n.length;i++){var l="0";""!=n[i]&&(l=n[i],o.push(t.jbList[l].name))}o.length>0&&t.setLeftFetters(o),n=[],o=[];var s=t.mallName[r].loseJbid;n=s.split("|");for(var i=0;i<n.length;i++){var l="0";""!=n[i]&&(l=n[i],o.push(t.jbList[l].name))}o.length>0&&t.setRightFetters(o)},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.recordskingroup){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.recordskingroup.scaleX=r.recordskingroup.scaleY=1):void(r.recordskingroup.scaleX=r.recordskingroup.scaleY=l)}},t.NAME="CombatRecordSkin",t}(BaseView);__reflect(CombatRecordView.prototype,"CombatRecordView");var FettersView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrCardFetters=new Array,r.movingState=!1,r.fettersDataList=new Array,r.zcTxt="组成: ",r.xgTxt="效果: ",r.errorTxt="暂无数据",r}return __extends(t,e),t.prototype.week=function(){var e=this;this.infoPanel.visible=!1;var t=LanguageManager.getInstance().getCurLanguageType();1==t&&(e.zcTxt="Formation: ",e.xgTxt="Effects: ",e.errorTxt="Temporarily no data"),e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.hasEventListener(egret.TouchEvent.TOUCH_BEGIN)||e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.touchBegin,e),e.hasEventListener(egret.TouchEvent.TOUCH_END)||e.addEventListener(egret.TouchEvent.TOUCH_END,e.touchEnd,e),e.scrCardItem.addEventListener(egret.TouchEvent.TOUCH_CANCEL,e.onCancelHandler,e),e.scrCardItem.addEventListener(egret.TouchEvent.TOUCH_END,e.onEndHandler,e),e.requestInitDataFromSvr()},t.prototype.requestInitDataFromSvr=function(){var e=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_GET_FETTERS_CONFIG,{},!0)},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_GET_FETTERS_CONFIG:for(var a=t.length,n=0;a>n;n++){var o=t[n],i=o.fetId;this.fettersDataList[i-1]=o}r.setFettersViewByData()}},t.prototype.sleep=function(){this.cleanArray(this.arrCardFetters)},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.onCancelHandler=function(){this.movingState=!0},t.prototype.onEndHandler=function(){this.movingState=!1},t.prototype.touchTap=function(e){var t=this,r=e.target;if("groupPI_"==r.name.substr(0,8)){if(t.movingState)return;var a=r.name.split("_"),n=Number(a[1]);this.setFetterInfoPanelByIdx(n)}},t.prototype.setFettersViewByData=function(){for(var e=this,t=6,r=e.scrCardItem.width/t,a=(e.scrCardItem.height/4,0),n=0,n=0,o=this.fettersDataList.length,i=0;o>i;i++){var l=this.fettersDataList[i],s=("jibanshuoming_json.djb"+ExternalFun.prototype.add0(i+1,2),{icon:l.icon,color:l.color,visible:o>i,name:l.name}),c=new FetterItemView;c.initData(s),e.groupCardItem.addChild(c);var u=1;c.scaleX=c.scaleY=u,c.x=n*(r-4)+32,c.y=a*(c.getViewHeight()+32)+2,c.width=c.getViewWidth(),c.height=c.getViewHeight(),e.arrCardFetters.push(c),c.setGroupName("groupPI_"+(i+1)),n++,n>=t&&(n=0,a++)}},t.prototype.touchEnd=function(e){var t=this,r=e.target;if(r instanceof eui.Button)if(r==t.PanelButton)this.setFetterInfoPanelByIdx(0);else{var a=Number(r.name);this.setFetterInfoPanelByIdx(a)}},t.prototype.setFetterInfoPanelByIdx=function(e){if(0>=e)return void(this.infoPanel.visible=!1);this.infoPanel.visible=!0;var t=this.fettersDataList.length;if(t>=e){"jibanshuoming_json.djb"+ExternalFun.prototype.add0(e,2);this.imgItem.source=this.fettersDataList[e-1].icon,this.labItemName.text=this.fettersDataList[e-1].name;var r="jibanshuoming_json.jb"+this.fettersDataList[e-1].color+"_0";this.bgClr.source=r,this.xiaoguo1.textFlow=[{text:this.xgTxt,style:{size:26,textColor:9159381}},{text:this.fettersDataList[e-1].fetDesc,style:{size:26,textColor:14803425}}],this.jiban1.textFlow=[{text:this.zcTxt,style:{size:26,textColor:9159381}},{text:this.fettersDataList[e-1].fetZc,style:{size:26,textColor:14803425}}]}else this.xiaoguo1.text=this.errorTxt,this.jiban1.text=this.errorTxt},t.prototype.touchBegin=function(e){var t=this,r=e.target;r instanceof eui.Button&&r==t.btnBack&&t.hiden()},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.jibanskingruop){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.jibanskingruop.scaleX=r.jibanskingruop.scaleY=1):void(r.jibanskingruop.scaleX=r.jibanskingruop.scaleY=l)}},t.NAME="JiBanSkin",t}(BaseView);__reflect(FettersView.prototype,"FettersView");var InfoItemView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.huodongTxt="【活动】",r.xiongTxt="【系统】",r}return __extends(t,e),t.prototype.week=function(){var t=this,r=LanguageManager.getInstance().getCurLanguageType();1==r&&(t.huodongTxt="[Activity]",t.xiongTxt="[System]");var a=e.prototype.getData.call(this);if(null!=a){var n=a.tittle,o=a.issys,i=a.disc;1==r&&(n=a.tittleEn,i=a.discEn),t.setName(n,o),t.setDisc(i);var l=a.ispoint;t.setInfoPoint(l)}},t.prototype.sleep=function(){},t.prototype.setInfoIcon=function(e){0==e?this.imgSys.source="hallText0Sheet_json.hd":this.imgSys.source="hallText0Sheet_json.xitong2"},t.prototype.setInfoPoint=function(e){0==e?this.imgPoint.$setVisible(!1):this.imgPoint.$setVisible(!0)},t.prototype.setDisc=function(e){this.labInfoDesc.text=e},t.prototype.setName=function(e,t){0==t?(this.labInfoName.text=this.huodongTxt+e,this.labInfoName.textColor=7334399):(this.labInfoName.text=this.xiongTxt+e,this.labInfoName.textColor=16766826)},t.prototype.setGroupName=function(e){this.groupPI.name=e},t.prototype.getViewWidth=function(){return this.groupPI.width},t.prototype.getViewHeight=function(){return this.groupPI.height},t.NAME="InfoItemSkin",t}(BaseView);__reflect(InfoItemView.prototype,"InfoItemView");var OptionBtnItemView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.curChooseState=0,r}return __extends(t,e),t.prototype.week=function(){var e=this;e.lblDesNColor=10252099,e.lblDesStrokeNColor=1250075,e.lblDesCColor=15334655,e.lblDesStrokeCColor=12122111,e.setCurChoose()},t.prototype.sleep=function(){},t.prototype.getViewWidth=function(){return this.groupOIB.width},t.prototype.getViewHeight=function(){return this.groupOIB.height},t.prototype.setBtnContent=function(e){this.lblDes.text=e},t.prototype.getBtnContent=function(){return this.lblDes.text},t.prototype.setBtnName=function(e){this.btnOptionItem.name=e},t.prototype.getBtnName=function(){return this.btnOptionItem.name},t.prototype.setCurChoose=function(e,t){void 0===e&&(e=0),void 0===t&&(t=!1);var r=this;r.curChooseState!=e&&(r.curChooseState=e,t&&(r.btnOptionItem.touchEnabled=0==e),r.imgChooseState.visible=1==e,r.lblDes.textColor=0==e?r.lblDesNColor:r.lblDesCColor,r.lblDes.strokeColor=0==e?r.lblDesStrokeNColor:r.lblDesStrokeCColor)},t.prototype.getCurChooseState=function(){return this.curChooseState},t.NAME="OptionBtnItemSkin",t}(BaseView);__reflect(OptionBtnItemView.prototype,"OptionBtnItemView");var OptionBtnView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.imgLabelStr="",r.curChooseState=0,r.arrOptionBtnItem=new Array,r.ItemGroupHeight=0,r}return __extends(t,e),t.prototype.week=function(){var e=this;e.lblDesNColor=12300217,e.lblDesStrokeNColor=1250075,e.lblDesCColor=16776417,e.lblDesStrokeCColor=16763174,e.setCurChoose()},t.prototype.sleep=function(){var e=this;e.cleanArray(e.arrOptionBtnItem)},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.getViewWidth=function(){return this.groupOB.width},t.prototype.getViewHeight=function(){var e=this,t=e.groupOB.height;return t},t.prototype.setBtnImgContent=function(e){this.lblDes.$setVisible(!1),this.imgLabel.$setVisible(!0),this.imgLabelStr=e,this.imgLabel.source="hallText0Sheet_json."+this.imgLabelStr+"00"},t.prototype.setChooseState=function(){var e=this.btnOption.getChildAt(0),t=this.btnOption.skin.states,r=t[1].overrides[0];e.source=r.value},t.prototype.getBtnContent=function(){return this.lblDes.text},t.prototype.setBtnName=function(e){this.btnOption.name=e},t.prototype.getBtnName=function(){return this.btnOption.name},t.prototype.setItemGroupHeight=function(e){this.ItemGroupHeight=e},t.prototype.setCurChoose=function(e,t){void 0===e&&(e=0),void 0===t&&(t=!1);var r=this;if(r.curChooseState!=e){if(r.curChooseState=e,r.lblDes.textColor=0==e?r.lblDesNColor:r.lblDesCColor,r.lblDes.strokeColor=0==e?r.lblDesStrokeNColor:r.lblDesStrokeCColor,""!=this.imgLabelStr){var a="";a=0==e?this.imgLabelStr+"00":this.imgLabelStr+"01",this.imgLabel.source="hallText0Sheet_json."+a}if(t&&(r.btnOption.touchEnabled=0==e),r.imgChooseState.visible=1==e,0==e&&null!=r.curChooseOptionBtnItemIndex){var n=r.getOptionBtnItemViewByIndex(r.curChooseOptionBtnItemIndex);if(null==n)return;n.setCurChoose(),r.curChooseOptionBtnItemIndex=-1}}},t.prototype.getCurChooseState=function(){return this.curChooseState},t.prototype.getCurChooseOptionBtnItemIndex=function(){return this.curChooseOptionBtnItemIndex},t.prototype.addItem=function(e){var t=this;t.arrOptionBtnItem.push(e),t.groupItem.addChild(e)},t.prototype.setItemChooseState=function(e,t){void 0===t&&(t=!1);var r=this,a=null;if(null!=r.curChooseOptionBtnItemIndex&&-1!=r.curChooseOptionBtnItemIndex){if(a=r.getOptionBtnItemViewByIndex(r.curChooseOptionBtnItemIndex),null==a)return;if(a.setCurChoose(0,t),r.curChooseOptionBtnItemIndex==e)return void(r.curChooseOptionBtnItemIndex=-1)}r.curChooseOptionBtnItemIndex=e,a=r.getOptionBtnItemViewByIndex(e),null!=a&&a.setCurChoose(1,t)},t.prototype.getOptionBtnItemViewByIndex=function(e){var t=this;if(0>e||e>=t.arrOptionBtnItem.length)return null;for(var r=null,a=0,n=t.arrOptionBtnItem.length;n>a;a++){var o=t.arrOptionBtnItem[a];if(null!=o){var i=o.getBtnName(),l=i.split("_");if(3==l.length){var s=Number(l[2]);if(e==s){r=o;break}}}}return r},t.prototype.hiddenGroupItem=function(){this.groupItem.height=0,this.groupItem.visible=!1},t.prototype.showGroupItem=function(){this.groupItem.height=this.ItemGroupHeight,this.groupItem.visible=!0},t.prototype.setBtnOptionEnable=function(e){this.btnOption.enabled=e},t.NAME="OptionBtnSkin",t}(BaseView);__reflect(OptionBtnView.prototype,"OptionBtnView");var RecordBtnView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.curChooseState=0,r}return __extends(t,e),t.prototype.week=function(){var e=this;e.labTmNColor=16777215,e.labTmCColor=16777215,e.labScoreNColor=16777215,e.labScoreCColor=16770152,e.setCurChoose()},t.prototype.sleep=function(){},t.prototype.getViewWidth=function(){return this.groupOB.width},t.prototype.getViewHeight=function(){var e=this,t=e.groupOB.height;return t},t.prototype.setBtnTmContent=function(e){this.labTm.text=e},t.prototype.setBtnTmContent1=function(e){this.labTm0.text=e},t.prototype.getBtnTmContent=function(){return this.labTm.text},t.prototype.setBtnScoreContent=function(e){this.labScore.text=e},t.prototype.getBtnScoreContent=function(){return this.labScore.text},t.prototype.setBtnRewardImg=function(e){1==e?this.imgReward.source="hallImg0Sheet_json.a36x36":this.imgReward.source="combatRecordSheet_json.exp"},t.prototype.setBtnName=function(e){this.btnRecord.name=e},t.prototype.getBtnName=function(){return this.btnRecord.name},t.prototype.setCurChoose=function(e,t){void 0===e&&(e=0),void 0===t&&(t=!1);var r=this;r.curChooseState!=e&&(r.curChooseState=e,r.labTm.textColor=0==e?r.labTmNColor:r.labTmCColor,r.labScore.textColor=0==e?r.labScoreNColor:r.labScoreCColor,t&&(r.btnRecord.touchEnabled=0==e),r.imgChooseState.visible=1==e)},t.prototype.getCurChooseState=function(){return this.curChooseState},t.NAME="RecordBtnViewSkin",t}(BaseView);__reflect(RecordBtnView.prototype,"RecordBtnView");var SelectHeadView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.func=null,r.hIndex=0,r.vIndex=0,r.arrPropItem=new Array,r.selectHeadStr="",r}return __extends(t,e),t.prototype.week=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t);var r=e.prototype.getData.call(this);if(null!=r){r.name;this.func=r.fun,this.selectHeadStr=r.iconUrl,this.initView()}},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.setLight=function(e){for(var t=this.arrPropItem.length;t>=0;t--){var r=this.arrPropItem[t-1];null!=r&&(t==e?r.setBeenSelect(!0):r.setBeenSelect(!1))}},t.prototype.initView=function(){for(var e=this,t=5,r=e.scrPropItem.width/t,a=46,n=0,o=0,i=1;a>i;i++){var l=new HeadItemView,s="headicon_json.head_"+ExternalFun.prototype.add0(i,2),c={icon:s,name:"a",num:0};l.initData(c),e.groupPropItem.addChild(l),l.x=n*(r-6)+20,l.y=o*(l.getViewHeight()+12),l.width=l.getViewWidth(),l.height=l.getViewHeight(),l.setGroupName("groupPI_"+i),e.arrPropItem.push(l),n++,n>=t&&(n=0,o++)}},t.prototype.sleep=function(){this.cleanArray(this.arrPropItem),this.scrPropItem.viewport.scrollV=0,this.scrPropItem.viewport.scrollH=0},t.prototype.touchTap=function(e){var t=this,r=e.target;if(r instanceof eui.Button)r==t.btnConfirm?(t.hiden(),null!=this.func&&this.func(this.selectHeadStr)):r==t.btnCancel&&(t.hiden(),console.log("取消被按下"));else if(r instanceof eui.Rect)r==t.rectBG&&t.hiden();else if(e.target instanceof eui.Group){var a=e.target;if("groupPI_"==a.name.substr(0,8)){var n=a.name.split("_");if(2!=n.length)return;var o=Number(n[1]);this.selectHeadStr="headicon_json.head_"+ExternalFun.prototype.add0(o,2),this.setLight(o)}}},t.NAME="SelectHeadSkin",t}(BaseView);__reflect(SelectHeadView.prototype,"SelectHeadView");var SetView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.discDataist=new Array,r.iconUrl="",r.nickTxt="昵称：",r}return __extends(t,e),t.prototype.week=function(){var e=this,t=LanguageManager.getInstance().getCurLanguageType();1==t&&(e.nickTxt="Name:"),e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.InitView(),e.requestInitDataFromSvr()},t.prototype.InitView=function(){var e=this,t=GlobalDataManager.getInstance().getAccountData();e.useridtxt.text="ID: "+t.uname,e.nicknametxt.text=e.nickTxt+t.nick;var r=t.getHead_Url();this.setHeadIcon(r,!1),e.SwitchSound.selected=!0,"off"==localStorage.getItem("soundSet")&&(e.SwitchSound.selected=!1),e.SwitchMusic.selected=!0,"off"==localStorage.getItem("musicSet")&&(e.SwitchMusic.selected=!1),e.freshMusicSet(),e.freshSoundSet(),e.versiontxt.text="Version:"+Main.ver},t.prototype.setHeadIcon=function(e,t){this.iconUrl=e,this.headImg.source=this.iconUrl,1==t&&this.requestSetHeadToSvr(this.headImg.source)},t.prototype.requestSetHeadToSvr=function(e){if(""!=e){var t=new Object;t.headurl=e;var r=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(r.getSname(),HallCmdDef.CMD_SetHead,t,!0)}},t.prototype.requestInitDataFromSvr=function(){var e=new Object;e.param="设置";var t=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(t.getSname(),HallCmdDef.CMD_SetConfig,e,!0)},t.prototype.recvData=function(e,t){switch(e){case HallCmdDef.CMD_SetConfig:for(var r=t.length,a=0;r>a;a++){var n=t[a];this.discDataist[n.position]=n}this.setViewByData();break;case HallCmdDef.CMD_SetHead:var o=t.msg,i=GlobalDataManager.getInstance().getAccountData();i.setHead_Url(o),this.setHeadIcon(o,!1)}},t.prototype.setViewByData=function(){this.kefuwxLabel.text=this.discDataist[1].tittle+this.discDataist[1].disc,this.kefuqqLabel.text=this.discDataist[2].tittle+this.discDataist[2].disc,this.label1.text=this.discDataist[3].tittle+this.discDataist[3].disc,this.label2.text=this.discDataist[4].tittle+this.discDataist[4].disc,this.label3.text=this.discDataist[5].tittle+this.discDataist[5].disc},t.prototype.sleep=function(){},t.prototype.freshSoundSet=function(){1==this.SwitchSound.selected?(this.soundtxt.textColor=16777215,localStorage.setItem("soundSet","on"),this.soundImg.source="hallText0Sheet_json.sy00"):(this.soundtxt.textColor=6158955,localStorage.setItem("soundSet","off"),this.soundImg.source="hallText0Sheet_json.sy01")},t.prototype.freshMusicSet=function(){1==this.SwitchMusic.selected?(this.musictxt.textColor=16777215,localStorage.setItem("musicSet","on"),this.musicImg.source="hallText0Sheet_json.yy00"):(this.musictxt.textColor=6158955,localStorage.setItem("musicSet","off"),this.musicImg.source="hallText0Sheet_json.yy01")},t.prototype.touchTap=function(e){var t=this,r=e.target;if(r instanceof eui.Button)if(r==t.btnBack)t.hiden();else if(r==t.BtnZhuXiao)PublicMethodManager.getInstance().loginOut();else if(r==t.changeIconBtn){var a=function(e){t.setHeadIcon(e,!0)},n={iconUrl:this.iconUrl,fun:a};UIManager.getInstance().showUI(SelectHeadView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,n)}else r==t.SwitchMusic?(console.log("背景音乐开关："+t.SwitchMusic.selected),this.freshMusicSet()):r==t.SwitchSound?(console.log("音效开关："+t.SwitchSound.selected),this.freshSoundSet()):r==t.SwitchNotify&&console.log("通知开关："+t.SwitchNotify.selected)},t.NAME="SetSkin",t}(BaseView);__reflect(SetView.prototype,"SetView");var CardGroupSetView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrCardFetters=new Array,r.arrSCardItem=new Array,r.arrRCardItem=new Array,r.bRCardScale=.5,r.cRCardScale=.35,r.onChangeStart=!1,r.arrRCardPosX=new Array,r.arrSort1=[],r.arrSort2=[],r.arrSort3=[],r.arrSortBtn1=["zhanligd_0","zhanlidg_0","gongjigd_0","gongjidg_0","smgd_0","smdg_0","fydg_0","fygd_0"],r.arrSortBtn2=["qpz_0","pt_0","xy_0","ss_0","cq_0","sh_0"],r.arrSortBtn3=["qwx_0","j_0","mu_0","s_0","h_0","t_0"],r.sortFactor={sort:0,rarity:0,element:0},r.pageNum=1,r.pageSize=10,r.cardCostStr="",r.movingState=!1,r}return __extends(t,e),t.prototype.week=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t),t.scrCCardItem.addEventListener(eui.UIEvent.CHANGE_START,t.onChangeStartHandler,t),t.scrCCardItem.addEventListener(egret.Event.CHANGE,t.onChangeHanlder,t),t.scrCCardItem.addEventListener(eui.UIEvent.CHANGE_END,t.onChangeEndHandler,t),t.scrCCardItem.addEventListener(egret.TouchEvent.TOUCH_CANCEL,t.onCancelHandler,t),t.scrCCardItem.addEventListener(egret.TouchEvent.TOUCH_END,t.onEndHandler,t),t.labelObj=LanguageManager.getInstance().getLabelLanguage(this),t.initView(),t.sendGetCardList();var r=e.prototype.getData.call(this);if(null!=r){var a=r.arrTeamConfig;t.initTeamConfig(a);var n=r.teamData;if(t.setTeamItem(n),null!=n){var o=n.name;t.setCardGroupName(o)}t.callBackUpdateTeam=r.cbUpdateTeam}},t.prototype.initView=function(){var e=this;e.pageNum=1,e.btnDetails.visible=!1,e.curChooseRCardIndex=-1;for(var t=0;20>t;t++)8>t?e.arrSort1.push(e.labelObj["lbl_"+t]):14>t?e.arrSort2.push(e.labelObj["lbl_"+t]):20>t&&e.arrSort3.push(e.labelObj["lbl_"+t]);e.lblCCost.text="0/0",e.lblCHp.text="0",e.lblCAtk.text="0",e.lblCCapacity.text="0",e.lblCEle.text="",e.lblCFetters.text="",e.changeBtnImage(e.btnSort,e.arrSortBtn1[e.sortFactor.sort]),e.changeBtnImage(e.btnQuality,e.arrSortBtn2[e.sortFactor.rarity]),e.changeBtnImage(e.btnElements,e.arrSortBtn3[e.sortFactor.element]),e.removeRCardItem(),e.setUserInfo()},t.prototype.sleep=function(){var e=this;for(e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.scrCCardItem.removeEventListener(eui.UIEvent.CHANGE_START,e.onChangeStartHandler,e),e.scrCCardItem.removeEventListener(egret.Event.CHANGE,e.onChangeHanlder,e),e.scrCCardItem.removeEventListener(eui.UIEvent.CHANGE_END,e.onChangeEndHandler,e),e.scrCCardItem.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,e.onCancelHandler,e),e.scrCCardItem.removeEventListener(egret.TouchEvent.TOUCH_END,e.onEndHandler,e);0!=e.arrSort1.length;)e.arrSort1.pop();for(;0!=e.arrSort2.length;)e.arrSort2.pop();for(;0!=e.arrSort3.length;)e.arrSort3.pop();for(e.labelObj=null,null!=e.cCardScrViewGroup&&(e.cCardScrViewGroup.parent.removeChild(e.cCardScrViewGroup),e.cCardScrViewGroup=null),e.cleanArray(e.arrSCardItem),e.cleanArray(e.arrCardFetters),e.cleanArray(e.arrRCardItem);e.arrRCardPosX.length;)e.arrRCardPosX.pop()},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.touchTap=function(e){var t=this;if(e.target instanceof eui.Button){var r=e.target;if(r==t.btnSort){var a={desArr:t.arrSort1,cbHandler:Handler.create(t,t.onChooseCardSort1),selIndex:t.sortFactor.sort};UIManager.getInstance().showUI(FilterView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,a)}else if(r==t.btnQuality){var a={desArr:t.arrSort2,cbHandler:Handler.create(t,t.onChooseCardSort2),selIndex:t.sortFactor.rarity};UIManager.getInstance().showUI(FilterView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,a)}else if(r==t.btnElements){var a={desArr:t.arrSort3,cbHandler:Handler.create(t,t.onChooseCardSort3),selIndex:t.sortFactor.element};UIManager.getInstance().showUI(FilterView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,a)}else if(r==t.btnSave)t.sendSaveTeam();else if(r==t.btnBack)t.hiden();else if(r==t.btnDetails&&-1!=t.curChooseRCardIndex){var n=t.arrRCardItem[t.curChooseRCardIndex],o=n.getData();if(null==o)return;var i=o.code;null!=i&&t.showCardDetailView(i)}}else if(e.target instanceof eui.Group){var l=e.target;if("groupCR_"==l.name.substr(0,8)){if(t.movingState)return;var s=l.name.split("_");if(2!=s.length)return;var c=Number(s[1]);t.onClickRCardItem(c)}else if("groupCGSCI_"==l.name.substr(0,11)){var s=l.name.split("_");if(2!=s.length)return;var c=Number(s[1]);t.onClickSCardItem(c)}}},t.prototype.onClickRCardItem=function(e){var t=this;if(t.curChooseRCardIndex!=e)return void t.scrollToItem(e);var r=t.arrRCardItem[e];if(null!=r){var a=r.getData();if(null!=a&&null!=a.code){var n=a.code,o=t.getSCardItemIndex(n);if(-1!=o)t.onRemoveSCardItem(o);else{for(var i=0,l=t.arrSCardItem.length;l>i;i++){var s=t.arrSCardItem[i];if(null!=s&&1==s.getType()){o=i;break}}-1!=o&&(t.setSCardItem(o,a),t.updateBCardSelShow(),t.updateCardGroupAttribute())}}}},t.prototype.onChangeCardSort=function(e,t){var r=this;if(null!=r.sortFactor){var a="";a=1==e?"sort":2==e?"rarity":"element";var n=r.sortFactor[a],o=!0;(null==n||n==t)&&(o=!1),o?(r.sortFactor[a]=t,r.pageNum=1,r.sendGetCardList(),r.changeBtnImage(r.btnSort,r.arrSortBtn1[r.sortFactor.sort]),r.changeBtnImage(r.btnQuality,r.arrSortBtn2[r.sortFactor.rarity]),r.changeBtnImage(r.btnElements,r.arrSortBtn3[r.sortFactor.element])):UIManager.getInstance().hideUI(FilterView)}},t.prototype.onChooseCardSort1=function(e){this.onChangeCardSort(1,e)},t.prototype.onChooseCardSort2=function(e){this.onChangeCardSort(2,e)},t.prototype.onChooseCardSort3=function(e){this.onChangeCardSort(3,e)},t.prototype.onClickSCardItem=function(e){var t=this;if(null!=t.arrSCardItem){var r=t.arrSCardItem[e];if(null!=r&&null!=r.getType()&&0==r.getType()){var a=r.getCardData();if(null!=a){var n=a.code;t.showCardDetailView(n)}}}},t.prototype.showCardDetailView=function(e){if(null!=e&&""!=e){for(var t=this,r=null,a=null==t.arrCardDetailData?0:t.arrCardDetailData.length,n=0;a>n;n++){var o=t.arrCardDetailData[n];if(null!=o&&o.code==e){r=o;break}}if(null==r){var i=GlobalDataManager.getInstance().getCenterServer(),l={code:e};return void HttpManager.getInstance().send(i.getSname(),HallCmdDef.CMD_GET_CARD_DETAIL_TEAMSET,l)}for(var s=-1,n=0,a=t.arrSCardItem.length;a>n;n++){var c=t.arrSCardItem[n];if(null!=c&&0==c.getType()&&null!=c.getCardData()&&c.getCardData().code==e){s=n;break}}var u={cdata:r};-1!=s&&(u.cbRemove=Handler.create(t,t.onRemoveSCardItem,[s])),UIManager.getInstance().showUI(CGDetailView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,u)}},t.prototype.onRemoveSCardItem=function(e){if(!(null==e||0>e)){var t=this,r=t.arrSCardItem[e];null!=r&&(r.updateShow({type:1}),t.updateBCardSelShow(),UIManager.getInstance().hideUI(CGDetailView),t.updateCardGroupAttribute())}},t.prototype.setCardGroupAttribute=function(e,t,r,a){var n=this;n.lblCCost.text=e,n.lblCHp.text=t+"",n.lblCAtk.text=r+"",n.lblCCapacity.text=t+r+"",n.lblCEle.text=a},t.prototype.setFromFetter=function(e){this.lblCFetters.text=e},t.prototype.changeBtnImage=function(e,t){var r="hallBtn2Sheet_json.",a=e.getChildAt(0);a.source=r+t;var n=t,o=t.split("_");2==o.length&&(n=r+o[0]+"_1");var i=e.skin.states,l=i[1].overrides[0];l.value=n},t.prototype.initTeamConfig=function(e){var t=this;t.arrTeamConfig=e;for(var r=GlobalDataManager.getInstance().getAccountData(),a=5,n=0,o=t.scrSCardItem.width/a,i=0,l=0,s=e.length;s>l;l++){var c=e[l];if(null!=c){var u=c.unlocklvl;if(null!=u){var p=2;null!=r&&r.getLvl()>=u&&(p=1);var h="groupCGSCI_"+l,g={type:p,sdata:u,gname:h},d=new CGSCardItemView;d.initData(g),t.groupSCardItem.addChild(d),d.x=n*o;
var m=d.getViewHeight();d.y=i*(m+10),t.arrSCardItem.push(d),n++,n>=a&&(n=0,i++)}}}},t.prototype.setTeamItem=function(e){for(var t=this,r=e,a=0,n=t.arrTeamConfig.length;n>a;a++){var o=t.arrTeamConfig[a];if(null!=o){var i=o.code;if(null!=r&&null!=r[i]){var l=r[i];t.setSCardItem(a,l)}}}t.updateCardGroupAttribute()},t.prototype.updateCardGroupAttribute=function(){for(var e=this,t=0,r=0,a=0,n="",o="",i=new Array,l=0,s=e.arrSCardItem.length;s>l;l++){var c=e.arrSCardItem[l];if(null!=c&&null!=c.getCardData()){var u=c.getCardData(),p=u.code;i.push(p);var h=u.hp,g=u.atk,d=u.cost,m=u.element;t+=h,r+=g,a+=d,5>l?n+=PublicMethodManager.getInstance().getCardElement(m):o+=PublicMethodManager.getInstance().getCardElement(m)}}var C=GlobalDataManager.getInstance().getAccountData();e.cardCostStr=a+"/"+C.getCost(),e.setCardGroupAttribute(e.cardCostStr,t,r,n+"\n"+o),i.length<=0?e.setFromFetter(""):e.sendGetTeamFromFetters(i)},t.prototype.setSCardItem=function(e,t){var r=this;if(null!=r.arrSCardItem){var a=r.arrSCardItem[e];if(null!=a){var n={type:0,sdata:t};a.updateShow(n)}}},t.prototype.setRCardItem=function(e){var t=this;1==t.pageNum&&t.removeRCardItem();for(var r=10,a=0,n=t.arrRCardItem.length,o=null==e?n:n+e.length,i=n;o>i;i++){var l=i-n,s=e[l];if(null!=s){var c=new CardRectangleView,u=s;u.groupName="groupCR_"+i,c.initData(u),t.groupCCardItem.addChild(c),0==a&&(a=c.getViewWidth());var p=i*(a*t.cRCardScale+r);c.x=p,c.y=0,c.scaleX=c.scaleY=t.cRCardScale,t.arrRCardItem.push(c),t.arrRCardPosX.push(p)}}if(o-n<t.pageSize&&null==t.cCardScrViewGroup){var h=new eui.Group;0==a&&t.arrRCardItem.length>0&&(a=t.arrRCardItem[0].getViewWidth()),h.x=a*t.cRCardScale*(o+1),h.y=0,h.width=t.scrCCardItem.width,h.height=0,t.groupCCardItem.addChild(h),t.cCardScrViewGroup=h}t.checkScale(),t.updateBCardSelShow()},t.prototype.setUserInfo=function(){var e=this,t=GlobalDataManager.getInstance().getAccountData();e.imgIcon.source=t.getHead_Url(),e.lblLvl.text=t.getLvl()+""},t.prototype.removeRCardItem=function(){for(var e=this;e.arrRCardPosX.length;)e.arrRCardPosX.pop();e.cleanArray(e.arrRCardItem),null!=e.cCardScrViewGroup&&(e.cCardScrViewGroup.parent.removeChild(e.cCardScrViewGroup),e.cCardScrViewGroup=null),e.curChooseRCardIndex=-1,e.scrCCardItem.viewport.scrollH=0},t.prototype.addCardDetail=function(e){var t=this;null==t.arrCardDetailData&&(t.arrCardDetailData=new Array);for(var r=e.code,a=!1,n=0,o=t.arrCardDetailData.length;o>n;n++){var i=t.arrCardDetailData[n];if(null!=i&&r==i.code){a=!0;break}}a||t.arrCardDetailData.push(e),t.showCardDetailView(r)},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_GET_CARD_LIST_TEAMSET:r.setRCardItem(t),UIManager.getInstance().hideUI(FilterView);break;case HallCmdDef.CMD_GET_CARD_DETAIL_TEAMSET:r.addCardDetail(t);break;case HallCmdDef.CMD_SAVE_TEAMSET:r.onSaveTeamComplete();break;case HallCmdDef.CMD_GET_FROM_FETTER_TEAMSET:r.onGetTeamFromFetters(t)}},t.prototype.onSaveTeamComplete=function(){var t=this,r={},a=e.prototype.getData.call(this);if(null!=a){a.cardGroupName;r.name=t.editName.text;var n=a.teamData;if(null!=n){var o=n.c_index;r.c_index=o;for(var i=0,l=t.arrTeamConfig.length;l>i;i++){var s=t.arrTeamConfig[i];if(null!=s&&null!=t.arrSCardItem[i]){var c=s.code,u=t.arrSCardItem[i].getCardData();null!=u&&(r[c]=u)}}}}null!=t.callBackUpdateTeam&&t.callBackUpdateTeam.runWith(r),PopManager.getInstance().showPromptBox(t.labelObj.lbl_20,1,Handler.create(t,function(e){e&&t.hiden()}),[t.labelObj.lbl_21,t.labelObj.lbl_22])},t.prototype.sendGetCardList=function(){var e=GlobalDataManager.getInstance().getCenterServer(),t=this,r={rarity:t.sortFactor.rarity,element:t.sortFactor.element,sort:t.sortFactor.sort,pageNum:t.pageNum,pageSize:t.pageSize,detail:0};HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_GET_CARD_LIST_TEAMSET,r)},t.prototype.sendGetTeamFromFetters=function(e){if(!(null==e||e.length<=0)){var t=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(t.getSname(),HallCmdDef.CMD_GET_FROM_FETTER_TEAMSET,{codes:e},!1)}},t.prototype.sendSaveTeam=function(){var t=this,r=t.editName.text;if(""==r)return void PopManager.getInstance().showPromptBox(t.labelObj.lbl_23,2);var a=t.cardCostStr.split("/");if(null!=a&&2==a.length){var n=Number(a[1]),o=Number(a[0]);if(o>n)return void PopManager.getInstance().showPromptBox(t.labelObj.lbl_24,2);var i={},l=e.prototype.getData.call(this);if(null!=l){l.cardGroupName;i.name=r;var s=l.teamData,c={};if(null!=s){var u=s.c_index;c.c_index=u;for(var p=!1,h=0,g=t.arrTeamConfig.length;g>h;h++){var d=t.arrTeamConfig[h];if(null!=d&&null!=t.arrSCardItem[h]){var m=d.code,C=t.arrSCardItem[h].getCardData(),f="";null!=C&&null!=C.code&&(f=C.code,p=!0),c[m]=f}}if(!p)return void PopManager.getInstance().showPromptBox(t.labelObj.lbl_23,2)}i.curTeamData=c}var v=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(v.getSname(),HallCmdDef.CMD_SAVE_TEAMSET,i)}},t.prototype.setCardFetters=function(e){if(null!=e){var t=this;t.cleanArray(t.arrCardFetters);for(var r=3,a=0,n=t.scrCardFetters.width/r,o=0,i=6,l=e.length<i?i:e.length,s=0;l>s;s++){var c={type:0,fdata:null},u=e[s];null!=u&&(c.type=1,c.fdata={icon:u.icon,color:u.color,canTouch:!1});var p=new CGSFetterItemView;p.initData(c),t.groupCardFetters.addChild(p),p.x=a*(n+5),p.y=o*(p.height+20),t.arrCardFetters.push(p),a++,a>=r&&(a=0,o++)}}},t.prototype.onChangeStartHandler=function(){var e=this;e.onChangeStart=!0,e.btnDetails.visible&&(e.btnDetails.visible=!1)},t.prototype.onChangeHanlder=function(e){var t=this;t.checkScale()},t.prototype.onChangeEndHandler=function(){var e=this;e.onChangeStart&&(e.onChangeStart=!1,e.autoScrollToItem()),null==e.cCardScrViewGroup&&e.scrCCardItem.viewport.scrollH+e.scrCCardItem.width>=e.scrCCardItem.viewport.contentWidth&&(e.pageNum++,e.sendGetCardList())},t.prototype.onCancelHandler=function(){this.movingState=!0},t.prototype.onEndHandler=function(){this.movingState=!1},t.prototype.autoScrollToItem=function(){var e=this;e.scrollToItem(e.curChooseRCardIndex)},t.prototype.scrollToItem=function(e){var t=this;if(-1!=e){t.curChooseRCardIndex=e;var r=t.arrRCardPosX[e];egret.Tween.removeTweens(t.scrCCardItem.viewport),egret.Tween.get(t.scrCCardItem.viewport).to({scrollH:r},100).call(t.checkScale,t),t.updateBCardSelShow()}},t.prototype.updateBCardSelShow=function(){var e=this;e.btnDetails.visible=-1!=e.curChooseRCardIndex;for(var t=0,r=e.arrRCardItem.length;r>t;t++){var a=e.arrRCardItem[t];if(null!=a){var n=a.getData();if(null==n)return;var o=n.code;if(null==o)return;a.setChoose(-1!=e.getSCardItemIndex(o))}}},t.prototype.getSCardItemIndex=function(e){for(var t=this,r=0,a=t.arrSCardItem.length;a>r;r++){var n=t.arrSCardItem[r];if(null!=n&&0==n.getType()&&null!=n.getCardData()&&e==n.getCardData().code)return r}return-1},t.prototype.checkScale=function(){for(var e=this,t=e.scrCCardItem,r=22,a=100-r,n=0,o=e.arrRCardItem.length;o>n;n++){var i=e.arrRCardItem[n];i.x=e.arrRCardPosX[n]+r;var l=i.x-t.viewport.scrollH;if(Math.abs(l)<a&&Math.abs(l)>=0){if(0>l?i.scaleX=i.scaleY=e.bRCardScale+l/1e3:l>0?i.scaleX=i.scaleY=e.bRCardScale-l/1e3:0==Math.abs(l)&&(i.scaleX=i.scaleY=e.bRCardScale),i.y=0,r=i.width*(e.bRCardScale-e.cRCardScale)+40,e.curChooseRCardIndex=n,0!=n){var s=e.arrRCardItem[n-1];s.x=e.arrRCardPosX[n-1]-25}}else i.scaleX=i.scaleY=e.cRCardScale,i.y=40}},t.prototype.setCardGroupName=function(e){if(null!=e){var t=this;t.editName.text=e}},t.prototype.onGetTeamFromFetters=function(e){if(null!=e){var t=this,r=e.fetters,a="",n=new Array;if(null!=r)for(var o in r){var i=r[o];if(null!=i){var l=i.name;a+=l+"\n";var s={icon:i.icon,color:i.color};n.push(s)}}t.setFromFetter(a),t.setCardFetters(n)}},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.groupCardGroupSet){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.groupCardGroupSet.scaleX=r.groupCardGroupSet.scaleY=1):void(r.groupCardGroupSet.scaleX=r.groupCardGroupSet.scaleY=l)}},t.NAME="CardGroupSetSkin",t}(BaseView);__reflect(CardGroupSetView.prototype,"CardGroupSetView");var CardGroupView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrCardItem=new Array,r.arrDefaultTeamList=[],r}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),GameEventManager.getInstance().addEventListener(GameEvent.updateUserInfo,e,e.onUpdateAccountData),e.labelObj=LanguageManager.getInstance().getLabelLanguage(this),e.initView()},t.prototype.initView=function(){var e=this;null!=e.arrTeamConfig&&e.initTeamConfig(e.arrTeamConfig),e.arrDefaultTeamList.push({name:e.labelObj.lbl_0,data:new Object}),e.arrDefaultTeamList.push({name:e.labelObj.lbl_1,data:new Object}),e.arrDefaultTeamList.push({name:e.labelObj.lbl_2,data:new Object}),e.lblCCost.text="0/0",e.lblCHp.text="0",e.lblCAtk.text="0",e.lblCCapacity.text="0",e.lblCEle.text="",e.lblCFetters.text="",null!=e.teamData?e.initTeamData(e.teamData):e.sendGetTeamList(),e.setUserInfo()},t.prototype.sleep=function(){var e=this;for(e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),GameEventManager.getInstance().removeEventListener(GameEvent.updateUserInfo,e,e.onUpdateAccountData),e.cleanArray(e.arrCardItem),e.teamData=null;0!=e.arrDefaultTeamList.length;)e.arrDefaultTeamList.pop();e.labelObj=null},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.touchTap=function(e){var t=this;if(e.target instanceof eui.Button){var r=e.target;if(r==t.btnCGChoose){for(var a=new Array,n=-1,o=0,i=t.arrTeamList.length;i>o;o++){var l=t.arrTeamList[o];if(null!=l){a.push(l.name);var s=l.data;if(null!=s){var c=s.battle;null!=c&&1==c&&(n=o)}}}var u={desArr:a,selIndex:n,cbHandler:Handler.create(t,t.onChooseTeamListItem)};UIManager.getInstance().showUI(FilterView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,u)}else r==t.btnCGEdit?t.showCardGroupSetView():r==t.btnAddLv?UIManager.getInstance().showUI(RoleUpgradeView):r==t.btnBack&&t.hiden()}else if(e.target instanceof eui.Group){var p=e.target;if(null==p.name)return;if("groupCGCI_"==p.name.substr(0,10)){var h=p.name.split("_");if(2!=h.length)return;var g=Number(h[1]);t.onClickCardItem(g)}}},t.prototype.showCardGroupSetView=function(){var e=this,t=e.teamData.curBattleTeam;if(null==t||null==t.name){t={};var r=e.lblCGName.text;t.name=r;for(var a=0,n=0,o=e.arrDefaultTeamList.length;o>n;n++){var i=e.arrDefaultTeamList[n];if(null!=i&&null!=i.name&&i.name==r){a=n;break}}t.c_index=a}var l={teamData:t,arrTeamConfig:e.arrTeamConfig,cbUpdateTeam:Handler.create(e,e.onUpdateTeamData)};UIManager.getInstance().showUI(CardGroupSetView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,l)},t.prototype.onUpdateTeamData=function(e){this.changeBattleTeam(e)},t.prototype.onChooseTeamListItem=function(e){var t=this,r=t.arrTeamList[e],a=r.data,n=!0;if(null!=a&&null!=a.c_index&&null!=a.battle&&0!=a.battle&&(n=!1),n){for(var o=-1,i=0,l=t.arrTeamList.length;l>i;i++){var s=t.arrTeamList[i];if(null!=s){var c=s.data;if(null!=c){var u=c.battle;if(null!=u&&1==u){o=i;break}}}}o==e&&(n=!1)}if(n){var p=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(p.getSname(),HallCmdDef.CMD_CHANGE_BATTLE_TEAM,{c_index:e})}else UIManager.getInstance().hideUI(FilterView)},t.prototype.onClickCardItem=function(e){var t=this;if(null!=t.arrCardItem){var r=t.arrCardItem[e];null!=r&&null!=r.getType()&&1==r.getType()&&t.showCardGroupSetView()}},t.prototype.setUserInfo=function(){var e=this,t=GlobalDataManager.getInstance().getAccountData();e.onUpdateAccountData(!1),e.imgIcon.source=t.getHead_Url()},t.prototype.setCardGroupAttribute=function(e,t,r,a){var n=this;n.lblCCost.text=e,n.lblCHp.text=t+"",n.lblCAtk.text=r+"",n.lblCEle.text=a,n.lblCCapacity.text=t+r+""},t.prototype.setFromFetter=function(e){this.lblCFetters.text=e},t.prototype.setCardGroupName=function(e){var t=this;t.lblCGName.text=e},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_GET_TEAM_CONFIG:r.initTeamConfig(t),r.sendGetTeamList();break;case HallCmdDef.CMD_GET_TEAM_LIST:r.initTeamData(t);break;case HallCmdDef.CMD_CHANGE_BATTLE_TEAM:r.changeBattleTeam(t),UIManager.getInstance().hideUI(FilterView);break;case HallCmdDef.CMD_GET_FROM_FETTER_TEAM:r.onGetTeamFromFetters(t)}},t.prototype.sendGetTeamList=function(){var e=GlobalDataManager.getInstance().getCenterServer(),t=this,r=HallCmdDef.CMD_GET_TEAM_LIST;null==t.arrTeamConfig&&(r=HallCmdDef.CMD_GET_TEAM_CONFIG),HttpManager.getInstance().send(e.getSname(),r,new Object)},t.prototype.sendGetTeamFromFetters=function(e){if(!(null==e||e.length<=0)){var t=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(t.getSname(),HallCmdDef.CMD_GET_FROM_FETTER_TEAM,{codes:e},!1)}},t.prototype.initTeamConfig=function(e){if(null!=e){var t=this;t.arrTeamConfig=e;for(var r=GlobalDataManager.getInstance().getAccountData(),a=5,n=0,o=t.scrCardItem.width/a,i=-1,l=0,s=0,c=e.length;c>s;s++){var u=e[s];if(null!=u){var p=u.unlocklvl;if(null!=p){var h=2;null!=r&&r.getLvl()>=p&&(h=1);var g="groupCGCI_"+s,d={type:h,sdata:p,gname:g},m=new CGCardItemView;m.initData(d),t.groupCardItem.addChild(m),-1==i&&(i=o-m.getViewWidth()>0?Math.floor((o-m.getViewWidth())/(a-1)):0),m.x=n*o+i,m.y=l*(m.getViewHeight()+10),m.width=m.getViewWidth(),m.height=m.getViewHeight(),t.arrCardItem.push(m),n++,n>=a&&(n=0,l++)}}}}},t.prototype.initTeamData=function(e){if(null!=e){var t=this;t.teamData=e,t.setTeamList(e.list),t.setTeamItem(e.curBattleTeam)}},t.prototype.setTeamItem=function(e){var t=this;t.removeCardItem();for(var r=e,a=0,n=t.arrTeamConfig.length;n>a;a++){var o=t.arrTeamConfig[a];if(null!=o){var i=o.code;if(null!=r&&null!=r[i]){var l=r[i];t.setCardItem(a,l)}}}var s=null!=r?r.name:"";if(null==s||""==s){var c=null!=r?r.c_index:0;c=null==c?0:c;var u=t.arrTeamList[c];null!=u&&(s=u.name)}t.setCardGroupName(s),t.updateCardGroupAttribute()},t.prototype.updateCardGroupAttribute=function(){for(var e=this,t=0,r=0,a=0,n="",o="",i=new Array,l=0,s=e.arrCardItem.length;s>l;l++){var c=e.arrCardItem[l];if(null!=c&&null!=c.getCardData()){var u=c.getCardData(),p=u.code;i.push(p);var h=u.hp,g=u.atk,d=u.cost,m=u.element;t+=h,r+=g,a+=d,5>l?n+=PublicMethodManager.getInstance().getCardElement(m):o+=PublicMethodManager.getInstance().getCardElement(m)}}var C=GlobalDataManager.getInstance().getAccountData();e.setCardGroupAttribute(a+"/"+C.getCost(),t,r,n+"\n"+o),i.length<=0?e.setFromFetter(""):e.sendGetTeamFromFetters(i)},t.prototype.setTeamList=function(e){if(null!=e){var t=this;t.arrTeamList=t.arrDefaultTeamList;for(var r=e.length,a=0;r>a;a++){var n=e[a];if(null!=n){var o=n.c_index,i=t.arrTeamList[o];null!=i&&(i.name=n.name,i.data=n)}}}},t.prototype.changeBattleTeam=function(e){if(null!=e){var t=this;t.setTeamItem(e);var r=e.c_index;if(null!=t.arrTeamList)for(var a=t.arrTeamList.length,n=0;a>n;n++){var o=t.arrTeamList[n];if(null!=o){var i=o.data,l=0;n==r&&(l=1,null!=e.name&&(o.name=e.name)),(null==i.battle||i.battle!=l)&&(i.battle=l)}}null!=t.teamData&&(t.teamData.curBattleTeam=e)}},t.prototype.setCardItem=function(e,t){var r=this;if(null!=r.arrCardItem){var a=r.arrCardItem[e];if(null!=a){var n={type:0,sdata:t};a.updateShow(n)}}},t.prototype.removeCardItem=function(){var e=this;if(null!=e.arrCardItem)for(var t=GlobalDataManager.getInstance().getAccountData(),r=0,a=e.arrCardItem.length;a>r;r++){var n=e.arrCardItem[r];if(null!=n){var o=2,i=e.arrTeamConfig[r];if(null!=i){var l=i.unlocklvl;null!=t&&t.getLvl()>=l&&(o=1);var s={type:o,sdata:l};n.updateShow(s)}}}},t.prototype.onGetTeamFromFetters=function(e){if(null!=e){var t=this,r=e.fetters,a="";if(null!=r)for(var n in r){var o=r[n];if(null!=o){var i=o.name;a+=i+"\n"}}t.setFromFetter(a)}},t.prototype.onUpdateAccountData=function(e){void 0===e&&(e=!0);var t=this,r=GlobalDataManager.getInstance().getAccountData();t.lblLvl.text=r.getLvl()+"";var a=r.getExp(),n=r.getUpexp();t.lblExpProgress.text=a+"/"+n,t.prbExp.value=Math.floor(a/n*100),t.lblHp.text=r.getHp()+"";var o=t.lblCCost.text;if(""!=o){var i=o.split("/");null!=i&&2==i.length&&(t.lblCCost.text=i[0]+"/"+r.getCost())}t.updateCardItem(),e&&GameEventManager.getInstance().dispatchEvent(GameEvent.updateUserInfo)},t.prototype.updateCardItem=function(){var e=this;if(!(null==e.arrCardItem||e.arrCardItem.length<=0))for(var t=GlobalDataManager.getInstance().getAccountData(),r=0,a=e.arrCardItem.length;a>r;r++){var n=e.arrCardItem[r];if(null!=n&&2==n.getType()){var o=2,i=e.arrTeamConfig[r];if(null!=i){var l=i.unlocklvl;null!=t&&t.getLvl()>=l&&(o=1);var s={type:o,sdata:l};n.updateShow(s)}}}},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.groupCardGroup){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.groupCardGroup.scaleX=r.groupCardGroup.scaleY=1):void(r.groupCardGroup.scaleX=r.groupCardGroup.scaleY=l)}},t.NAME="CardGroupSkin",t}(BaseView);__reflect(CardGroupView.prototype,"CardGroupView");var CGAwardView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.curTypeIndex=0,r.arrFetterItemView=new Array,r.arrSkillItemView=new Array,r}return __extends(t,e),t.prototype.week=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t);var r=e.prototype.getData.call(this);null!=r&&(t.setCard(r),t.setFetter(r.txt,r.name))},t.prototype.initView=function(){var e=this;e.btnUnload.visible=!0,e.callBackRemove=null,e.cardCode=""},t.prototype.sleep=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),null!=e.attributeTextField&&(e.attributeTextField.parent.removeChild(e.attributeTextField),e.attributeTextField=null),e.cleanArray(e.arrFetterItemView),e.cleanArray(e.arrSkillItemView)},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.touchTap=function(e){var t=this,r=e.target;if(r instanceof eui.Button){var a=r;a==t.btnClose?t.hiden():a==t.btnUnload&&null!=t.callBackRemove&&t.callBackRemove.run()}else r instanceof eui.Rect&&r==t.rectBG&&t.hiden()},t.prototype.setCard=function(e){var t=this,r=new CardintroduceView;r.initData(e),r.horizontalCenter="0",r.verticalCenter="0",t.groupCard.addChild(r)},t.prototype.setSkillItem=function(e){if(null!=e){var t=this,r={name:e.name,level:e.level,type:e.type,desc:e.desc,fdata:{icon:e.icon,rarity:"common",canTouch:!1}},a=new CGDSkillItemView;a.initData(r),t.groupSkillItem.addChild(a),t.arrSkillItemView.push(a)}},t.prototype.setFetter=function(e,t){var r=this;r.groupFetterItem.removeChildren(),e=e.replace("/r/","\r");var a=new eui.Label("\r"+e);a.$setWidth(484),a.lineSpacing=26,a.fontFamily="SimHei",a.size=20,a.y=20,r.groupFetterItem.addChild(a),r.groupFetterItem.scrollV=0},t.NAME="CGAwardSkin",t}(BaseView);__reflect(CGAwardView.prototype,"CGAwardView");var CGCardItemView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this;t.labelObj=LanguageManager.getInstance().getLabelLanguage(this);var r=e.prototype.getData.call(this);if(null!=r){t.updateShow(r);var a=r.gname;t.groupCGCI.name=a}},t.prototype.sleep=function(){var e=this;e.labelObj=null},t.prototype.setSCard=function(e){var t=this;t.removeCard(),t.cardData=e;var r=new CardSquareView;r.initData(e),r.scaleX=Number((t.groupCard.width/r.width).toFixed(2)),r.scaleY=Number((t.groupCard.height/r.height).toFixed(2)),t.groupCard.addChild(r),t.cardView=r},t.prototype.removeCard=function(){var e=this;null!=e.cardView&&(e.cardView.parent.removeChild(e.cardView),e.cardView=null),e.cardData=null},t.prototype.setLockLabel=function(e){var t=this;null==t.labelObj&&(t.labelObj=LanguageManager.getInstance().getLabelLanguage(this)),t.lblUnlock.text="LV"+e+t.labelObj.lbl_0},t.prototype.getViewWidth=function(){return this.groupCGCI.width},t.prototype.getViewHeight=function(){return this.groupCGCI.height},t.prototype.getType=function(){return this.type},t.prototype.getCardData=function(){return this.cardData},t.prototype.updateShow=function(e){var t=this,r=e.type,a=e.sdata;t.groupCard.visible=0==r,t.groupAdd.visible=1==r,t.groupUnlock.visible=2==r,t.removeCard(),0==r?t.setSCard(a):2==r&&t.setLockLabel(Number(a)),t.type=r},t.NAME="CGCardItemSkin",t}(IBaseView);__reflect(CGCardItemView.prototype,"CGCardItemView");var CGDetailView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.curTypeIndex=0,r.arrFetterItemView=new Array,r.arrSkillItemView=new Array,r}return __extends(t,e),t.prototype.week=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t),t.labelObj=LanguageManager.getInstance().getLabelLanguage(this),t.initView();var r=e.prototype.getData.call(this);if(null!=r){var a=r.cdata;if(null!=a){var n=a.cardDetail;if(null!=n){var o=n.attribute;null!=o&&(t.setCard(o),t.setAttribute(o),t.cardName=o.name);var i=n.skills;null!=i&&t.setSkill(i);var l=n.fetters;null!=l&&t.setFetter(l)}t.cardCode=a.code,t.callBackRemove=r.cbRemove,t.btnUnload.visible=null!=t.callBackRemove}}},t.prototype.initView=function(){var e=this;e.btnUnload.visible=!0,e.callBackRemove=null,e.cardCode="",e.cardName="",e.selTypeGroup(0)},t.prototype.sleep=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),null!=e.attributeTextField&&(e.attributeTextField.parent.removeChild(e.attributeTextField),e.attributeTextField=null),e.cleanArray(e.arrFetterItemView),e.cleanArray(e.arrSkillItemView),e.labelObj=null},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.touchTap=function(e){var t=this,r=e.target;if(r instanceof eui.Button){var a=r;a==t.btnClose?t.hiden():a==t.btnUnload&&null!=t.callBackRemove&&t.callBackRemove.run()}else r instanceof eui.Rect?r==t.rectBG&&t.hiden():r instanceof eui.Image&&(r==t.imgAttribute?0!=t.curTypeIndex&&t.selTypeGroup(0):r==t.imgSkill?1!=t.curTypeIndex&&t.selTypeGroup(1):r==t.imgFetter&&2!=t.curTypeIndex&&t.selTypeGroup(2))},t.prototype.getTypeBGImage=function(e){var t,r=this;return 0==e?t=r.imgAttribute:1==e?t=r.imgSkill:2==e&&(t=r.imgFetter),t},t.prototype.getTypeLabelImage=function(e){var t,r=this;return 0==e?t=r.imgAttributeLabel:1==e?t=r.imgSkillLabel:2==e&&(t=r.imgFetterLabel),t},t.prototype.selTypeGroup=function(e){var t,r,a=this;null!=a.curTypeIndex&&(t=a.getTypeBGImage(a.curTypeIndex),null!=t&&(t.source=a.getImgSourcePrefix(t)+"_0"),r=a.getTypeLabelImage(a.curTypeIndex),null!=r&&(r.source=a.getImgSourcePrefix(r)+"_0")),a.curTypeIndex=e,t=a.getTypeBGImage(a.curTypeIndex),null!=t&&(t.source=a.getImgSourcePrefix(t)+"_1"),r=a.getTypeLabelImage(a.curTypeIndex),null!=r&&(r.source=a.getImgSourcePrefix(r)+"_1"),a.groupAttribute.visible=0==a.curTypeIndex,a.groupSkill.visible=1==a.curTypeIndex,a.groupFetter.visible=2==a.curTypeIndex},t.prototype.getImgSourcePrefix=function(e){var t="",r=e.source,a=r.toString().split(".");if(2==a.length){var n=a[1].split("_");2==n.length&&(t=a[0]+"."+n[0])}return t},t.prototype.setCard=function(e){var t=this,r=e;r.canTouch=!1;var a=new CardRectangleView;a.initData(r),a.horizontalCenter="0",a.verticalCenter="0",t.groupCard.addChild(a)},t.prototype.setAttribute=function(e){var t=this,r=null;null==t.attributeTextField0?(r=new egret.TextField,r.textColor=16777215,r.size=26,r.lineSpacing=40,t.groupAttTextField.addChild(r),r.fontFamily="SimHei",t.attributeTextField0=r):r=t.attributeTextField0;var a=null;null==t.attributeTextField1?(a=new egret.TextField,a.textColor=16777215,a.size=26,a.lineSpacing=40,a.x=240,t.groupAttTextField.addChild(a),a.fontFamily="SimHei",t.attributeTextField1=a):a=t.attributeTextField1;var n=e.rarity,o=PublicMethodManager.getInstance().getCardRarity(n),i=e.generation,l=ExternalFun.prototype.levelnumTo5lvl(e.level);l=(l-1)%1+1;var s=PublicMethodManager.getInstance().getProbabilityStr(t.labelObj.lbl_3,[i+"",l+""]),c=e.atk,u=e.cost,p=e.att,h=e.hp,g=e.hit,d=e.agl,m=e.cri_chance,C=e.cri_multiplier,f=e.rgn;r.textFlow=[{text:t.labelObj.lbl_4,style:{textColor:9159381}},{text:o+"\n",style:{textColor:16777215}},{text:t.labelObj.lbl_6,style:{textColor:9159381}},{text:c+h+"\n",style:{textColor:16777215}},{text:t.labelObj.lbl_9,style:{textColor:9159381}},{text:h+"\n",style:{textColor:16777215}},{text:t.labelObj.lbl_11,style:{textColor:9159381}},{text:g+"\n",style:{textColor:16777215}},{text:t.labelObj.lbl_13,style:{textColor:9159381}},{text:m+"\n",style:{textColor:16777215}},{text:t.labelObj.lbl_7,style:{textColor:9159381}},{text:u+"\n",style:{textColor:16777215}}],a.textFlow=[{text:t.labelObj.lbl_5,style:{textColor:9159381}},{text:s+"\n",style:{textColor:16777215}},{text:t.labelObj.lbl_8,style:{textColor:9159381}},{text:p+"\n",style:{textColor:16777215}},{text:t.labelObj.lbl_10,style:{textColor:9159381}},{text:c+"\n",style:{textColor:16777215}},{text:t.labelObj.lbl_12,style:{textColor:9159381}},{text:d+"\n",style:{textColor:16777215}},{text:t.labelObj.lbl_14,style:{textColor:9159381}},{text:C+"\n",style:{textColor:16777215}},{text:t.labelObj.lbl_15,style:{textColor:9159381}},{text:f+"\n",style:{textColor:16777215}}]},t.prototype.setSkill=function(e){if(null!=e){var t=this;for(var r in e){var a=e[r];null!=a&&t.setSkillItem(a)}}},t.prototype.setFetter=function(e){if(null!=e){var t=this;for(var r in e){var a=e[r];null!=a&&t.setFetterItem(a)}}},t.prototype.setSkillItem=function(e){if(null!=e){var t=this,r={name:e.name,level:e.level,type:e.type,desc:e.desc,fdata:{icon:e.icon,rarity:e.level,canTouch:!1}},a=new CGDSkillItemView;a.initData(r),t.groupSkillItem.addChild(a),t.arrSkillItemView.push(a)}},t.prototype.setFetterItem=function(e){if(null!=e){var t=this,r={name:e.name,desc:e.desc,cname:t.cardName,compose:e.zc,fdata:{icon:e.icon,color:e.color,canTouch:!1}},a=new CGDFetterItemView;a.initData(r),t.groupFetterItem.addChild(a),t.arrFetterItemView.push(a)}},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.groupCGDetail){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.groupCGDetail.scaleX=r.groupCGDetail.scaleY=1):void(r.groupCGDetail.scaleX=r.groupCGDetail.scaleY=l)}},t.NAME="CGDetailSkin",t}(BaseView);__reflect(CGDetailView.prototype,"CGDetailView");var CGDFetterItemView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);if(null!=r){var a=r.name;t.setName(a),t.setDesc(r);var n=r.fdata;t.setFetterIcon(n)}},t.prototype.sleep=function(){var e=this;null!=e.cardFetterView&&(e.cardFetterView.parent.removeChild(e.cardFetterView),e.cardFetterView=null)},t.prototype.setName=function(e){var t=null==e||void 0==e?"":e;this.lblName.text=t},t.prototype.setDesc=function(e){if(null!=e){var t=e.desc,r=e.cname,a=e.compose,n=LanguageManager.getInstance().getLabelLanguage(this),o=new Array;o.push({text:n.lbl_0,style:{textColor:9159381}}),o.push({text:t+"\n",style:{textColor:16777215}});var i=this,l=null==a||void 0==a?"":a;if(""!=l&&""!=r){var s=a.split(r);o.push({text:n.lbl_1,style:{textColor:9159381}}),s.length>1?(o.push({text:s[0],style:{textColor:16777215}}),o.push({text:r,style:{textColor:16575843}}),o.push({text:s[1]+"\n",style:{textColor:16777215}})):o.push({text:l+"\n",style:{textColor:16777215}})}i.lblDes.textFlow=o}},t.prototype.setFetterIcon=function(e){var t=this,r=new CardFetterView;r.initData(e),t.groupFetterIcon.addChild(r),r.scaleX=r.scaleY=.46,t.cardFetterView=r},t.NAME="CGDFetterItemSkin",t}(IBaseView);__reflect(CGDFetterItemView.prototype,"CGDFetterItemView");var CGDSkillItemView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);if(null!=r){var a=r.name,n=r.level,o=r.type;t.setSkillTextField(a,n,o);var i=r.desc;t.setDes(i);var l=r.fdata;t.setSkillIcon(l)}},t.prototype.sleep=function(){var e=this;null!=e.skillTextField&&(e.skillTextField.parent.removeChild(e.skillTextField),e.skillTextField=null),null!=e.cardSkillView&&(e.cardSkillView.parent.removeChild(e.cardSkillView),e.cardSkillView=null)},t.prototype.setSkillTextField=function(e,t,r){var a=this,n=null==e||void 0==e?"":e,o=null==t||void 0==t?"LV.0":"LV."+t;r=null==r||void 0==r?2:r;var i=LanguageManager.getInstance().getLabelLanguage(this),l=2==r?i.lbl_0:i.lbl_1,s=2==r?2998783:16732958,c=new egret.TextField;c.textColor=16777215,c.size=22,c.stroke=2,c.strokeColor=0,a.groupSTextField.addChild(c),c.fontFamily="SimHei",c.textFlow=[{text:n+"   "+o+"   ",style:{textColor:16777215}},{text:l,style:{textColor:s}}],a.skillTextField=c},t.prototype.setDes=function(e){var t=null==e||void 0==e?"":e;this.lblDes.text=t+"\n"},t.prototype.setSkillIcon=function(e){var t=this,r=new CardSkillView;r.initData(e),t.groupSkillIcon.addChild(r),t.cardSkillView=r},t.NAME="CGDSkillItemSkin",t}(IBaseView);__reflect(CGDSkillItemView.prototype,"CGDSkillItemView");var CGSCardItemView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this;t.labelObj=LanguageManager.getInstance().getLabelLanguage(this);var r=e.prototype.getData.call(this);if(null!=r){t.updateShow(r);var a=r.gname;t.groupCGSCI.name=a}},t.prototype.sleep=function(){var e=this;e.removeCard(),e.labelObj=null},t.prototype.setSCard=function(e){var t=this;t.removeCard(),t.cardData=e;var r=new CardSquareView;r.initData(e),r.scaleX=Number((t.groupCard.width/r.width).toFixed(2)),r.scaleY=Number((t.groupCard.height/r.height).toFixed(2)),t.groupCard.addChild(r),t.cardView=r},t.prototype.removeCard=function(){var e=this;null!=e.cardView&&(e.cardView.parent.removeChild(e.cardView),e.cardView=null),e.cardData=null},t.prototype.setLockLabel=function(e){var t=this;t.lblUnlock.text="LV"+e+t.labelObj.lbl_0},t.prototype.getViewWidth=function(){return this.groupCGSCI.width},t.prototype.getViewHeight=function(){return this.groupCGSCI.height},t.prototype.getType=function(){return this.type},t.prototype.getCardData=function(){return this.cardData},t.prototype.updateShow=function(e){var t=this,r=e.type,a=e.sdata;t.groupCard.visible=0==r,t.groupAdd.visible=1==r,t.groupUnlock.visible=2==r,t.removeCard(),0==r?t.setSCard(a):2==r&&t.setLockLabel(Number(a)),t.type=r},t.NAME="CGSCardItemSkin",t}(IBaseView);__reflect(CGSCardItemView.prototype,"CGSCardItemView");var CGSFetterItemView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);if(null!=r){var a=r.type;0==a?t.removeFetter():t.setFetter(r.fdata)}},t.prototype.sleep=function(){var e=this;e.removeFetter()},t.prototype.setFetter=function(e){var t=this;t.removeFetter(),t.imgBG.visible=!1;var r=new CardFetterView;r.initData(e),r.scaleX=Number((t.groupFetter.width/r.width).toFixed(2)),r.scaleY=Number((t.groupFetter.height/r.height).toFixed(2)),t.groupFetter.addChild(r),t.fetterView=r},t.prototype.removeFetter=function(){var e=this;
null!=e.fetterView&&(e.fetterView.parent.removeChild(e.fetterView),e.fetterView=null),e.imgBG.visible=!0},t.NAME="CGSFetterItemSkin",t}(IBaseView);__reflect(CGSFetterItemView.prototype,"CGSFetterItemView");var ExternalFun=function(e){function t(){return e.call(this,"ExternalFun")||this}return t.prototype.setImgGray=function(e){var t=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],r=new egret.ColorMatrixFilter(t);e.filters=[r]},t.prototype.add0=function(e,t){return(Array(t).join("0")+e).slice(-t)},t.prototype.levelnumTo5lvl=function(e){return(e-1)%5+1},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t}(IBaseView),HallCmdDef;!function(e){e[e.CMD_Hall=100]="CMD_Hall",e[e.CMD_Shop=103]="CMD_Shop",e[e.CMD_ShopBy=104]="CMD_ShopBy",e[e.CMD_Bag=105]="CMD_Bag",e[e.CMD_Baguse=106]="CMD_Baguse",e[e.CMD_Notice=107]="CMD_Notice",e[e.CMD_CardViewLists=228]="CMD_CardViewLists",e[e.CMD_SetHead=232]="CMD_SetHead",e[e.CMD_InExchange=500]="CMD_InExchange",e[e.CMD_OutExchange=501]="CMD_OutExchange",e[e.CMD_GET_TEAM_CONFIG=110]="CMD_GET_TEAM_CONFIG",e[e.CMD_GET_TEAM_LIST=111]="CMD_GET_TEAM_LIST",e[e.CMD_CHANGE_BATTLE_TEAM=112]="CMD_CHANGE_BATTLE_TEAM",e[e.CMD_GET_CARD_LIST_TEAMSET=113]="CMD_GET_CARD_LIST_TEAMSET",e[e.CMD_GET_CARD_DETAIL_TEAMSET=114]="CMD_GET_CARD_DETAIL_TEAMSET",e[e.CMD_SAVE_TEAMSET=115]="CMD_SAVE_TEAMSET",e[e.CMD_GET_FROM_FETTER_TEAM=116]="CMD_GET_FROM_FETTER_TEAM",e[e.CMD_GET_FROM_FETTER_TEAMSET=117]="CMD_GET_FROM_FETTER_TEAMSET",e[e.CMD_GET_MOLLBY_CONFIG=124]="CMD_GET_MOLLBY_CONFIG",e[e.CMD_Award=125]="CMD_Award",e[e.CMD_Award10=126]="CMD_Award10",e[e.CMD_MyCardList=127]="CMD_MyCardList",e[e.CMD_SetConfig=128]="CMD_SetConfig",e[e.CMD_CreateCardPool=129]="CMD_CreateCardPool",e[e.CMD_GETUPADTEGOLD=130]="CMD_GETUPADTEGOLD",e[e.CMD_GET_CARD_LIST=150]="CMD_GET_CARD_LIST",e[e.CMD_GET_CARD_DETAIL=151]="CMD_GET_CARD_DETAIL",e[e.CMD_GET_FETTERS_CONFIG=160]="CMD_GET_FETTERS_CONFIG",e[e.CMD_GET_CARD_LIST_RECYCLE=170]="CMD_GET_CARD_LIST_RECYCLE",e[e.CMD_RECYCLE_CARD=171]="CMD_RECYCLE_CARD",e[e.CMD_GET_CUR_XWG_PRICE=175]="CMD_GET_CUR_XWG_PRICE",e[e.CMD_MATCH_PVP=180]="CMD_MATCH_PVP",e[e.CMD_DISMATCH_PVP=181]="CMD_DISMATCH_PVP",e[e.CMD_GET_MATCH_PVP_INFO=182]="CMD_GET_MATCH_PVP_INFO",e[e.CMD_HALL_GET_MATCH_PVP_INFO=183]="CMD_HALL_GET_MATCH_PVP_INFO",e[e.CMD_UPGRADE_COMMANDER=200]="CMD_UPGRADE_COMMANDER",e[e.CMD_GET_UPGRADE_MATERIAL_LIST=201]="CMD_GET_UPGRADE_MATERIAL_LIST",e[e.CMD_BagDestory=206]="CMD_BagDestory",e[e.CMD_Record=208]="CMD_Record",e[e.CMD_GET_MOLL_CONFIG=213]="CMD_GET_MOLL_CONFIG",e[e.CMD_BaguseUp=216]="CMD_BaguseUp"}(HallCmdDef||(HallCmdDef={}));var HallDecoder=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.funcPrefix="method_",t}return __extends(t,e),t.prototype.initDecoderFunction=function(){var e=this;for(var t in HallCmdDef){var r=t;if(isNaN(r)){var a=HallCmdDef[t],n=a,o=e[e.funcPrefix+n];o&&e.registerCmd(n,o)}}},t.prototype.removeDecoderFunction=function(){var e=this;for(var t in HallCmdDef){var r=t;if(isNaN(r)){var a=HallCmdDef[t],n=a,o=e[e.funcPrefix+n];o&&e.unRegisterFunction(n)}}},t.prototype.method_100=function(e){ErrorMananger.getInstance().checkReqResult(e)||console.log(e)},t.prototype.method_103=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){console.log(e);var t=UIManager.getInstance().getViewByName(MallView);t&&t.recvData(HallCmdDef.CMD_GET_MOLL_CONFIG,e.msg)}},t.prototype.method_104=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){console.log(e);var t=UIManager.getInstance().getViewByName(MallView);t&&t.recvData(HallCmdDef.CMD_GET_MOLLBY_CONFIG,e);var r=UIManager.getInstance().getViewByName(HallView);r&&r.recvData(HallCmdDef.CMD_GETUPADTEGOLD,e)}},t.prototype.method_105=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){console.log(e);var t=UIManager.getInstance().getViewByName(PackageView);t&&t.recvData(HallCmdDef.CMD_Bag,e.msg)}},t.prototype.method_106=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){console.log(e);var t=UIManager.getInstance().getViewByName(PackageView);t&&t.recvData(HallCmdDef.CMD_Baguse,e);var r=UIManager.getInstance().getViewByName(CardOperationView);r&&r.recvData(HallCmdDef.CMD_Baguse,e)}},t.prototype.method_216=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){console.log(e);var t=UIManager.getInstance().getViewByName(CardOperationView);t&&t.recvData(HallCmdDef.CMD_BaguseUp,e);var r=UIManager.getInstance().getViewByName(PackageView);r&&r.recvData(HallCmdDef.CMD_BaguseUp,e)}},t.prototype.method_206=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(PackageView);t&&t.recvData(HallCmdDef.CMD_BagDestory,e)}},t.prototype.method_107=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(HallView);t&&t.recvData(HallCmdDef.CMD_Notice,e)}},t.prototype.method_208=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(CombatRecordView);t&&t.recvData(HallCmdDef.CMD_Record,e)}},t.prototype.method_125=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(ExtractView);t&&t.recvData(HallCmdDef.CMD_Award,e)}},t.prototype.method_126=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(ChouCardView);t&&t.recvData(HallCmdDef.CMD_Award10,e)}},t.prototype.method_127=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(ChouCardView);t&&t.recvData(HallCmdDef.CMD_MyCardList,e);var r=UIManager.getInstance().getViewByName(ExtractView);r&&r.recvData(HallCmdDef.CMD_MyCardList,e);var a=UIManager.getInstance().getViewByName(HallView);a&&a.recvData(HallCmdDef.CMD_GETUPADTEGOLD,e)}},t.prototype.method_129=function(e){ErrorMananger.getInstance().checkReqResult(e)},t.prototype.method_110=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(CardGroupView);t&&t.recvData(HallCmdDef.CMD_GET_TEAM_CONFIG,e.msg)}},t.prototype.method_111=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(CardGroupView);t&&t.recvData(HallCmdDef.CMD_GET_TEAM_LIST,e.msg)}},t.prototype.method_112=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(CardGroupView);t&&t.recvData(HallCmdDef.CMD_CHANGE_BATTLE_TEAM,e.msg)}},t.prototype.method_113=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){console.log(e);var t=UIManager.getInstance().getViewByName(CardGroupSetView);t&&t.recvData(HallCmdDef.CMD_GET_CARD_LIST_TEAMSET,e.msg)}},t.prototype.method_228=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){console.log(e);var t=UIManager.getInstance().getViewByName(CardView);t&&t.recvData(HallCmdDef.CMD_CardViewLists,e.msg)}},t.prototype.method_232=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){console.log(e);var t=UIManager.getInstance().getViewByName(SetView);t&&t.recvData(HallCmdDef.CMD_SetHead,e);var r=UIManager.getInstance().getViewByName(HallView);r&&r.recvData(HallCmdDef.CMD_SetHead,e)}},t.prototype.method_114=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){console.log(e);var t=UIManager.getInstance().getViewByName(CardGroupSetView);t&&t.recvData(HallCmdDef.CMD_GET_CARD_DETAIL_TEAMSET,e.msg);var r=UIManager.getInstance().getViewByName(CardView);r&&r.recvData(HallCmdDef.CMD_GET_CARD_DETAIL_TEAMSET,e.msg)}},t.prototype.method_115=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(CardGroupSetView);t&&t.recvData(HallCmdDef.CMD_SAVE_TEAMSET,e.msg)}},t.prototype.method_116=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(CardGroupView);t&&t.recvData(HallCmdDef.CMD_GET_FROM_FETTER_TEAM,e.msg)}},t.prototype.method_117=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(CardGroupSetView);t&&t.recvData(HallCmdDef.CMD_GET_FROM_FETTER_TEAMSET,e.msg)}},t.prototype.method_124=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(CardView);t&&t.recvData(HallCmdDef.CMD_GET_CARD_DETAIL,e.msg)}},t.prototype.method_128=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(SetView);t&&t.recvData(HallCmdDef.CMD_SetConfig,e.msg)}},t.prototype.method_150=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(CardView);t&&t.recvData(HallCmdDef.CMD_GET_CARD_LIST,e.msg)}},t.prototype.method_151=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(CardView);t&&t.recvData(HallCmdDef.CMD_GET_CARD_DETAIL,e.msg)}},t.prototype.method_160=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){for(var t=GlobalDataManager.getInstance().getJiBanData(),r=e.msg.length,a=0;r>a;a++){var n=e.msg[a];t.setJBnode(n.code,n.jbName,n.zc)}var o=UIManager.getInstance().getViewByName(FettersView);o&&o.recvData(HallCmdDef.CMD_GET_FETTERS_CONFIG,e.msg)}},t.prototype.method_170=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(RecycleView);t&&t.recvData(HallCmdDef.CMD_GET_CARD_LIST_RECYCLE,e.msg)}},t.prototype.method_171=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(RecycleView);t&&t.recvData(HallCmdDef.CMD_RECYCLE_CARD,e.msg)}},t.prototype.method_175=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(RecycleView);t&&t.recvData(HallCmdDef.CMD_GET_CUR_XWG_PRICE,e.msg)}},t.prototype.method_180=function(e){var t=UIManager.getInstance().getViewByName(MatchingView);t&&t.recvData(HallCmdDef.CMD_MATCH_PVP,e)},t.prototype.method_181=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(MatchingView);t&&t.recvData(HallCmdDef.CMD_DISMATCH_PVP,e.msg)}},t.prototype.method_182=function(e){var t=UIManager.getInstance().getViewByName(MatchingView);t&&t.recvData(HallCmdDef.CMD_GET_MATCH_PVP_INFO,e)},t.prototype.method_183=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(HallView);t&&t.recvData(HallCmdDef.CMD_HALL_GET_MATCH_PVP_INFO,e.msg)}},t.prototype.method_200=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(RoleUpgradeView);t&&t.recvData(HallCmdDef.CMD_UPGRADE_COMMANDER,e.msg)}},t.prototype.method_201=function(e){if(!ErrorMananger.getInstance().checkReqResult(e)){var t=UIManager.getInstance().getViewByName(RoleUpgradeView);t&&t.recvData(HallCmdDef.CMD_GET_UPGRADE_MATERIAL_LIST,e.msg)}},t}(BaseDecoder);__reflect(HallDecoder.prototype,"HallDecoder");var CardFetterItemView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.zcTxt="组成: ",r.xgTxt="效果: ",r.errorTxt="暂无数据",r}return __extends(t,e),t.prototype.week=function(){var t=this,r=LanguageManager.getInstance().getCurLanguageType();1==r&&(t.zcTxt="Formation: ",t.xgTxt="Effects: ",t.errorTxt="Temporarily no data");var a=e.prototype.getData.call(this);if(null!=a){var n=a.name;t.setFetterName(n);var o=a.desc;t.setFetterTip1(o);var i=a.zc;t.setFetterTip2(i,a.hero);var l=a.icon;t.setFetterIcon(l,a.color)}},t.prototype.sleep=function(){},t.prototype.setFetterTip1=function(e){this.labFetterTip1.textFlow=[{text:this.xgTxt,style:{size:20,textColor:9159381}},{text:e,style:{size:20,textColor:16777215}}]},t.prototype.setFetterTip2=function(e,t){var r=e.split(t);r.length>1?this.labFetterTip2.textFlow=[{text:this.zcTxt,style:{size:20,textColor:9159381}},{text:r[0],style:{size:20,textColor:16777215}},{text:t,style:{size:20,textColor:16575843}},{text:r[1]+"\n",style:{size:20,textColor:16777215}}]:this.labFetterTip2.textFlow=[{text:this.zcTxt,style:{size:20,textColor:9159381}},{text:e+"\n",style:{size:20,textColor:16777215}}]},t.prototype.setFetterName=function(e){this.labFetterName.text=e},t.prototype.setFetterIcon=function(e,t){var r=new CardFetterView,a={icon:e,color:t,canTouch:!1};r.initData(a),this.groupFetterIcon.addChild(r),r.scaleX=r.scaleY=this.groupFetterIcon.width/r.width},t.prototype.getViewWidth=function(){return this.groupFetterItem.width},t.prototype.getViewHeight=function(){return this.groupFetterItem.height},t.NAME="CardFetterItemSkin",t}(BaseView);__reflect(CardFetterItemView.prototype,"CardFetterItemView");var ECardItemView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrLetter=["a","b","c","d","e","f","g"],r}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);if(null!=r){var a=(r.own,r.index),n=r.obj,o={icon:n.icon,rarity:n.rarity,element:n.element,round:n.round,generation:n.generation,name:n.name,cost:n.cost,level:n.level,atk:n.atk,hp:n.hp,groupName:"groupCR_"+a,canTouch:!0};this.setSCard(o),1==n.cantouch?t.groupNotOwn.visible=!1:t.groupNotOwn.visible=!0}},t.prototype.setSCard=function(e){var t=this,r=new CardSquareView;r.initData(e),r.scaleX=Number((t.groupCard.width/r.width).toFixed(2)),r.scaleY=Number((t.groupCard.height/r.height).toFixed(2)),r.showSimple(),t.groupCard.addChild(r)},t.prototype.sleep=function(){},t.prototype.setImgBG=function(e){var t=this;t.imgBG.source="lobbyImg1Sheet_json."+t.arrLetter[e-1]+"196x194"},t.prototype.getViewWidth=function(){return this.groupCI.width},t.prototype.getViewHeight=function(){return this.groupCI.height},t.prototype.showSimple=function(){},t.NAME="ECardItemSkin",t}(BaseView);__reflect(ECardItemView.prototype,"ECardItemView");var ExtrackInfoView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.bagid=0,r}return __extends(t,e),t.prototype.week=function(){var t=this,t=this,r=e.prototype.getData.call(this);null!=r&&(t.puotngstring.text=r.common+"%",t.xiyoustring.text=r.rare+"%",t.shishistring.text=r.epic+"%",t.chuanqistring.text=r.legendary+"%",t.shenhuagstring.text=r.mythical+"%",t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t))},t.prototype.sleep=function(){},t.prototype.touchTap=function(e){var t=this,r=e.target;r instanceof eui.Button&&r==t.btnCancel&&t.hiden()},t.NAME="ExtrackInfoSkin",t}(BaseView);__reflect(ExtrackInfoView.prototype,"ExtrackInfoView");var ExtractView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.mallName=[],r.rarityConfigList=[],r.arrCardItem=new Array,r.movingState=!1,r}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.scrCardItem.addEventListener(egret.TouchEvent.TOUCH_CANCEL,e.onCancelHandler,e),e.scrCardItem.addEventListener(egret.TouchEvent.TOUCH_END,e.onEndHandler,e),e.updateGold(),e.sendGetAwardList()},t.prototype.onCancelHandler=function(){this.movingState=!0},t.prototype.onEndHandler=function(){this.movingState=!1},t.prototype.sendGetAwardList=function(){var e=new Object;e.param="抽奖";var t=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(t.getSname(),HallCmdDef.CMD_Award,e,!0)},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_Award:for(var a=(t.msg,t.msg.length),n=0;a>n;n++){var o=t.msg[n],i=o.awardId;r.mallName[i-1]=o}for(var l={},n=0;n<t.tittleconfig.length;n++){var o=t.tittleconfig[n];l[o.tittleId]=o}r.tittleObj=l[1];var s=LanguageManager.getInstance().getCurLanguageType();1==s&&(r.tittleObj=l[2]),r.rarityConfigList.length=t.rarityConfigList.length;for(var c=0;c<t.rarityConfigList.length;c++){var u=t.rarityConfigList[c].code;r.rarityConfigList[u]=t.rarityConfigList[c].rate}this.priceTxt.text="X"+r.tittleObj.cost,a>0&&(r.setTittle(),r.setCardItem());break;case HallCmdDef.CMD_MyCardList:var p=t.curGold,h=GlobalDataManager.getInstance().getAccountData();h.setGold(p),this.updateGold()}},t.prototype.updateGold=function(){var e=GlobalDataManager.getInstance().getAccountData();this.comStar.txt.text=e.getGold()},t.prototype.setTittle=function(){this.tittle1.text=this.tittleObj.tittle1,this.tittle2.text=this.tittleObj.tittle2},t.prototype.onLoadImgCompleteHandler=function(e){if(e.currentTarget.data){var t=new egret.Texture;t.bitmapData=e.currentTarget.data;var r=new egret.Bitmap(t);r.x=0,r.y=0,r.width=this.groupCardItem0.width,r.height=this.groupCardItem0.height,this.groupCardItem0.addChild(r)}},t.prototype.sleep=function(){var e=this;e.cleanArray(e.arrCardItem)},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.touchTap=function(e){var t=this,r=e.target.name;if("groupCR_"==r.substr(0,8)){if(t.movingState)return;var a=r.substr(8,3);UIManager.getInstance().showUI(CGAwardView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,t.mallName[a])}if(e.target instanceof eui.Button){var n=e.target;if(n==t.btnBuy){var o=GlobalDataManager.getInstance().getAccountData();if(o.gold<100)PopManager.getInstance().showPromptBox("金币不够",2,Handler.create(t,function(e){console.log("回调函数被调用")}));else{UIManager.getInstance().showUI(ChouCardView);var i=0;if(1==i){var l=new Object;l.poolNum="100";var s=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(s.getSname(),HallCmdDef.CMD_CreateCardPool,l,!0)}else{var l=new Object;l.param="十连抽抽奖按钮",l.pageid="1",l.pageSize="9";var s=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(s.getSname(),HallCmdDef.CMD_MyCardList,l,!1)}}}else n==t.btnBack?t.hiden():n==t.btnInfo&&t.rarityConfigList.length>=5&&UIManager.getInstance().showUI(ExtrackInfoView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,t.rarityConfigList)}},t.prototype.setCardItem=function(){for(var e=this,t=5,r=0,a=e.scrCardItem.width/t,n=0,o=e.mallName.length,i=0;o>i;i++){var l=new ECardItemView,s=e.mallName[i];l.initData({own:i%2==0?1:0,index:i,obj:s}),l.name=i.toString(),l.scaleX=l.scaleY=1,e.groupCardItem.addChild(l),l.x=r*a+4,l.y=n*(l.getViewHeight()+20),l.width=l.getViewWidth(),l.height=l.getViewHeight(),e.arrCardItem.push(l),r++,r>=t&&(r=0,n++)}},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.extractskingroup){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.extractskingroup.scaleX=r.extractskingroup.scaleY=1):void(r.extractskingroup.scaleX=r.extractskingroup.scaleY=l)}},t.NAME="ExtractSkin",t}(BaseView);__reflect(ExtractView.prototype,"ExtractView");var FilterItemView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=e.prototype.getData.call(this);if(null!=t){var r=this,a=t.des;r.setDes(a);var n=t.gName;r.setGroupName(n)}},t.prototype.sleep=function(){},t.prototype.setDes=function(e){var t=null==e||void 0==e?"":e;this.lblDes.text=t},t.prototype.setGroupName=function(e){var t=null==e||void 0==e?"":e;this.groupFilterItem.name=t},t.prototype.setImgBG=function(){},t.NAME="FilterItemSkin",t}(IBaseView);__reflect(FilterItemView.prototype,"FilterItemView");var FilterView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrFetterItem=new Array,r.arrSIPosY=new Array,r.movingState=!1,r}return __extends(t,e),t.prototype.week=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t),t.scrFilterItem.addEventListener(eui.UIEvent.CHANGE_START,t.onChangeStartHandler,t),t.scrFilterItem.addEventListener(egret.Event.CHANGE,t.onChangeHanlder,t),t.scrFilterItem.addEventListener(eui.UIEvent.CHANGE_END,t.onChangeEndHandler,t),t.scrFilterItem.addEventListener(egret.TouchEvent.TOUCH_CANCEL,t.onCancelHandler,t),t.scrFilterItem.addEventListener(egret.TouchEvent.TOUCH_END,t.onEndHandler,t);var r=e.prototype.getData.call(this);if(null!=r){var a=r.desArr;t.setSortItem(a);var n=r.selIndex,o=r.selStr;if(null!=a&&null==n&&null!=o)for(var i=0,l=a.length;l>i;i++){var s=a[i];if(null!=s&&s==o){n=i;break}}n=null==n||void 0==n?-1:n,t.scrollToItem(n,!1);var c=r.clickMove;c=null==c?!0:c,t.clickMove=c,t.callBackHandler=r.cbHandler}},t.prototype.sleep=function(){var e=this;for(e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.scrFilterItem.removeEventListener(eui.UIEvent.CHANGE_START,e.onChangeStartHandler,e),e.scrFilterItem.removeEventListener(egret.Event.CHANGE,e.onChangeHanlder,e),e.scrFilterItem.removeEventListener(eui.UIEvent.CHANGE_END,e.onChangeEndHandler,e),e.scrFilterItem.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,e.onCancelHandler,e),e.scrFilterItem.removeEventListener(egret.TouchEvent.TOUCH_END,e.onEndHandler,e),null!=e.sortItemScrViewGroup0&&(e.sortItemScrViewGroup0.parent.removeChild(e.sortItemScrViewGroup0),e.sortItemScrViewGroup0=null),null!=e.sortItemScrViewGroup1&&(e.sortItemScrViewGroup1.parent.removeChild(e.sortItemScrViewGroup1),e.sortItemScrViewGroup1=null),e.cleanArray(e.arrFetterItem);e.arrSIPosY.length;)e.arrSIPosY.pop()},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.onCancelHandler=function(){this.movingState=!0},t.prototype.onEndHandler=function(){this.movingState=!1},t.prototype.touchTap=function(e){var t=this,r=e.target;if(r instanceof eui.Rect)r==t.rectBG&&t.hiden();else if(e.target instanceof eui.Group){var a=r;if("groupFetterItem_"==a.name.substr(0,16)){if(t.movingState)return;var n=a.name.split("_");if(2!=n.length)return;var o=Number(n[1]);t.onClickFetterItem(o)}}},t.prototype.onClickFetterItem=function(e){var t=this;t.curChooseSIIndex==e?null!=t.callBackHandler&&t.callBackHandler.runWith([e]):t.clickMove&&t.scrollToItem(e)},t.prototype.setSortItem=function(e){if(null!=e){var t=this;t.filterItemViewHeight=0;for(var r=0,a=e.length,n=0,o=0;a>o;o++){var i=new FilterItemView;i.initData({des:e[o],gName:"groupFetterItem_"+o}),t.groupFilterItem.addChild(i),0==t.filterItemViewHeight&&(t.filterItemViewHeight=i.height),0==r&&(r=t.scrFilterItem.height/2-t.filterItemViewHeight/2),i.horizontalCenter="0";var l=o*i.height+r;i.y=l,t.arrFetterItem.push(i),t.arrSIPosY.push(l)}var s=new eui.Group;s.x=0,s.y=0,s.width=0,s.height=t.scrFilterItem.height/2-t.filterItemViewHeight/2,t.groupFilterItem.addChild(s),t.sortItemScrViewGroup0=s;var c=new eui.Group;c.x=0,c.y=t.filterItemViewHeight*a+r,c.width=0,c.height=t.scrFilterItem.height/2-t.filterItemViewHeight/2,t.groupFilterItem.addChild(c),t.sortItemScrViewGroup1=c,t.constChooseSIIndex=n,t.scrollToItem(n,!1)}},t.prototype.onChangeStartHandler=function(){this.onChangeStart=!0},t.prototype.onChangeHanlder=function(e){this.checkScale()},t.prototype.onChangeEndHandler=function(){var e=this;e.onChangeStart&&(e.onChangeStart=!1,this.autoScrollToItem())},t.prototype.autoScrollToItem=function(){var e=this;e.scrollToItem(e.curChooseSIIndex)},t.prototype.scrollToItem=function(e,t){void 0===t&&(t=!0);var r=this;if(-1!=e){r.curChooseSIIndex=e;var a=r.arrSIPosY[e]-r.scrFilterItem.height/2+r.filterItemViewHeight/2;egret.Tween.removeTweens(r.scrFilterItem.viewport),t?egret.Tween.get(r.scrFilterItem.viewport).to({scrollV:a},100).call(r.checkScale,r):(r.scrFilterItem.viewport.scrollV=a,r.checkScale())}},t.prototype.checkScale=function(){for(var e=this,t=e.scrFilterItem,r=0,a=e.arrFetterItem.length;a>r;r++){var n=e.arrFetterItem[r],o=e.arrSIPosY[r]-t.viewport.scrollV-t.height/2+e.filterItemViewHeight/2,i=1,l=1;Math.abs(o)<=e.filterItemViewHeight/2&&Math.abs(o)>=0?(0>o?i=1+o/1e3:o>0?i=1-o/1e3:0==Math.abs(o)&&(i=1),l=1-Math.abs(o)/1e3,e.curChooseSIIndex=r):Math.abs(o)<=1.5*e.filterItemViewHeight?(i=Number((1-.12*(Math.abs(o)/e.filterItemViewHeight)).toFixed(2)),l=Number((1-.36*(Math.abs(o)/e.filterItemViewHeight)).toFixed(2))):(i=Number((1-.24*(Math.abs(o)/(2*e.filterItemViewHeight))).toFixed(2)),l=Number((1-.74*(Math.abs(o)/(2*e.filterItemViewHeight))).toFixed(2))),n.scaleX=n.scaleY=i,n.alpha=l,n.y=e.arrSIPosY[r]+(1-i)*e.filterItemViewHeight/2}},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.groupCGPSort){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.groupCGPSort.scaleX=r.groupCGPSort.scaleY=1):void(r.groupCGPSort.scaleX=r.groupCGPSort.scaleY=l)}},t.NAME="FilterSkin",t}(BaseView);__reflect(FilterView.prototype,"FilterView");var DailogView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.func=null,r}return __extends(t,e),t.prototype.week=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t);var r=e.prototype.getData.call(this);if(null!=r){var a=r.name;this.func=r.fun,t.showTxt.text=a}},t.prototype.sleep=function(){},t.prototype.SetTxt=function(e){this.showTxt.text=e},t.prototype.touchTap=function(e){var t=this,r=e.target;r instanceof eui.Button?r==t.btnConfirm?(t.hiden(),null!=this.func&&this.func()):r==t.btnCancel&&(t.hiden(),console.log("取消被按下")):r instanceof eui.Rect&&r==t.rectBG&&t.hiden()},t.NAME="DailogSkin",t}(BaseView);__reflect(DailogView.prototype,"DailogView");var DailogView2=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.func=null,r}return __extends(t,e),t.prototype.week=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t);var r=e.prototype.getData.call(this);if(null!=r){var a=r.name;this.func=r.fun,t.showTxt.text=a}},t.prototype.sleep=function(){},t.prototype.SetTxt=function(e){this.showTxt.text=e},t.prototype.touchTap=function(e){var t=this,r=e.target;r instanceof eui.Button?r==t.btnConfirm?(t.hiden(),null!=this.func&&this.func()):r==t.btnCancel&&(t.hiden(),console.log("取消被按下")):r instanceof eui.Rect&&r==t.rectBG&&t.hiden()},t.NAME="DailogSkin2",t}(BaseView);__reflect(DailogView2.prototype,"DailogView2");var HallHeadView=function(e){function t(){return e.call(this,LoadingView.NAME)||this}return __extends(t,e),t.prototype.week=function(){var e=this;e.nickname1.text="123"},t.prototype.setNickName=function(e){},t.prototype.sleep=function(){},t.NAME="HeadSkin",t}(BaseView);__reflect(HallHeadView.prototype,"HallHeadView");var HallView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.infoAry=[],r.arrInfoItem=new Array,r.movingState=!1,r.errorTxt="充值暂未开放",r}return __extends(t,e),t.prototype.$onAddToStage=function(t,r){e.prototype.$onAddToStage.call(this,t,r),Hall.onGameShow()},t.prototype.week=function(){var e=this,r=LanguageManager.getInstance().getCurLanguageType();1==r&&(e.errorTxt="Not available yet"),e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.scrPropItem.addEventListener(egret.TouchEvent.TOUCH_CANCEL,e.onCancelHandler,e),e.scrPropItem.addEventListener(egret.TouchEvent.TOUCH_END,e.onEndHandler,e),GameEventManager.getInstance().addEventListener(GameEvent.updateGold,e,e.updateGold),GameEventManager.getInstance().addEventListener(GameEvent.updateUserInfo,e,e.onUpdateAccountData),t.arrMsg=new Array;var a=GlobalDataManager.getInstance().getAccountData();e.comHead.nickname.text=a.getNick().substring(0,7),e.onUpdateAccountData(),e.updateGold(),e.updateHead();var n=new Object;n.param="跑马灯";var o=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(o.getSname(),HallCmdDef.CMD_Notice,n,!1),e.startTimer(),e.setSysInfoView(null),e.InfoGroup.$setVisible(!1),e.btnInfoOut.$setVisible(!0)},t.prototype.onCancelHandler=function(){this.movingState=!0},t.prototype.onEndHandler=function(){this.movingState=!1},t.prototype.setSysInfoView=function(e){if(null!=e&&!(this.arrInfoItem.length>0))for(var t=this,r=5,a=(t.scrPropItem.width/r,e.length),n=0,o=0;a>o;o++){var i=new InfoItemView,l=e[o];i.initData(l),t.groupPropItem.addChild(i),t.arrInfoItem.push(i),i.x=0,i.y=n*(i.getViewHeight()+6),i.setGroupName("groupPI_"+o),n++}},t.prototype.updateHead=function(){var e=this,t=GlobalDataManager.getInstance().getAccountData();e.comHead.nickname.text=t.getNick().substring(0,7),e.comHead.leveltxt.text=t.getLvl()+"";t.getUpexp(),t.getMuexp();e.comHead.lblProgress.text=t.getExp()+"/"+t.getUpexp(),e.comHead.prbLoading.value=t.getExp()/t.getUpexp()*100,e.comHead.hptxt.text=t.getHp()+"",e.comHead.hptxt_btnum.text=t.getHp()+"",""==t.getHead_Url()&&t.setHead_Url("headicon_json.head_01"),e.setHeadIcon(t.getHead_Url());var r=new egret.Shape;r.graphics.beginFill(0);var a=e.comHead.groupIcon.width/2,n=e.comHead.groupIcon.height/2;r.x=a,r.y=n,r.graphics.drawCircle(0,0,a),r.graphics.endFill(),e.comHead.groupIcon.addChild(r),e.comHead.headimag.mask=r},t.prototype.setHeadIcon=function(e){""==e&&(e="headicon_json.head_01"),this.comHead.headimag.source=e},t.prototype.updateGold=function(){var e=GlobalDataManager.getInstance().getAccountData();this.comStar.txt.text=e.getGold()},t.prototype.startTimer=function(){var e=this;null==e.timer&&(e.timer=new egret.Timer(3e5,0),e.timer.addEventListener(egret.TimerEvent.TIMER,e.timerFunc,e)),e.timer.start()},t.prototype.stopTimer=function(){var e=this;null!=e.timer&&e.timer.stop()},t.prototype.timerFunc=function(){var e=new Object;e.param="跑马灯";var t=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(t.getSname(),HallCmdDef.CMD_Notice,e,!1)},t.prototype.onLoadImgCompleteHandler=function(e){var t=this;if(e.currentTarget.data){var r=new egret.Texture;r.bitmapData=e.currentTarget.data;var a=new egret.Bitmap(r);a.x=0,a.y=0,a.width=t.comHead.groupIcon.width,a.height=t.comHead.groupIcon.height,t.comHead.groupIcon.addChild(a);var n=new egret.Shape;n.graphics.beginFill(0);var o=t.comHead.groupIcon.width/2,i=t.comHead.groupIcon.height/2;n.x=o,n.y=i,n.graphics.drawCircle(0,0,o),n.graphics.endFill(),t.comHead.groupIcon.addChild(n),a.mask=n}},t.prototype.sleep=function(){var e=this;e.stopTimer(),e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.scrPropItem.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,e.onCancelHandler,e),e.scrPropItem.removeEventListener(egret.TouchEvent.TOUCH_END,e.onEndHandler,e),GameEventManager.getInstance().removeEventListener(GameEvent.updateGold,e,e.updateGold),GameEventManager.getInstance().removeEventListener(GameEvent.updateUserInfo,e,e.onUpdateAccountData)},t.prototype.recvData=function(e,r){var a=this;switch(e){case HallCmdDef.CMD_Notice:;t.arrMsg=[];for(var n=r.msg.length,o=0;n>o;o++){var i={nna:r.msg[o].tittle+": ",nde:r.msg[o].disc},l=LanguageManager.getInstance().getCurLanguageType();1==l&&(i={nna:r.msg[o].tittleEn+": ",nde:r.msg[o].discEn}),t.arrMsg.push(i)}a.infoAry=[],n=r.info.length;for(var o=0;n>o;o++)a.infoAry[r.info[o].noticeId-1]=r.info[o];a.setSysInfoView(a.infoAry),a.showHorseRaceLamp();break;case HallCmdDef.CMD_GETUPADTEGOLD:a.updateGold();break;case HallCmdDef.CMD_SetHead:var s=r.msg,c=GlobalDataManager.getInstance().getAccountData();c.setHead_Url(s),a.setHeadIcon(s)}},t.prototype.gotoView=function(e){switch(e){case"CardView":UIManager.getInstance().showUI(CardView);break;case"MatchingView":UIManager.getInstance().showUI(MatchingView);break;case"CardGroupView":UIManager.getInstance().showUI(CardGroupView);
break;case"ExtractView":UIManager.getInstance().showUI(ExtractView);break;case"MallView":UIManager.getInstance().showUI(MallView);break;case"PackageView":UIManager.getInstance().showUI(PackageView);break;case"RecycleView":UIManager.getInstance().showUI(RecycleView);break;case"FettersView":UIManager.getInstance().showUI(FettersView);break;case"ActivetyView":var t=LanguageManager.getInstance().getLabelLanguage(this);PopManager.getInstance().showPromptBox(t.lbl_0,2);break;case"Change":UIManager.getInstance().showUI(ExchangeView);break;case"CombatRecordView":UIManager.getInstance().showUI(CombatRecordView);break;case"SetView":UIManager.getInstance().showUI(SetView)}},t.prototype.touchTap=function(e){var t=this,r=e.target;if(r instanceof eui.Group){var a=e.target;if("groupPI_"==a.name.substr(0,8)){if(t.movingState)return;var n=a.name.split("_"),o=Number(n[1]),i=this.infoAry[o];console.log(a.name),this.gotoView(i.view)}}r instanceof eui.Button&&(r==t.btnCard?this.gotoView("CardView"):r==t.btnCombat?this.gotoView("MatchingView"):r==t.btnCardGroup?this.gotoView("CardGroupView"):r==t.btnExtract?this.gotoView("ExtractView"):r==t.btnMall?this.gotoView("MallView"):r==t.btnRetrieve?this.gotoView("RecycleView"):r==t.btnCharge?this.gotoView("Change"):r==t.btnPackage?this.gotoView("PackageView"):r==t.btnActivity?this.gotoView("ActivetyView"):r==t.btnFetters?this.gotoView("FettersView"):r==t.btnCombatRecord?this.gotoView("CombatRecordView"):r==t.btnSetUp?this.gotoView("SetView"):r==t.btnInfoInto?(t.InfoGroup.$setVisible(!1),t.btnInfoOut.$setVisible(!0)):r==t.btnInfoOut?(t.InfoGroup.$setVisible(!0),t.btnInfoOut.$setVisible(!1)):r==t.HeadButton||r==t.comHead.upbtn?UIManager.getInstance().showUI(RoleUpgradeView):"btnUserItem"==r.name&&PublicMethodManager.getInstance().openWallet())},t.prototype.showHorseRaceLamp=function(){HorseRaceLamp.getInstance().closeHorseRaceLamp();for(var e=0;e<t.arrMsg.length;e++){var r=t.arrMsg[e],a=r.nna,n=r.nde,o=20,i=!1,l=85,s=85,c=new eui.Label;c.x=10,c.y=5,c.fontFamily="SimHei",c.textColor=16777215,c.size=o,c.bold=i,c.text=a+n;var u=1e4,p=this.comNotable.width-s-l;p=1>p?1:p,u+=u*(c.width/p),HorseRaceLamp.getInstance().showHorseRaceLamp(this.comNotable,r.nna+r.nde,8,l,s,!1,u,16777215,o,i,2,1500,null,!0)}},t.prototype.reqMatchInfo=function(){var e=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_HALL_GET_MATCH_PVP_INFO,{},!1)},t.prototype.onUpdateAccountData=function(){var e=this,t=GlobalDataManager.getInstance().getAccountData();e.comHead.leveltxt.text=t.getLvl()+"";t.getExp(),t.getUpexp();e.comHead.lblProgress.text=t.getExp()+"/"+t.getUpexp(),e.comHead.prbLoading.value=t.getExp()/t.getUpexp()*100,e.comHead.hptxt.text=t.getHp()+""},t.NAME="HallSkin",t}(BaseView);__reflect(HallView.prototype,"HallView");var HorseRaceLamp=function(){function e(){this.objHorseRaceLamp=new Array,this.isHRL=!1}return e.getInstance=function(){return e.m_manager},e.prototype.showHorseRaceLamp=function(e,t,r,a,n,o,i,l,s,c,u,p,h,g){void 0===r&&(r=10),void 0===a&&(a=165),void 0===n&&(n=100),void 0===o&&(o=!1),void 0===i&&(i=1e4),void 0===l&&(l=16777215),void 0===s&&(s=20),void 0===c&&(c=!1),void 0===u&&(u=2),void 0===p&&(p=1500),void 0===h&&(h=null),void 0===g&&(g=!1);var d=new Object;d.txt=t,d.offY=r,d.left=a,d.right=n,d.color=l,d.speed=i,d.size=s,d.stroke=u,d.bold=c,d.container=e,d.mask=h,d.wait=p,d.loop=g,o?this.OutHorseRaceLamp(d):(this.objHorseRaceLamp.push(d),this.isHRL||this.OutHorseRaceLamp())},e.prototype.closeHorseRaceLamp=function(){for(this.HorseM&&this.HorseM.parent&&this.HorseM.parent.removeChild(this.HorseM),this.HorseBG&&(egret.Tween.removeTweens(this.HorseBG),this.HorseBG.parent&&this.HorseBG.parent.removeChild(this.HorseBG));this.objHorseRaceLamp.length;)this.objHorseRaceLamp.pop();this.isHRL=!1},e.prototype.OutHorseRaceLamp=function(e){void 0===e&&(e=null);var t=null;if(null==e){if(this.isHRL)return;if(0==this.objHorseRaceLamp.length)return;t=this.objHorseRaceLamp.shift()}else t=e;var r=t.textFlow,a=t.txt,n=t.offY,o=t.left,i=t.right,l=t.speed,s=t.color,c=t.size,u=t.bold,p=t.stroke,h=t.container,g=t.mask,d=t.wait,m=t.loop;if(m&&this.objHorseRaceLamp.push(t),h){if(!h.stage)return void egret.Tween.get(h).wait(1e3).call(function(){this.OutHorseRaceLamp(null)},this,null);var C=new eui.Label;C.x=0,C.y=0,C.touchEnabled=!1,void 0==r?(C.fontFamily="SimHei",C.size=c,C.textColor=s,C.bold=u,C.text=a,C.stroke=p):C.textFlow=r;var f=new egret.Sprite;f.graphics.beginFill(0,0),f.addChild(C),f.graphics.drawRect(0,0,C.width,C.height),f.y=n,f.x=h.stage.stageWidth,f.touchEnabled=!1,f.mask=g;var v=null;null==g&&0!=o&&0!=i&&(v=new eui.Rect,v.left=o,v.right=i,v.height=C.height,v.fillColor=0,v.y=n,f.mask=v,v.y=n,h.addChild(v),this.HorseM&&this.HorseM.parent&&this.HorseM.parent.removeChild(this.HorseM),this.HorseM=v),h.addChild(f),this.HorseBG&&this.HorseBG.parent&&this.HorseBG.parent.removeChild(this.HorseBG),this.HorseBG=f,null==e&&(this.isHRL=!0);var I=h.width-o-i,y=C.width>I?I+o-C.width:o,b=h.width+C.width+20,w=l*(h.width-y+o)/b;w=w>l?l/2:w,egret.Tween.get(f).to({x:y},w).wait(d).to({x:0-C.width-20},l-w).call(function(e,t,r){e.parent&&(e.parent.removeChild(e),this.HorseBG=null),r&&(this.isHRL=!1,this.OutHorseRaceLamp(null)),t&&t.parent&&(t.parent.removeChild(t),this.HorseM=null)},this,[f,v,null==e?!0:!1])}},e.m_manager=new e,e}();__reflect(HorseRaceLamp.prototype,"HorseRaceLamp");var LoadingView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),this.timer=new egret.Timer(200,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.start(),this.loadNum=0},t.prototype.sleep=function(){},t.prototype.timerFunc=function(){this.loadNum=this.loadNum+1,this.loadNum>=100&&(this.timer.stop(),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.hiden())},t.prototype.touchTap=function(e){var t=this,r=e.target;r instanceof eui.Button&&t.hiden()},t.NAME="LoadingSkin",t}(BaseView);__reflect(LoadingView.prototype,"LoadingView");var LobbyTestView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.$onAddToStage=function(t,r){e.prototype.$onAddToStage.call(this,t,r),Hall.onGameShow()},t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),t.arrMsg=new Array;var r={nna:"标题:",nde:"内容内容内容内容内容内容内容内容66"};t.arrMsg.push(r)},t.prototype.sleep=function(){},t.prototype.recvData=function(e){},t.prototype.touchTap=function(e){var r=this,a=e.target;a instanceof eui.Button&&a==r.BtnZhuXiao&&UIManager.getInstance().showUI(t,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,{})},t.NAME="SetSkin",t}(BaseView);__reflect(LobbyTestView.prototype,"LobbyTestView");var NotableView=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(BaseView);__reflect(NotableView.prototype,"NotableView");var RoleUpgradeMaterialView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this;t.imgIcon.source="",t.lblCount.text="",t.lblName.text="",t.count=0,t.kind="";var r=e.prototype.getData.call(this);if(null!=r){var a=r.mdata;null!=a&&(null!=a.icon&&(t.imgIcon.source="hallImg1Sheet_json."+a.icon),null!=a.count&&(t.count=a.count,t.lblCount.text=a.count),null!=a.name&&(t.lblName.text=a.name),null!=a.kind&&(t.kind=a.kind)),null!=r.gname&&(t.groupRUM.name=r.gname)}},t.prototype.sleep=function(){},t.prototype.setSelect=function(e){this.imgSelect.source=e?"hallBtn1Sheet_json.a40x40_1":"hallBtn1Sheet_json.a40x40_0"},t.prototype.setCount=function(e){var t=this;t.count=e,t.lblCount.text=e+""},t.prototype.getCount=function(){return this.count},t.prototype.getKind=function(){return this.kind},t.prototype.getViewWidth=function(){return this.groupRUM.width},t.NAME="RoleUpgradeMaterialSkin",t}(IBaseView);__reflect(RoleUpgradeMaterialView.prototype,"RoleUpgradeMaterialView");var RoleUpgradeView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.groupUpgrade.visible=e.imgTitleUpgrade.visible=!0,e.groupLevelUp.visible=e.imgTitleLevelUp.visible=!1,e.upgradeMaterialViewArr=new Array,e.labelObj=LanguageManager.getInstance().getLabelLanguage(this),e.updateView(),e.reqUpgradeMaterialList()},t.prototype.sleep=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.cleanUpgradeMaterialViewArr(),e.labelObj=null},t.prototype.touchTap=function(e){var t=this,r=e.target;if(r instanceof eui.Button){var a=r;if(a==t.btnUCancel)t.hiden();else if(a==t.btnUUser){if(null==t.curSelMaterialView||t.curSelMaterialView.getCount()<=0)return void PopManager.getInstance().showPromptBox(t.labelObj.lbl_3,2,Handler.create(t,function(e){t.hiden(),UIManager.getInstance().showUI(MallView)}));var n=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(n.getSname(),HallCmdDef.CMD_UPGRADE_COMMANDER,{kind:t.curSelMaterialView.getKind()},!0)}else if(a==t.btnClose){if(!t.groupUpgrade.visible)return t.imgTitleUpgrade.visible=t.groupUpgrade.visible=!0,void(t.imgTitleLevelUp.visible=t.groupLevelUp.visible=!1);t.hiden()}else a==t.btnGoShop&&(t.hiden(),UIManager.getInstance().showUI(MallView))}else if(r instanceof eui.Group){var o=e.target;if("groupRUM_"==o.name.substr(0,9)){var i=o.name.split("_");if(2!=i.length)return;var l=Number(i[1]),s=t.upgradeMaterialViewArr[l];if(null==s||s==t.curSelMaterialView)return;null!=t.curSelMaterialView&&t.curSelMaterialView.setSelect(!1),s.setSelect(!0),t.curSelMaterialView=s}}},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_UPGRADE_COMMANDER:r.onUpgradeCommander(t);break;case HallCmdDef.CMD_GET_UPGRADE_MATERIAL_LIST:r.onGetUpgradeMaterialList(t)}},t.prototype.updateView=function(){var e=this,t=GlobalDataManager.getInstance().getAccountData();e.lblLvl.text=t.getLvl()+"",e.lblLvProgress.text=t.getExp()+"/"+t.getUpexp(),e.groupGoShop.visible=!0},t.prototype.reqUpgradeMaterialList=function(){var e=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_GET_UPGRADE_MATERIAL_LIST,{},!0)},t.prototype.onUpgradeCommander=function(e){if(null!=e){var t=this,r=e.lvl,a=e.exp,n=e.upexp,o=e.hp,i=e.count,l=e.kind,s=e.cost,c=GlobalDataManager.getInstance().getAccountData();if(r!=c.getLvl()&&(t.imgTitleUpgrade.visible=t.groupUpgrade.visible=!1,t.imgTitleLevelUp.visible=t.groupLevelUp.visible=!0,t.lblOLvl.text=c.getLvl()+"",t.lblNLvl.text=r+"",t.lblOHp.text=c.getHp()+"",t.lblNHp.text=o+"",t.lblOCost.text=c.getCost()+"",t.lblNCost.text=s+""),null!=r&&c.setLvl(r),null!=a&&c.setExp(a),null!=n&&c.setUpexp(n),null!=o&&c.setHp(o),null!=s&&c.setCost(s),null!=i&&null!=l)for(var u=0,p=t.upgradeMaterialViewArr.length;p>u;u++){var h=t.upgradeMaterialViewArr[u];null!=h&&h.getKind()==l+""&&h.setCount(i)}t.updateView();var g=e.full;0!=g&&PopManager.getInstance().showPromptBox(t.labelObj.lbl_4,2),GameEventManager.getInstance().dispatchEvent(GameEvent.updateUserInfo)}},t.prototype.onGetUpgradeMaterialList=function(e){if(null!=e){var t=this;t.cleanUpgradeMaterialViewArr();for(var r=25,a=0,n=0,o=e.length;o>n;n++){var i=e[n];if(null!=i){var l=new RoleUpgradeMaterialView;l.initData({mdata:i,gname:"groupRUM_"+n}),t.groupUMaterial.addChild(l),l.x=n*(l.getViewWidth()+r),null!=i.count&&(a+=i.count,null==t.curSelMaterialView&&0!=i.count&&(t.curSelMaterialView=l,l.setSelect(!0))),t.upgradeMaterialViewArr.push(l)}}0==a&&(t.curSelMaterialView=t.upgradeMaterialViewArr[0],t.curSelMaterialView.setSelect(!0)),t.groupGoShop.visible=0==a}},t.prototype.cleanUpgradeMaterialViewArr=function(){var e=this;if(e.curSelMaterialView=null,null!=e.upgradeMaterialViewArr&&0!=e.upgradeMaterialViewArr.length)for(var t=e.upgradeMaterialViewArr.length-1;t>=0;t--){var r=e.upgradeMaterialViewArr[t];null!=r&&null!=r.parent&&r.parent.removeChild(r),e.upgradeMaterialViewArr.splice(t,1)}},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.groupRoleUpgrade){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.groupRoleUpgrade.scaleX=r.groupRoleUpgrade.scaleY=1):void(r.groupRoleUpgrade.scaleX=r.groupRoleUpgrade.scaleY=l)}},t.NAME="RoleUpgradeSkin",t}(BaseView);__reflect(RoleUpgradeView.prototype,"RoleUpgradeView");var ExchangeView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrOptionBtn=new Array,r.curBtnIdx=0,r}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.updateGold(),e.setOptionBtn(),e.sendGetShopList()},t.prototype.sendGetShopList=function(){var e=GlobalDataManager.getInstance().getCenterServer(),t=new Object;t.param="兑换",HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_InExchange,t,!0)},t.prototype.updateGold=function(){var e=GlobalDataManager.getInstance().getAccountData();this.comStar.txt.text=e.getGold()},t.prototype.sleep=function(){var e=this;e.cleanArray(e.arrOptionBtn),e.curChooseOptionBtnIndex=null},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.recvData=function(e,t){switch(e){case HallCmdDef.CMD_GET_MOLL_CONFIG:t.shopDesc,t.shopName,t.length}},t.prototype.touchTap=function(e){var t=this;if(e.target instanceof eui.Button){var r=e.target;if("btnOption_"==r.name.substr(0,10)){var a=r.name.split("_");if(2!=a.length)return;var n=Number(a[1]);t.setCurChooseOptionBtnByIndex(n),console.log("选择按钮被按下："+n)}else r==t.btnBack?t.hiden():r==t.btnInAll?t.hiden():r==t.btnInConfirm?t.hiden():r==t.btnOutAll?t.hiden():r==t.btnOutConfirm&&t.hiden()}},t.prototype.setOptionBtn=function(){var e=this,t=["zrdyx","zcdqb"],r=LanguageManager.getInstance().getCurLanguageType();1==r&&(t=["e_zrdyx","e_zcdqb"]);for(var a=0;2>a;a++){var n=new OptionBtnView;n.init(),e.groupOptionBtn.addChild(n),n.setBtnImgContent(t[a]),n.setBtnName("btnOption_"+a),n.x=20,e.arrOptionBtn.push(n),n.width=n.getViewWidth(),n.height=n.getViewHeight()}e.updateOptionBtnPos(),e.setCurChooseOptionBtnByIndex(0)},t.prototype.setCurChooseOptionBtnByIndex=function(e){var t=this,r=null;if(null!=t.curChooseOptionBtnIndex){if(t.curChooseOptionBtnIndex==e)return;if(r=t.getOptionBtnViewByIndex(t.curChooseOptionBtnIndex),null==r)return;r.setCurChoose(0,!0)}t.curChooseOptionBtnIndex=e,r=t.getOptionBtnViewByIndex(e),null!=r&&(r.setCurChoose(1,!0),t.updateOptionBtnPos(),t.curBtnIdx=e,t.setPropItem(e))},t.prototype.getOptionBtnViewByIndex=function(e){for(var t=null,r=this,a=0,n=r.arrOptionBtn.length;n>a;a++){var o=r.arrOptionBtn[a];if(null!=o){var i=o.getBtnName(),l=i.split("_");if(2==l.length){var s=Number(l[1]);if(e==s){t=o;break}}}}return t},t.prototype.updateOptionBtnPos=function(){for(var e=this,t=0,r=0,a=e.arrOptionBtn.length;a>r;r++){var n=e.arrOptionBtn[r];null!=n&&(n.y=t,t+=n.getViewHeight()+20)}e.scrOptionBtn.height=t},t.prototype.setPropItem=function(e){var t=this;0==e?(t.InGroup.$setVisible(!0),t.OutGroup.$setVisible(!1)):(t.InGroup.$setVisible(!1),t.OutGroup.$setVisible(!0))},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.mallskingroup){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.mallskingroup.scaleX=r.mallskingroup.scaleY=1):void(r.mallskingroup.scaleX=r.mallskingroup.scaleY=l)}},t.NAME="ExchangeSkin",t}(BaseView);__reflect(ExchangeView.prototype,"ExchangeView");var MallView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrOptionBtn=new Array,r.arrPropItem=new Array,r.mallName=[],r.kindList=[0,2,8,7,-1],r.curBtnIdx=0,r.tempList=[],r.pageNum=1,r.pageSize=10,r.receiveNum=0,r.needUp=!1,r}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.scrPropItem.addEventListener(eui.UIEvent.CHANGE,e.moveHandler,e),e.scrPropItem.addEventListener(eui.UIEvent.CHANGE_END,e.outHandler,e),this.pageNum=1,this.needUp=!1,this.receiveNum=0,e.updateGold(),e.setOptionBtn(),e.sendGetShopList()},t.prototype.sendGetShopList=function(){var e=GlobalDataManager.getInstance().getCenterServer(),t=new Object;t.param="商城",HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_Shop,t,!0)},t.prototype.moveHandler=function(e){this.scrPropItem.viewport.scrollV>this.scrPropItem.viewport.contentHeight-this.scrPropItem.viewport.height-40&&(this.needUp=!0)},t.prototype.outHandler=function(e){this.receiveNum<this.pageSize&&(this.needUp=!1),this.needUp&&(this.needUp=!1,this.addNewData())},t.prototype.addNewData=function(){this.pageNum=this.pageNum+1,this.sendGetShopList()},t.prototype.updateGold=function(){var e=GlobalDataManager.getInstance().getAccountData();this.comStar.txt.text=e.getGold()},t.prototype.sleep=function(){var e=this;e.cleanArray(e.arrOptionBtn),e.cleanArray(e.arrPropItem),e.curChooseOptionBtnIndex=null,this.pageNum=1,e.mallName=[]},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_GET_MOLL_CONFIG:var a=(t.shopDesc,t.shopName,t.length);this.receiveNum=a;for(var n=0;a>n;n++){var o=t[n],i=LanguageManager.getInstance().getCurLanguageType();1==i&&(o.shopName=o.shopEnName,o.shopDesc=o.shopEnDesc);(this.pageNum-1)*this.pageSize+n;r.mallName[o.shopOrder-1]=o}r.setCurChooseOptionBtnByIndex(0);break;case HallCmdDef.CMD_GET_MOLLBY_CONFIG:var a=(t.msg,t.itemIdx,t.buyNum),l=t.curGold,s=t.shopOrder,c=t.msg,u=t.errorString;if(0==c)PopManager.getInstance().showPromptBox(u,2,Handler.create(r,function(e){console.log("回调函数被调用")}));else{for(var p=0;p<r.mallName.length;p++)r.mallName[p].shopOrder==s&&(r.mallName[p].shopNum=r.mallName[p].shopNum+parseInt(a));var h=GlobalDataManager.getInstance().getAccountData();h.setGold(l),r.updateGold(),r.setPropItem(r.kindList[r.curBtnIdx])}}},t.prototype.touchTap=function(e){var t=this;if(e.target instanceof eui.Button){var r=e.target;if("btnOption_"==r.name.substr(0,10)){var a=r.name.split("_");if(2!=a.length)return;var n=Number(a[1]);t.setCurChooseOptionBtnByIndex(n),console.log("选择按钮被按下："+n)}else if("btnBuy_"==r.name.substr(0,7)){var a=r.name.split("_");if(2!=a.length)return;var n=Number(a[1]);UIManager.getInstance().showUI(MPropExplainView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,{type:t.tempList[n],idx:n})}else r==t.btnBack&&t.hiden()}},t.prototype.setOptionBtn=function(){for(var e=this,t=["bag_quanbu","bag_jingyanshu","bag_changjing","bag_paibei","bag_qita"],r=0;5>r;r++){var a=new OptionBtnView;a.init(),e.groupOptionBtn.addChild(a),a.setBtnImgContent(t[r]),a.setBtnName("btnOption_"+r),a.x=20,e.arrOptionBtn.push(a),a.width=a.getViewWidth(),a.height=a.getViewHeight()}},t.prototype.setCurChooseOptionBtnByIndex=function(e){var t=this,r=null;if(null!=t.curChooseOptionBtnIndex){if(t.curChooseOptionBtnIndex==e)return;if(r=t.getOptionBtnViewByIndex(t.curChooseOptionBtnIndex),null==r)return;r.setCurChoose(0,!0)}t.curChooseOptionBtnIndex=e,r=t.getOptionBtnViewByIndex(e),null!=r&&(r.setCurChoose(1,!0),t.updateOptionBtnPos(),t.cleanArray(t.arrPropItem),t.curBtnIdx=e,t.setPropItem(t.kindList[e]))},t.prototype.getOptionBtnViewByIndex=function(e){for(var t=null,r=this,a=0,n=r.arrOptionBtn.length;n>a;a++){var o=r.arrOptionBtn[a];if(null!=o){var i=o.getBtnName(),l=i.split("_");if(2==l.length){var s=Number(l[1]);if(e==s){t=o;break}}}}return t},t.prototype.updateOptionBtnPos=function(){for(var e=this,t=0,r=0,a=e.arrOptionBtn.length;a>r;r++){var n=e.arrOptionBtn[r];null!=n&&(n.y=t,t+=n.getViewHeight()+20)}e.scrOptionBtn.height=t},t.prototype.setPropItem=function(e){var t=this,r=2,a=0,n=t.scrPropItem.width/r-21,o=0;t.tempList=[];for(var i=0,l=0;l<t.mallName.length;l++)0!=e?t.mallName[l].pcode==e&&(t.tempList[i]=t.mallName[l],i+=1):(t.tempList[i]=t.mallName[l],i+=1);for(var s=t.tempList.length,l=0;s>l;l++){var c=new MPropItemView,u={name:t.tempList[l].shopName,idx:l,price:t.tempList[l].price,icon:t.tempList[l].resUrl};c.setData(u),c.init(),t.groupPropItem.addChild(c),c.x=a*n+30,c.y=o*(c.getViewHeight()+19)+28,c.width=c.getViewWidth(),c.height=c.getViewHeight(),c.setBtnName("btnBuy_"+l),t.arrPropItem.push(c),a+=1,a>=r&&(a=0,o++)}},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.mallskingroup){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.mallskingroup.scaleX=r.mallskingroup.scaleY=1):void(r.mallskingroup.scaleX=r.mallskingroup.scaleY=l)}},t.NAME="MallSkin",t}(BaseView);__reflect(MallView.prototype,"MallView");var MPropExplainView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.oldString="",r.huafeiTxt="（花费：",r.yiyouTxt="(已有 ",r.geTxt=" 个)",r.tishiTxt="请输入正确数字",r}return __extends(t,e),t.prototype.week=function(){var t=this;t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t);var r=LanguageManager.getInstance().getCurLanguageType();1==r&&(t.huafeiTxt="（cost：",t.yiyouTxt="(",t.geTxt=" Owned)",t.tishiTxt="Please enter quantity");var a=e.prototype.getData.call(this);if(null!=a){var n=a.type;this.selectNum=1,this.maxNum=n.shopNum,this.totalnum.text=t.huafeiTxt+this.selectNum*n.price+" XWG)",this.editCount.text=this.selectNum+"",this.nameandnum.text=n.shopNum+t.geTxt,this.namstring.text=n.shopName+t.yiyouTxt+n.shopNum+t.geTxt,this.descstring.text=n.shopDesc,this.price.text=n.price+" XWG",this.itemPrice=n.price,this.shopOrder=n.shopOrder,this.shopKind=n.shopKind,this.itemIdx=a.idx,t.setIcon(n.resUrl),t.editCount.addEventListener(eui.UIEvent.CHANGE,t.moveHandler,t),t.editCount.addEventListener(eui.UIEvent.CHANGE_END,t.outHandler,t)}},t.prototype.setIcon=function(e){""!=e&&(this.imgItem.source="hallImg1Sheet_json."+e)},t.prototype.sleep=function(){},t.prototype.isNumber=function(e){var t=/^\d+(\.\d+)?$/,r=/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/;return t.test(e)||r.test(e)?!0:!1},t.prototype.moveHandler=function(e){var t=this;this.editCount.text.length>7&&(this.editCount.text=t.oldString),""!=this.editCount.text&&(1==t.isNumber(this.editCount.text)?t.oldString=this.editCount.text:this.editCount.text=t.oldString);var r=parseInt(this.editCount.text);1==t.isNumber(this.editCount.text)&&(this.totalnum.text=t.huafeiTxt+r*this.itemPrice+" XWG)")},t.prototype.outHandler=function(e){var t=this,r=parseInt(this.editCount.text);1==t.isNumber(this.editCount.text)&&(this.totalnum.text=t.huafeiTxt+r*this.itemPrice+" XWG)")},t.prototype.touchTap=function(e){var t=this,r=e.target;if(r instanceof eui.Button)if(r==t.btnConfirm){t.hiden();var a=parseInt(this.editCount.text);if(0==t.isNumber(this.editCount.text))return void PopManager.getInstance().showPromptBox(t.tishiTxt,2,Handler.create(t,function(e){console.log("回调函数被调用")}));var n=Math.floor(a);if(a=parseInt(this.editCount.text),a>n||0>=a||a>=1e5)return void PopManager.getInstance().showPromptBox(t.tishiTxt,2,Handler.create(t,function(e){console.log("回调函数被调用")}));var o=new Object;o.shopOrder=""+this.shopOrder,o.shopKind=""+this.shopKind,o.price=""+this.itemPrice,o.buyNum=""+a,o.itemIdx=""+this.itemIdx;var i=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(i.getSname(),HallCmdDef.CMD_ShopBy,o,!0)}else r==t.btnCancel?t.hiden():r==t.btnReduce?(this.selectNum>1&&(this.selectNum=this.selectNum-1),this.editCount.text=this.selectNum+"",this.totalnum.text=t.huafeiTxt+this.selectNum*this.itemPrice+" XWG)"):r==t.btnAdd?(this.selectNum<this.maxNum&&(this.selectNum=this.selectNum+1),this.editCount.text=this.selectNum+"",this.totalnum.text=t.huafeiTxt+this.selectNum*this.itemPrice+" XWG)"):r==t.btnMax&&(this.selectNum=this.maxNum,this.editCount.text=this.selectNum+"",this.totalnum.text=t.huafeiTxt+this.selectNum*this.itemPrice+" XWG)");else r instanceof eui.Rect&&r==t.rectBG&&t.hiden()},t.NAME="MPropExplainSkin",t}(BaseView);__reflect(MPropExplainView.prototype,"MPropExplainView");var MPropItemView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);if(null!=r){var a=r.name;this.thename.text=a,this.price.text=r.price+" XWG",this.btnBuy.label="购买:"+r.price,t.setIcon(r.icon)}},t.prototype.sleep=function(){},t.prototype.setIcon=function(e){""!=e&&(this.imgItem.source="hallImg1Sheet_json."+e)},t.prototype.getViewWidth=function(){return this.groupPI.width},t.prototype.getViewHeight=function(){return this.groupPI.height},t.prototype.setBtnName=function(e){this.btnBuy.name=e},t.NAME="MPropItemSkin",t}(BaseView);__reflect(MPropItemView.prototype,"MPropItemView");var MatchingView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.loopReqMatchInfoIndex=-1,r.loopReqTime=3,r}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.initView(),e.sendMatch()},t.prototype.initView=function(){var e=this;e.loopReqMatchInfoIndex=-1,e.timeCounter=0,e.updateTimeShow(),e.startRotate(),e.startTimer(),e.setHintTextField()},t.prototype.sleep=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.stopRotate(),e.stopTimer(),null!=e.timer&&(e.timer.removeEventListener(egret.TimerEvent.TIMER,e.timerFunc,e),e.timer=null),null!=e.hintTextField&&(e.hintTextField.parent.removeChild(e.hintTextField),e.hintTextField=null)},t.prototype.touchTap=function(e){var t=this,r=e.target;r instanceof eui.Button&&r==t.btnStop&&t.sendDisMatch()},t.prototype.startRotate=function(){var e=this;e.stopRotate(),e.imgRotate.rotation=0,egret.Tween.get(e.imgRotate,{loop:!0}).to({rotation:360},2500)},t.prototype.stopRotate=function(){egret.Tween.removeTweens(this.imgRotate)},t.prototype.startTimer=function(){var e=this;null==e.timer&&(e.timer=new egret.Timer(1e3,0),e.timer.addEventListener(egret.TimerEvent.TIMER,e.timerFunc,e),e.timeCounter=0),e.timer.start()},t.prototype.stopTimer=function(){var e=this;null!=e.timer&&e.timer.stop()},t.prototype.timerFunc=function(){var e=this;e.timeCounter++,e.updateTimeShow(),-1!=e.loopReqMatchInfoIndex&&(e.loopReqMatchInfoIndex--,0==e.loopReqMatchInfoIndex&&e.sendGetMatchInfo())},t.prototype.updateTimeShow=function(){var e=this;e.lblTime.text=e.parseTime(e.timeCounter)},t.prototype.parseTime=function(e){0>e&&(e=0);var t=e%60,r=Math.floor(e/60),a=10>t?"0"+t:""+t,n=10>r?"0"+r:""+r;return n+":"+a},t.prototype.setHintTextField=function(){var e=this,t=LanguageManager.getInstance().getLabelLanguage(this),r=new egret.TextField;r.textColor=16777215,r.size=36,e.groupHint.addChild(r),r.fontFamily="SimHei",r.textFlow=[{text:t.lbl_0,style:{size:36,textColor:16769945}},{text:t.lbl_1,style:{size:30,textColor:8443388}}],e.hintTextField=r,e.groupHint.width=r.width},t.prototype.sendMatch=function(){var e=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_MATCH_PVP,{gcid:0},!1)},t.prototype.sendDisMatch=function(){var e=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_DISMATCH_PVP,{})},t.prototype.sendGetMatchInfo=function(){var e=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_GET_MATCH_PVP_INFO,{},!1)},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_MATCH_PVP:r.onGetMatchPvp(t);break;case HallCmdDef.CMD_DISMATCH_PVP:r.hiden();break;case HallCmdDef.CMD_GET_MATCH_PVP_INFO:r.onGetMatchInfo(t)}},t.prototype.onGetMatchPvp=function(e){if(null!=e){var t=this,r=e.msg;if(null!=e.result&&e.result!=GlobalDef.REQUEST_SUCCESS){t.stopTimer();var a=null;if(a=-108==r?Handler.create(t,function(){t.hiden(),UIManager.getInstance().showUI(CardGroupView)}):Handler.create(t,function(){t.hiden()}),ErrorMananger.getInstance().checkReqResult(e,!0,a))return}null!=r&&null!=r.ruuid?t.openWebSocket(r):t.sendGetMatchInfo()}},t.prototype.onGetMatchInfo=function(e){if(null!=e){var t=this,r=e.msg;if(null!=e.result&&e.result!=GlobalDef.REQUEST_SUCCESS){t.stopTimer();var a=Handler.create(t,function(){t.hiden()});if(ErrorMananger.getInstance().checkReqResult(e,!0,a))return}return null==r||0==r?void t.loopSendGetMatchInfo():void t.openWebSocket(r)}},t.prototype.openWebSocket=function(e){if(null!=e){var t=e.ruuid;GlobalDataManager.getInstance().setRUUID(t);var r=e.room;GlobalDataManager.getInstance().setRoom(r),GlobalDataManager.getInstance().setThredID(0);var a=e.scode;GlobalDataManager.getInstance().setGameServerName(a),GlobalDataManager.getInstance().setGameOver(!1);var n=e.surl,o=new ServerData;o.setSname(a),o.setSurl(n),o.setResolver(WebSocketManager.getInstance().getResolver(JsonResolver.NAME)),WebSocketManager.getInstance().registerServer(o),WebSocketManager.getInstance().connectServer(a,!0)}},t.prototype.loopSendGetMatchInfo=function(){var e=this;e.loopReqMatchInfoIndex=e.loopReqTime},t.NAME="MatchingSkin",t}(BaseView);__reflect(MatchingView.prototype,"MatchingView");var FetterItemView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);null!=r&&(t.setName(r.name),t.setIcon(r.icon),t.setBgClr(r.color))},t.prototype.sleep=function(){},t.prototype.setName=function(e){this.labItemName.text=e},t.prototype.setIcon=function(e){""!=e&&(this.imgItem.source=e)},t.prototype.setBgClr=function(e){if(""!=e){var t="jibanshuoming_json.jb"+e+"_0";this.bgClr.source=t}},t.prototype.setItemNum=function(e){},t.prototype.getViewWidth=function(){return this.groupPI.width},t.prototype.setBeenSelect=function(e){},t.prototype.getViewHeight=function(){return this.groupPI.height},t.prototype.setGroupName=function(e){this.groupPI.name=e},t.NAME="FetterItemSkin",t}(BaseView);__reflect(FetterItemView.prototype,"FetterItemView");var HeadItemView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);null!=r&&(t.setName(r.name),t.setItemNum(r.num),t.setIcon(r.icon),t.selcetLight.$setVisible(!1))},t.prototype.sleep=function(){},t.prototype.setName=function(e){},t.prototype.setIcon=function(e){""!=e&&(this.imgItem.source=e)},t.prototype.setItemNum=function(e){},t.prototype.getViewWidth=function(){return this.groupPI.width},t.prototype.setBeenSelect=function(e){this.selcetLight.$setVisible(e)},t.prototype.getViewHeight=function(){return this.groupPI.height},t.prototype.setGroupName=function(e){this.groupPI.name=e},t.NAME="HeadItemSkin",t}(BaseView);__reflect(HeadItemView.prototype,"HeadItemView");var PackageView=function(e){function t(){var r=e.call(this,t.NAME)||this;
return r.mallName=[],r.kindList=[0,2,8,7,-1],r.curBtnIdx=0,r.curItemIdx=0,r.tempList=[],r.arrOptionBtn=new Array,r.arrPropItem=new Array,r.needUp=!1,r.hIndex=0,r.vIndex=0,r.pageNum=1,r.pageSize=10,r.receiveNum=0,r.cuihuiTxt="被摧毁物品将无法找回！是否确定摧毁？",r.weijiesuoTxt="使用暂未解锁",r}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.scrPropItem.addEventListener(eui.UIEvent.CHANGE,e.moveHandler,e),e.scrPropItem.addEventListener(eui.UIEvent.CHANGE_END,e.outHandler,e);var t=LanguageManager.getInstance().getCurLanguageType();1==t&&(e.cuihuiTxt="Deleted items can't be retrieved! Are you sure to delete it?",this.weijiesuoTxt="Not available yet"),this.pageNum=1,this.needUp=!1,this.receiveNum=0,e.setOptionBtn(),this.setItemInfo(null),e.sendGetBagList(),e.updateGold()},t.prototype.updateGold=function(){var e=GlobalDataManager.getInstance().getAccountData();this.comStar.txt.text=e.getGold()},t.prototype.sendGetBagList=function(){var e=new Object;e.param="背包",e.pageid=this.pageNum,e.pageSize=this.pageSize;var t=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(t.getSname(),HallCmdDef.CMD_Bag,e,!0)},t.prototype.sleep=function(){var e=this;e.cleanArray(e.arrOptionBtn),e.cleanArray(e.arrPropItem),e.curChooseOptionBtnIndex=null,e.hIndex=0,e.vIndex=0,e.scrPropItem.viewport.scrollV=0,e.scrPropItem.viewport.scrollH=0,this.pageNum=1,e.mallName=[]},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_Bag:var a=t.length;this.receiveNum=a;for(var n=0;a>n;n++){var o=t[n],i=(this.pageNum-1)*this.pageSize+n;r.mallName[i]=o}a>0&&r.setPropItem(0,0);break;case HallCmdDef.CMD_Baguse:case HallCmdDef.CMD_BagDestory:for(var l=(t.msg,t.itemIdx),s=(t.bagId,t.shopKind),c=t.shop_num,n=0;n<r.mallName.length;n++)r.mallName[n].shopKind==s&&(r.mallName[n].shopNum=c);r.hIndex=0,r.vIndex=0,r.cleanArray(r.arrPropItem),r.setPropItem(r.kindList[r.curBtnIdx],l);break;case HallCmdDef.CMD_BaguseUp:for(var l=t.itemIdx,s=(t.bagId,t.shopKind),c=t.bagNum,n=0;n<r.mallName.length;n++)r.mallName[n].shopKind==s&&(r.mallName[n].shopNum=c);r.hIndex=0,r.vIndex=0,r.cleanArray(r.arrPropItem),r.setPropItem(r.kindList[r.curBtnIdx],l)}},t.prototype.touchTap=function(e){var t=this;if(e.target instanceof eui.Button){var r=e.target;if("btnOption_"==r.name.substr(0,10)){var a=r.name.split("_");if(2!=a.length)return;var n=Number(a[1]);t.setCurChooseOptionBtnByIndex(n),t.cleanArray(t.arrPropItem),t.hIndex=0,t.vIndex=0,t.scrPropItem.viewport.scrollV=0,t.scrPropItem.viewport.scrollH=0,t.curBtnIdx=n,t.setPropItem(t.kindList[n],0)}else if(r==t.btnBack)t.hiden();else if(r==t.btnUse){var o=t.tempList[t.curItemIdx],i=o.shopKind;if(1==i||2==i||3==i||4==i){UIManager.getInstance().showUI(CardView);var l=new Object;l.param="卡牌"}else PopManager.getInstance().showPromptBox(this.weijiesuoTxt,2,Handler.create(t,function(e){console.log("回调函数被调用")}))}else if(r==t.btnDestory){var s=function(){console.log("回调函数被调用,调用id");var e=t.tempList[t.curItemIdx],r=e.bagId,a=new Object;a.bagId=r,a.shop_kind=e.shopKind,a.itemIdx=t.curItemIdx,a.usetype=!1;var n=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(n.getSname(),HallCmdDef.CMD_BagDestory,a,!0)},o={name:this.cuihuiTxt,fun:s};UIManager.getInstance().showUI(DailogView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,o)}}else if(e.target instanceof eui.Group){var c=e.target;if("groupPI_"==c.name.substr(0,8)){var a=c.name.split("_");if(2!=a.length)return;var n=Number(a[1]);new PPropExplainView;this.curItemIdx=n,this.setItemInfo(this.curItemIdx)}}},t.prototype.setLight=function(e){for(var t=this.arrPropItem.length-1;t>=0;t--){var r=this.arrPropItem[t];null!=r&&(t==e?r.setBeenSelect(!0):r.setBeenSelect(!1))}},t.prototype.setItemInfo=function(e){var t=this.tempList[e];return null==t?void this.infogroup.$setVisible(!1):(this.infogroup.$setVisible(!0),this.iconname.text=t.shopName,this.num.text=t.shopNum,this.disc.text=t.shopDesc,this.price.text=t.price,this.imgItem.source="hallImg1Sheet_json."+t.resUrl,void this.setLight(e))},t.prototype.moveHandler=function(e){this.scrPropItem.viewport.scrollV>this.scrPropItem.viewport.contentHeight-this.scrPropItem.viewport.height-40&&(this.needUp=!0)},t.prototype.outHandler=function(e){this.receiveNum<this.pageSize&&(this.needUp=!1),this.needUp&&(this.needUp=!1,this.addNewData())},t.prototype.addNewData=function(){this.pageNum=this.pageNum+1,this.sendGetBagList()},t.prototype.setOptionBtn=function(){for(var e=this,t=["bag_quanbu","bag_jingyanshu","bag_changjing","bag_paibei","bag_qita"],r=0;5>r;r++){var a=new OptionBtnView;a.init(),e.groupOptionBtn.addChild(a),a.setBtnImgContent(t[r]),a.setBtnName("btnOption_"+r),a.x=20,e.arrOptionBtn.push(a),a.width=a.getViewWidth(),a.height=a.getViewHeight()}e.setCurChooseOptionBtnByIndex(0)},t.prototype.setCurChooseOptionBtnByIndex=function(e){var t=this,r=null;if(null!=t.curChooseOptionBtnIndex){if(t.curChooseOptionBtnIndex==e)return;if(r=t.getOptionBtnViewByIndex(t.curChooseOptionBtnIndex),null==r)return;r.setCurChoose(0,!0)}t.curChooseOptionBtnIndex=e,r=t.getOptionBtnViewByIndex(e),null!=r&&(r.setCurChoose(1,!0),t.updateOptionBtnPos())},t.prototype.getOptionBtnViewByIndex=function(e){for(var t=null,r=this,a=0,n=r.arrOptionBtn.length;n>a;a++){var o=r.arrOptionBtn[a];if(null!=o){var i=o.getBtnName(),l=i.split("_");if(2==l.length){var s=Number(l[1]);if(e==s){t=o;break}}}}return t},t.prototype.updateOptionBtnPos=function(){for(var e=this,t=0,r=0,a=e.arrOptionBtn.length;a>r;r++){var n=e.arrOptionBtn[r];null!=n&&(n.y=t,t+=n.getViewHeight()+20)}e.scrOptionBtn.height=t},t.prototype.setPropItem=function(e,t){var r=this,a=4;r.tempList=[];for(var n=0,o=0;o<r.mallName.length;o++)0!=e?r.mallName[o].pcode==e&&r.mallName[o].shopNum>0&&(r.tempList[n]=r.mallName[o],n+=1):r.mallName[o].shopNum>0&&(r.tempList[n]=r.mallName[o],n+=1);for(var i=r.scrPropItem.width/a,l=r.tempList.length,o=0;l>o;o++){var s=new PPropItemView2,c={icon:r.tempList[o].resUrl,name:r.tempList[o].shopName,num:r.tempList[o].shopNum};s.initData(c),r.groupPropItem.addChild(s),s.x=r.hIndex*(.95*i-2)+28,s.y=r.vIndex*(s.getViewHeight()+20)+28,s.width=s.getViewWidth(),s.height=s.getViewHeight(),s.setGroupName("groupPI_"+o),r.arrPropItem.push(s),r.hIndex++,r.hIndex>=a&&(r.hIndex=0,r.vIndex++)}this.curItemIdx=t,this.setItemInfo(this.curItemIdx)},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.groupPackage){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.groupPackage.scaleX=r.groupPackage.scaleY=1):void(r.groupPackage.scaleX=r.groupPackage.scaleY=l)}},t.NAME="PackageSkin",t}(BaseView);__reflect(PackageView.prototype,"PackageView");var PPropExplainView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.bagid=0,r.yyTxt=" (拥有",r.xgTxt="（花费: ",r.jianTxt="件)",r}return __extends(t,e),t.prototype.week=function(){var t=this,r=LanguageManager.getInstance().getCurLanguageType();1==r&&(t.yyTxt="(Owen: ",t.xgTxt="(Cost: ",t.jianTxt=")");var t=this,a=e.prototype.getData.call(this);if(null!=a){var n=a.type,o="";t.setIcon(o);var i=n.shopName,l=n.shopNum;t.setItemName(i,l);var s=n.shop_desc;t.setItemTips(s);var c=n.price;t.setItemCost(c),t.bagid=n.bagId,this.itemIdx=a.idx,t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchTap,t)}},t.prototype.sleep=function(){},t.prototype.touchTap=function(e){var t=this,r=e.target;if(r instanceof eui.Button){if(r==t.btnUse){t.hiden();var a=new Object;a.bagId=t.bagid,a.itemIdx=t.itemIdx;var n=GlobalDataManager.getInstance().getCenterServer();HttpManager.getInstance().send(n.getSname(),HallCmdDef.CMD_Baguse,a,!0)}}else r instanceof eui.Rect&&r==t.rectBG&&t.hiden()},t.prototype.setIcon=function(e){null==e&&"undefine"==e&&(this.imgItem.source=e)},t.prototype.setItemName=function(e,t){this.labItemName.text=e+this.yyTxt+t+this.jianTxt},t.prototype.setItemTips=function(e){this.labTips.text=e},t.prototype.setItemCost=function(e){this.labCost.text=this.xgTxt+e+"XWG)"},t.NAME="PPropExplainSkin",t}(BaseView);__reflect(PPropExplainView.prototype,"PPropExplainView");var PPropItemView=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);null!=r&&(t.setName(r.name),t.setItemNum(r.num),t.setIcon(r.icon))},t.prototype.sleep=function(){},t.prototype.setName=function(e){this.labItemName.text=e},t.prototype.setIcon=function(e){""!=e&&(this.imgItem.source=e)},t.prototype.setItemNum=function(e){this.labItemNum.text=""+e},t.prototype.getViewWidth=function(){return this.groupPI.width},t.prototype.getViewHeight=function(){return this.groupPI.height},t.prototype.setGroupName=function(e){this.groupPI.name=e},t.NAME="PPropItemSkin",t}(BaseView);__reflect(PPropItemView.prototype,"PPropItemView");var PPropItemView2=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.week=function(){var t=this,r=e.prototype.getData.call(this);null!=r&&(t.setName(r.name),t.setItemNum(r.num),t.setIcon(r.icon),t.selcetLight.$setVisible(!1))},t.prototype.sleep=function(){},t.prototype.setName=function(e){},t.prototype.setIcon=function(e){""!=e&&(this.imgItem.source="hallImg1Sheet_json."+e)},t.prototype.setItemNum=function(e){this.labItemNum.text=""+e},t.prototype.getViewWidth=function(){return this.groupPI.width},t.prototype.setBeenSelect=function(e){this.selcetLight.$setVisible(e)},t.prototype.getViewHeight=function(){return this.groupPI.height},t.prototype.setGroupName=function(e){this.groupPI.name=e},t.NAME="PPropItemSkin2",t}(BaseView);__reflect(PPropItemView2.prototype,"PPropItemView2");var RecycleView=function(e){function t(){var r=e.call(this,t.NAME)||this;return r.arrSort1=[],r.arrSort2=[],r.arrSort3=[],r.sortText=[["zhanligdd","zhanliddg","gongjigdd","gongjiddg","shengminggdd","shengmingddg","feiyonggdd","feiyongddg"],["quanpinzhi","putong","xiyou","shishi","chuanqi","shenghua"],["quanwuxing","jin","mu","shui","huo","tu"]],r.sortFactor={sort:0,rarity:0,element:0},r.pageNum=1,r.pageSize=20,r.arrOptionBtn=new Array,r.arrCardItem=new Array,r.arrChooseCard=new Array,r.movingState=!1,r.curXWGPrice=0,r.countDown=5,r}return __extends(t,e),t.prototype.week=function(){var e=this;e.hasEventListener(egret.TouchEvent.TOUCH_TAP)||e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e),e.scrCardItem.addEventListener(eui.UIEvent.CHANGE_END,e.onChangeEndHandler,e),e.scrCardItem.addEventListener(egret.TouchEvent.TOUCH_CANCEL,e.onCancelHandler,e),e.scrCardItem.addEventListener(egret.TouchEvent.TOUCH_END,e.onEndHandler,e),e.initView(),e.sendGetCardList(),e.sendUpdateXWGPrice()},t.prototype.sleep=function(){var e=this;for(e.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.touchTap,e);e.arrChooseCard.length;)e.arrChooseCard.pop();for(;0!=e.arrSort1.length;)e.arrSort1.pop();for(;0!=e.arrSort2.length;)e.arrSort2.pop();for(;0!=e.arrSort3.length;)e.arrSort3.pop();e.labelObj=null,e.cleanArray(e.arrOptionBtn),e.removeCardItem(),e.stopTimer()},t.prototype.cleanArray=function(e){if(!(null==e||e.length<=0))for(var t=e.length-1;t>=0;t--){var r=e[t];if(null!=r){var a=r.parent;a.removeChild(r)}e.splice(t,1)}},t.prototype.touchTap=function(e){var t=this;if(e.target instanceof eui.Button){var r=e.target;if("btnOption_"==r.name.substr(0,10)){var a=r.name.split("_");if(2!=a.length)return;var n=Number(a[1]);if(0==n){var o={desArr:t.arrSort1,cbHandler:Handler.create(t,t.onChooseCardSort1),selIndex:t.sortFactor.sort};UIManager.getInstance().showUI(FilterView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,o)}else if(1==n){var o={desArr:t.arrSort2,cbHandler:Handler.create(t,t.onChooseCardSort2),selIndex:t.sortFactor.rarity};UIManager.getInstance().showUI(FilterView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,o)}else if(2==n){var o={desArr:t.arrSort3,cbHandler:Handler.create(t,t.onChooseCardSort3),selIndex:t.sortFactor.element};UIManager.getInstance().showUI(FilterView,GameScene.VIEW_LAYER_NUMBER,-1,0,0,0,o)}}else if(r==t.btnRecycle){if(t.arrChooseCard.length<=0)return void PopManager.getInstance().showPromptBox(t.labelObj.lbl_28,2);PopManager.getInstance().showPromptBox(t.labelObj.lbl_29,1,Handler.create(t,function(e){e&&t.sendRecycleCard()}),[t.labelObj.lbl_30,t.labelObj.lbl_31])}else r==t.btnReset?t.onResetChoose():r==t.btnBack&&t.hiden()}else if(e.target instanceof eui.Group){var i=e.target;if("groupCS_"==i.name.substr(0,8)){if(t.movingState)return;var a=i.name.split("_");if(2!=a.length)return;var n=Number(a[1]);t.onClickCardItem(n)}}},t.prototype.onChangeEndHandler=function(){var e=this;this.scrCardItem.viewport.scrollV>this.scrCardItem.viewport.contentHeight-this.scrCardItem.viewport.height-40&&e.canReqCardList&&(e.pageNum++,e.sendGetCardList())},t.prototype.onCancelHandler=function(){this.movingState=!0},t.prototype.onEndHandler=function(){this.movingState=!1},t.prototype.initView=function(){var e=this;e.pageNum=1,e.curXWGPrice=0,e.canReqCardList=!0,e.sortFactor={sort:0,rarity:0,element:0},e.labelObj=LanguageManager.getInstance().getLabelLanguage(this);for(var t=0;20>t;t++)8>t?e.arrSort1.push(e.labelObj["lbl_"+t]):14>t?e.arrSort2.push(e.labelObj["lbl_"+t]):20>t&&e.arrSort3.push(e.labelObj["lbl_"+t]);e.updateGold(),e.setOptionBtn(),e.updateContent(),e.startTimer()},t.prototype.setOptionBtn=function(){for(var e=this,t=0;t<e.sortText.length;t++){var r=new OptionBtnView;r.init(),e.groupOptionBtn.addChild(r),r.setBtnImgContent(e.sortText[t][0]),r.setBtnName("btnOption_"+t),r.x=20,r.y=r.getViewHeight()*t+30*t,e.arrOptionBtn.push(r);for(var a=0,n=0;n<e.sortText[t].length;n++){var o=new OptionBtnItemView;o.init(),r.addItem(o),o.setBtnContent(e.sortText[t][n]),o.x=0,o.y=a,o.width=o.getViewWidth(),o.height=o.getViewHeight(),o.setBtnName("btnOptionItem_"+t+"_"+n),a+=o.getViewHeight()}r.setItemGroupHeight(a),r.hiddenGroupItem(),r.width=r.getViewWidth(),r.height=r.getViewHeight()}},t.prototype.updateGold=function(){var e=GlobalDataManager.getInstance().getAccountData();this.comStar.txt.text=e.getGold()},t.prototype.onChooseCardSort1=function(e){this.onChangeCardSort(1,e)},t.prototype.onChooseCardSort2=function(e){this.onChangeCardSort(2,e)},t.prototype.onChooseCardSort3=function(e){this.onChangeCardSort(3,e)},t.prototype.onChangeCardSort=function(e,t){var r=this;if(null!=r.sortFactor){var a="";a=1==e?"sort":2==e?"rarity":"element";var n=r.sortFactor[a],o=!0;(null==n||n==t)&&(o=!1),r.arrOptionBtn[e-1].setBtnImgContent(this.sortText[e-1][t]),r.arrOptionBtn[e-1].setChooseState(),o?(r.canReqCardList=!0,r.sortFactor[a]=t,r.pageNum=1,r.sendGetCardList()):UIManager.getInstance().hideUI(FilterView)}},t.prototype.sendGetCardList=function(){var e=GlobalDataManager.getInstance().getCenterServer(),t=this,r={rarity:t.sortFactor.rarity,element:t.sortFactor.element,sort:t.sortFactor.sort,pageNum:t.pageNum,pageSize:t.pageSize,detail:0};HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_GET_CARD_LIST_RECYCLE,r)},t.prototype.sendRecycleCard=function(){for(var e=GlobalDataManager.getInstance().getCenterServer(),t=this,r=new Array,a=0,n=t.arrChooseCard.length;n>a;a++){var o=t.arrChooseCard[a];if(null!=o){var i=o.getData();null!=i&&null!=i.code&&r.push(i.code)}}var l={codeArr:r};HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_RECYCLE_CARD,l)},t.prototype.sendUpdateXWGPrice=function(){var e=GlobalDataManager.getInstance().getCenterServer(),t={};HttpManager.getInstance().send(e.getSname(),HallCmdDef.CMD_GET_CUR_XWG_PRICE,t,!1)},t.prototype.recvData=function(e,t){var r=this;switch(e){case HallCmdDef.CMD_GET_CARD_LIST_RECYCLE:r.setCardItem(t),UIManager.getInstance().hideUI(FilterView);break;case HallCmdDef.CMD_RECYCLE_CARD:r.onRecycleCard(t);break;case HallCmdDef.CMD_GET_CUR_XWG_PRICE:r.onGetXWGPrice(t)}},t.prototype.setCardItem=function(e){var t=this;t.pageNum<=1&&t.removeCardItem();for(var r=4,a=t.scrCardItem.width/r,n=t.arrCardItem.length,o=n%r,i=Math.floor(n/r),l=e.length,s=.7,c=-1,u=0;l>u;u++){var p=e[u];if(null!=p){var h=new CardSquareView,g=p;g.groupName="groupCS_"+(u+n),h.initData(g),h.scaleX=h.scaleY=s,t.groupCardItem.addChild(h),-1==c&&(c=a-h.getViewWidth()*s>0?Math.floor((a-h.getViewWidth()*s)/(r-1)):0);var d=a*o+c;h.x=d,h.y=i*(h.height*s+15),t.arrCardItem.push(h),o++,o>=r&&(o=0,i++);for(var m=0,C=t.arrChooseCard.length;C>m;m++){var f=t.arrChooseCard[m];if(null!=f){var v=f.getData();if(v.code==p.code){t.arrChooseCard[m]=h,h.setChoose(!0);break}}}}}l<t.pageSize&&(t.canReqCardList=!1)},t.prototype.removeCardItem=function(){var e=this;e.cleanArray(e.arrCardItem),e.scrCardItem.viewport.scrollV=0},t.prototype.onClickCardItem=function(e){var t=this,r=t.arrCardItem[e];if(null!=r){var a=r.getData();if(null!=a&&null!=a.code){for(var n=a.code,o=-1,i=0,l=t.arrChooseCard.length;l>i;i++){var s=t.arrChooseCard[i];if(null!=s){var c=s.getData();if(c.code==n){o=i;break}}}-1==o?(t.arrChooseCard.push(r),r.setChoose(!0)):(t.arrChooseCard.splice(o,1),r.setChoose(!1)),t.updateContent()}}},t.prototype.updateContent=function(){var e=this,t=e.arrChooseCard.length,r=0,a=0,n=0,o=0,i=0,l=0;if(0!=t)for(var s=0,c=e.arrChooseCard.length;c>s;s++){var u=e.arrChooseCard[s];if(null!=u){var p=u.getData();if(null!=p){var h=p.rarity;if(null!=h&&""!=h){"common"==h?r++:"rare"==h?a++:"epic"==h?n++:"legendary"==h?o++:"mythical"==h&&i++;var g=p.val_initial,d=p.val_growing;l+=g+d}}}}var m=l,C=new Array,f=e.labelObj.lbl_20,v=f.split("%s");2==v.length&&(C.push({text:v[0],style:{textColor:9027795}}),C.push({text:t+"",style:{textColor:16770164}}),C.push({text:v[1],style:{textColor:9027795}}));var I=PublicMethodManager.getInstance().getProbabilityStr(e.labelObj.lbl_21,[r+""]);C.push({text:I,style:{textColor:16777215}});var y=PublicMethodManager.getInstance().getProbabilityStr(e.labelObj.lbl_22,[a+""]);C.push({text:y,style:{textColor:642420}});var b=PublicMethodManager.getInstance().getProbabilityStr(e.labelObj.lbl_23,[n+""]);C.push({text:b,style:{textColor:3060978}});var w=PublicMethodManager.getInstance().getProbabilityStr(e.labelObj.lbl_24,[o+""]);C.push({text:w,style:{textColor:15489789}});var _=PublicMethodManager.getInstance().getProbabilityStr(e.labelObj.lbl_25,[i+""]);C.push({text:_,style:{textColor:16749105}});PublicMethodManager.getInstance().getProbabilityStr(e.labelObj.lbl_26,[a+""]);C.push({text:e.labelObj.lbl_26,style:{textColor:11253441}}),C.push({text:m+"XWG\n",style:{textColor:16777215}}),e.lblContent.textFlow=C},t.prototype.startTimer=function(){var e=this;e.timeCounter=e.countDown,null==e.timer&&(e.timer=new egret.Timer(1e3,0),e.timer.addEventListener(egret.TimerEvent.TIMER,e.timerFunc,e)),e.timer.start()},t.prototype.stopTimer=function(){var e=this;null!=e.timer&&e.timer.stop()},t.prototype.timerFunc=function(){var e=this;e.timeCounter--,0==e.timeCounter&&(e.stopTimer(),e.timeCounter=e.countDown,e.sendUpdateXWGPrice())},t.prototype.onResetChoose=function(){var e=this;if(!(e.arrChooseCard.length<=0)){for(var t=e.arrChooseCard.length-1;t>=0;t--){var r=e.arrChooseCard[t];null!=r&&r.setChoose(!1),e.arrChooseCard.splice(t,1)}e.updateContent()}},t.prototype.onRecycleCard=function(e){if(null!=e){var t=this,r=e.gold;GlobalDataManager.getInstance().getAccountData().setGold(r);var a=null!=e.recyclePrice?t.labelObj.lbl_32+e.recyclePrice:t.labelObj.lbl_33;PopManager.getInstance().showPromptBox(a,2,Handler.create(t,function(e){t.updateGold(),t.onResetChoose(),t.pageNum=1,t.canReqCardList=!0,t.sendGetCardList(),GameEventManager.getInstance().dispatchEvent(GameEvent.updateGold)}))}},t.prototype.onGetXWGPrice=function(e){if(null!=e){var t=this,r="0.00",a=16777215;if(0!=t.curXWGPrice){var n=Number((e.xwgPrice-t.curXWGPrice).toFixed(2));r=n>0?"+"+n:""+n,a=n>0?3203328:16726283}t.curXWGPrice=e.xwgPrice.toFixed(2),t.lblXWGPrice.textFlow=[{text:t.labelObj.lbl_27,style:{textColor:9027538}},{text:t.curXWGPrice+"",style:{textColor:16770164}},{text:"（"+r+"）",style:{textColor:a}}],t.startTimer()}},t.prototype.onResize=function(t){e.prototype.onResize.call(this,t);var r=this;if(null!=r.groupRecycle){var a=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_WIDTH:GlobalDef.SCREEN_HEIGHT,n=GlobalDef.SCREEN_WIDTH>GlobalDef.SCREEN_HEIGHT?GlobalDef.SCREEN_HEIGHT:GlobalDef.SCREEN_WIDTH,o=r.$stage.stageWidth,i=r.$stage.stageHeight,l=Number((o/i/(a/n)).toFixed(2));return l>1||0>l?void(r.groupRecycle.scaleX=r.groupRecycle.scaleY=1):void(r.groupRecycle.scaleX=r.groupRecycle.scaleY=l)}},t.NAME="RecycleSkin",t}(BaseView);__reflect(RecycleView.prototype,"RecycleView");